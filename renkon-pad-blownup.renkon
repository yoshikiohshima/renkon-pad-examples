{"padTitle":"Blown up",
"positions":{"map":{"__map":true,
"values":[["0",{"height":70,
"id":"0",
"type":"move",
"width":368.5774288267939,
"x":1844.336698265131,
"y":3138.298733056638}],["1",{"height":70,
"id":"1",
"type":"resize",
"width":382.64455649075126,
"x":1848.8913953942415,
"y":3003.895684196633}],["2",{"height":185.90341836271807,
"id":"2",
"type":"resize",
"width":550.3504095702365,
"x":6000.339992269312,
"y":3310.8609865308936}],["3",{"height":232.2276583834098,
"id":"3",
"type":"resize",
"width":656.014055855572,
"x":5267.98459436186,
"y":3321.3374916360585}],["4",{"height":194.75007863660034,
"id":"4",
"type":"resize",
"width":580.6598147936329,
"x":3729.40822836278,
"y":3335.0162935721296}],["5",{"height":315.88097454277863,
"id":"5",
"type":"resize",
"width":339.85033767619814,
"x":4360.48720861284,
"y":3330.0958191627233}],["6",{"height":681.6385801091253,
"id":"6",
"type":"move",
"width":521.6840626552555,
"x":-695.58211673917,
"y":3329.1300120344868}],["7",{"height":576.2558458168464,
"id":"7",
"type":"resize",
"width":560.2925968835125,
"x":493.7985936210686,
"y":3323.4189124377376}],["8",{"height":1050.4578220593612,
"id":"8",
"type":"move",
"width":542.1440365668224,
"x":-115.6826650117512,
"y":3320.543004536837}],["9",{"height":467.6243959517578,
"id":"9",
"type":"resize",
"width":494.031806053265,
"x":1130.6948776363658,
"y":3324.9057277778797}],["10",{"height":424.63775673073826,
"id":"10",
"type":"resize",
"width":452.34584890986855,
"x":4743.300705514285,
"y":3323.48524615556}],["11",{"height":852.9430235499997,
"id":"11",
"type":"resize",
"width":835.0307710217561,
"x":2833.2258927310413,
"y":3332.8705406001227}],["12",{"height":182.66054009508935,
"id":"12",
"type":"resize",
"width":372.72367705449506,
"x":2382.3236864541964,
"y":3329.1452305289113}],["13",{"height":643.0442983852919,
"id":"13",
"type":"resize",
"width":628.9394654626541,
"x":1690.5228660669213,
"y":3321.1567108070753}],["14",{"height":70,
"id":"14",
"type":"resize",
"width":394.1362556361331,
"x":125.98130013456603,
"y":-125.0294194667373}],["15",{"height":70,
"id":"15",
"type":"resize",
"width":319.73396084833826,
"x":118.96989596487745,
"y":-238.30162481777802}],["16",{"height":70,
"id":"16",
"type":"move",
"width":488.4872561418307,
"x":-318.6000538337703,
"y":-1571.8645518922615}],["17",{"height":579.6734005448261,
"id":"17",
"type":"resize",
"width":771.6648632441266,
"x":572.1665842126843,
"y":-1456.4336267291487}],["18",{"height":534.0023280095405,
"id":"18",
"type":"move",
"width":854.8055858182582,
"x":-313.8173643048844,
"y":-1457.4169374857343}],["19",{"height":305.50825446124884,
"id":"19",
"type":"move",
"width":487.5746910130667,
"x":-302.74263817096266,
"y":-829.2621181047227}],["20",{"height":8373.463255257166,
"id":"20",
"type":"resize",
"width":2294.8163029128677,
"x":9487.968227994197,
"y":-2653.5225312933712}],["21",{"height":162.01383475600036,
"id":"21",
"type":"resize",
"width":372.7040916077949,
"x":8536.633381440372,
"y":1496.8704704277657}],["22",{"height":70,
"id":"22",
"type":"move",
"width":300.5089141544578,
"x":8531.225417856665,
"y":1371.307773614024}],["23",{"height":364.29387989949146,
"id":"23",
"type":"move",
"width":560.3174396843217,
"x":8504.579826675303,
"y":895.9521036574282}],["24",{"height":70,
"id":"24",
"type":"move",
"width":452.38295543299574,
"x":8525.37131158561,
"y":750.1577155799959}],["25",{"height":627.5449987258946,
"id":"25",
"type":"move",
"width":656.2901839489764,
"x":8508.921533880524,
"y":33.1128528208483}],["26",{"height":2638.8246634703423,
"id":"26",
"type":"move",
"width":597.4848429750724,
"x":7298.223157616503,
"y":635.9431607396965}],["27",{"height":96.20000657624313,
"id":"27",
"type":"resize",
"width":639.3771655290545,
"x":640.746912343228,
"y":336.31002375020125}],["28",{"height":70,
"id":"28",
"type":"resize",
"width":340.3877148558831,
"x":642.1316323489541,
"y":242.3645801584595}],["29",{"height":70,
"id":"29",
"type":"move",
"width":276.15520013641077,
"x":645.5535693181614,
"y":150.09527131128857}],["30",{"height":70,
"id":"30",
"type":"move",
"width":451.6545319422894,
"x":632.7847579036414,
"y":57.58078317967244}],["31",{"height":387.551939036278,
"id":"31",
"type":"move",
"width":321.93450340095427,
"x":-3374.8465903800948,
"y":-2413.145006645941}],["32",{"height":645.8004526391443,
"id":"32",
"type":"move",
"width":536.443928756255,
"x":-2992.600828539551,
"y":-2418.131030766449}],["33",{"height":209.36982461610518,
"id":"33",
"type":"move",
"width":650.5923991799975,
"x":-2376.1911190518463,
"y":-2123.9582442068677}],["34",{"height":138.18868430329888,
"id":"34",
"type":"resize",
"width":469.742863990022,
"x":-1593.273430332463,
"y":-2099.768115799202}],["35",{"height":113.28232811967646,
"id":"35",
"type":"move",
"width":352.5737440268344,
"x":-1946.2167885344636,
"y":-2391.6683477443003}],["36",{"height":180.03286204972537,
"id":"36",
"type":"move",
"width":636.8880027057846,
"x":-1551.1994184877221,
"y":-2394.9311822894815}],["37",{"height":630.4882087634112,
"id":"37",
"type":"move",
"width":461.9396314336817,
"x":-862.7963683844885,
"y":-2402.617036060883}],["38",{"height":661.2789873781524,
"id":"38",
"type":"move",
"width":501.82395323116805,
"x":-330.05409055035784,
"y":-2398.546144124231}],["39",{"height":70,
"id":"39",
"type":"resize",
"width":639.7353003726989,
"x":632.1737140252922,
"y":-46.924354431543776}],["40",{"height":338.70411889625177,
"id":"40",
"type":"move",
"width":638.9432995712948,
"x":632.4954535450472,
"y":-415.36635604374686}],["41",{"height":463.08150368249875,
"id":"41",
"type":"resize",
"width":1052.4991117591662,
"x":7278.512002042041,
"y":57.4668063825128}],["42",{"height":2436.033763745912,
"id":"42",
"type":"move",
"width":789.5983953334382,
"x":6330.056503722133,
"y":37.426905624643496}],["43",{"height":70,
"id":"43",
"type":"move",
"width":311.201824194606,
"x":6322.299074139178,
"y":-129.87488878876312}],["44",{"height":70,
"id":"44",
"type":"move",
"width":295.82810286941094,
"x":6324.9074542554845,
"y":-247.14953857363517}],["45",{"height":70,
"id":"45",
"type":"move",
"width":348.51685746080403,
"x":6323.177415503593,
"y":-371.69868615693747}],["46",{"height":70,
"id":"46",
"type":"move",
"width":311.12868448816135,
"x":6323.376552887114,
"y":-501.3313181444578}],["47",{"height":251.52500051902172,
"id":"47",
"type":"move",
"width":485.6805974148579,
"x":6317.415339808059,
"y":-814.2784605686219}],["48",{"height":336.9946318134831,
"id":"48",
"type":"resize",
"width":838.1848377839993,
"x":6319.886319689069,
"y":-1206.2573243892139}],["49",{"height":70,
"id":"49",
"type":"move",
"width":832.0855389093537,
"x":5381.394274493182,
"y":-1216.7174501287072}],["50",{"height":70,
"id":"50",
"type":"move",
"width":787.3307506826404,
"x":5378.997158093108,
"y":-1116.517142865784}],["51",{"height":70,
"id":"51",
"type":"move",
"width":804.8201318048716,
"x":5378.555081870888,
"y":-1009.5724786567246}],["52",{"height":236.5035478893715,
"id":"52",
"type":"move",
"width":495.88925677771374,
"x":5374.954561157071,
"y":-899.7386103950724}],["53",{"height":150.4898010124258,
"id":"53",
"type":"move",
"width":467.95438873752437,
"x":5374.2298001406425,
"y":-605.1659329411649}],["54",{"height":91.02179458729198,
"id":"54",
"type":"move",
"width":303.54880744020994,
"x":5374.415554577652,
"y":-389.415311938386}],["55",{"height":240.3727611311777,
"id":"55",
"type":"move",
"width":586.7825938633548,
"x":5376.287799552474,
"y":-234.12207737041868}],["56",{"height":223.67630137703262,
"id":"56",
"type":"move",
"width":465.42070492785956,
"x":5371.418721790338,
"y":70.68296433936791}],["57",{"height":70,
"id":"57",
"type":"move",
"width":858.0997698006418,
"x":5378.158529287311,
"y":338.15019070147673}],["58",{"height":485.56335534057763,
"id":"58",
"type":"move",
"width":737.6069902879863,
"x":5375.575641501601,
"y":460.5792586764611}],["59",{"height":253.3203079355232,
"id":"59",
"type":"move",
"width":643.317177356375,
"x":5381.939094877153,
"y":999.2245503729386}],["60",{"height":657.887915108479,
"id":"60",
"type":"resize",
"width":683.4429559963137,
"x":5376.345862803593,
"y":1328.5560645826863}],["61",{"height":1312.3950064677542,
"id":"61",
"type":"resize",
"width":526.2910388567699,
"x":4264.858117775868,
"y":1614.3099841872443}],["62",{"height":165.9832440806398,
"id":"62",
"type":"resize",
"width":414.96099007778616,
"x":4275.186106358042,
"y":1371.0918635967985}],["63",{"height":1155.4559427010172,
"id":"63",
"type":"move",
"width":755.1934473031008,
"x":4228.7869778568265,
"y":-48.73328559348016}],["64",{"height":370.8965522933505,
"id":"64",
"type":"move",
"width":538.4334112682882,
"x":4225.843948132914,
"y":-484.73976844245027}],["65",{"height":70,
"id":"65",
"type":"move",
"width":278.872698226273,
"x":4222.121722743384,
"y":-1851.1915250320408}],["66",{"height":70,
"id":"66",
"type":"move",
"width":309.4505474977568,
"x":4224.381130346576,
"y":-1753.6130439818976}],["67",{"height":959.5495466136833,
"id":"67",
"type":"move",
"width":642.2201061594021,
"x":4222.3326572657015,
"y":-1513.625059101733}],["68",{"height":70,
"id":"68",
"type":"move",
"width":506.2679479981734,
"x":4228.546964006007,
"y":-1640.1177751779855}],["69",{"height":644.6994332768896,
"id":"69",
"type":"resize",
"width":791.2784185524754,
"x":3159.1971011827663,
"y":1353.9560380811583}],["70",{"height":207.6317083152975,
"id":"70",
"type":"move",
"width":790.9085345334883,
"x":3153.9368181478453,
"y":1084.3896501412485}],["71",{"height":437.5877489044971,
"id":"71",
"type":"resize",
"width":586.8537763461009,
"x":3152.5366366467642,
"y":597.8884464734178}],["72",{"height":513.524636473433,
"id":"72",
"type":"resize",
"width":483.86225903296855,
"x":3152.203530925641,
"y":40.65209337394881}],["73",{"height":172.2981963824166,
"id":"73",
"type":"resize",
"width":493.1174700015351,
"x":3149.1482453109766,
"y":-163.3421044487146}],["74",{"height":100.93240927839757,
"id":"74",
"type":"move",
"width":615.5716694823534,
"x":3151.422842878785,
"y":-328.72701777454597}],["75",{"height":872.877557736494,
"id":"75",
"type":"move",
"width":639.3699886641168,
"x":3150.3603312131067,
"y":-1268.5818753435683}],["76",{"height":102.59107917179662,
"id":"76",
"type":"move",
"width":272.795111437623,
"x":3147.9063482834144,
"y":-1430.5447796478034}],["77",{"height":208.09897498660263,
"id":"77",
"type":"resize",
"width":646.4875513646466,
"x":3149.4758657149428,
"y":-1678.2587117115813}],["78",{"height":261.7664407821467,
"id":"78",
"type":"move",
"width":365.42991228135213,
"x":1393.594053451045,
"y":-2124.018590499121}],["79",{"height":70,
"id":"79",
"type":"move",
"width":301.8599712148945,
"x":1395.609403354992,
"y":-1810.1267621206339}],["80",{"height":70,
"id":"80",
"type":"move",
"width":340.7209791094589,
"x":1404.9937644214444,
"y":-1700.5320882483743}],["81",{"height":70,
"id":"81",
"type":"move",
"width":278.88808464291924,
"x":1403.2849268687148,
"y":-1607.3407964754024}],["82",{"height":70,
"id":"82",
"type":"move",
"width":269.11695885596595,
"x":1400.5133331180825,
"y":-1519.8301641101662}],["83",{"height":70,
"id":"83",
"type":"resize",
"width":357.6581808994817,
"x":635.8716929732115,
"y":-533.2929529965764}],["84",{"height":146.57916572830172,
"id":"84",
"type":"move",
"width":558.0291873306553,
"x":1397.9291570897049,
"y":-1416.85445192222}],["85",{"height":163.8665310776039,
"id":"85",
"type":"move",
"width":374.98085747068205,
"x":1393.3005083447651,
"y":-1238.1528766423255}],["86",{"height":129.0169116590262,
"id":"86",
"type":"move",
"width":411.86967822552674,
"x":1391.2388049040633,
"y":-1035.5845562742581}],["87",{"height":123.38998690757167,
"id":"87",
"type":"move",
"width":396.8691657925175,
"x":1395.9363828873584,
"y":-860.6469150972766}],["88",{"height":131.92117740690065,
"id":"88",
"type":"move",
"width":511.6348217048189,
"x":1395.2566817090876,
"y":-707.7069936280119}],["89",{"height":70,
"id":"89",
"type":"move",
"width":394.8517855925852,
"x":1396.675831854208,
"y":-543.714156409503}],["90",{"height":329.27527504258353,
"id":"90",
"type":"move",
"width":621.8109376622743,
"x":1395.271589652189,
"y":-447.79312426864476}],["91",{"height":273.01974567854796,
"id":"91",
"type":"move",
"width":410.2493751673065,
"x":1402.9888071831501,
"y":-93.75087068724571}],["92",{"height":734.7166008228788,
"id":"92",
"type":"move",
"width":613.0566611201561,
"x":2228.8030606038506,
"y":-2025.8714958820651}],["93",{"height":2376.842007454378,
"id":"93",
"type":"resize",
"width":759.7536896943202,
"x":2224.120048178746,
"y":-1227.2947391641776}],["94",{"height":223.06514306553353,
"id":"94",
"type":"move",
"width":712.6983539782395,
"x":1395.2946073119683,
"y":242.31469672296106}],["95",{"height":70,
"id":"95",
"type":"move",
"width":562.4261678910132,
"x":-1257.6675498192442,
"y":-809.3831106213092}],["96",{"height":70,
"id":"96",
"type":"move",
"width":626.8249438679568,
"x":-1257.083942340122,
"y":-927.4583787765795}],["97",{"height":245.22451499449954,
"id":"97",
"type":"resize",
"width":649.1964349569269,
"x":-4598.405678638789,
"y":1380.0008698169586}],["98",{"height":70,
"id":"98",
"type":"resize",
"width":231.0952033118545,
"x":-3853.4244728578014,
"y":908.2727373166279}],["99",{"height":1154.2394417308553,
"id":"99",
"type":"resize",
"width":638.5088843496751,
"x":-3967.9357729609565,
"y":1991.3243052598268}],["100",{"height":176.06288070539483,
"id":"100",
"type":"move",
"width":603.7708281125009,
"x":-3805.606980642467,
"y":1633.719067508249}],["101",{"height":70,
"id":"101",
"type":"resize",
"width":686.8632662760192,
"x":-3142.0844171151466,
"y":2911.1422237176957}],["102",{"height":70,
"id":"102",
"type":"resize",
"width":500.8861844389513,
"x":-3144.434033945381,
"y":2810.7509242598558}],["103",{"height":70,
"id":"103",
"type":"resize",
"width":305.5949334123751,
"x":-3130.0289308256542,
"y":2700.302782127084}],["104",{"height":70,
"id":"104",
"type":"resize",
"width":299.608956266877,
"x":-3133.313755450351,
"y":2572.152980242054}],["105",{"height":2374.946087069018,
"id":"105",
"type":"resize",
"width":703.4725544421563,
"x":-2358.7391669111576,
"y":1310.2679712257157}],["106",{"height":70,
"id":"106",
"type":"resize",
"width":663.9990629476054,
"x":-2063.31739271153,
"y":280.34549932093626}],["107",{"height":70,
"id":"107",
"type":"move",
"width":710.3611808767307,
"x":-2050.3883139313457,
"y":172.74282606385867}],["108",{"height":70,
"id":"108",
"type":"move",
"width":637.2569940392284,
"x":-2051.6285687667123,
"y":54.48651875461434}],["109",{"height":70,
"id":"109",
"type":"resize",
"width":624.0035949557625,
"x":-2048.1439040926757,
"y":-43.314482084395365}],["110",{"height":70,
"id":"110",
"type":"move",
"width":618.7526720762562,
"x":-2043.836809379868,
"y":-156.94203258078784}],["111",{"height":70,
"id":"111",
"type":"resize",
"width":652.3910584404337,
"x":-2049.8637474268317,
"y":-267.489402542707}],["112",{"height":70,
"id":"112",
"type":"resize",
"width":630.6511550547664,
"x":-2051.68994717019,
"y":-366.41436897648197}],["113",{"height":70,
"id":"113",
"type":"resize",
"width":665.1015398023726,
"x":-2047.4478123280564,
"y":-482.6944475254086}],["114",{"height":70,
"id":"114",
"type":"move",
"width":678.4832731612793,
"x":-2044.9433540264608,
"y":-592.175392943758}],["115",{"height":70,
"id":"115",
"type":"move",
"width":294.47299767012794,
"x":-2045.0048106165007,
"y":-694.597365748833}],["116",{"height":70,
"id":"116",
"type":"move",
"width":527.4624004886335,
"x":-2048.2114076116877,
"y":-796.6187526847497}],["117",{"height":70,
"id":"117",
"type":"move",
"width":296.9414727557515,
"x":-2042.1072538799438,
"y":-902.6815738709054}],["118",{"height":70,
"id":"118",
"type":"move",
"width":265.7010289427581,
"x":-2040.3710166453925,
"y":-1018.9733590362822}],["119",{"height":70,
"id":"119",
"type":"move",
"width":648.4885814413961,
"x":-2040.3924942887347,
"y":-1132.540695606197}],["120",{"height":70,
"id":"120",
"type":"move",
"width":616.3644076682551,
"x":-2047.7906647168425,
"y":-1248.4941277891376}],["121",{"height":195.04002778917126,
"id":"121",
"type":"move",
"width":795.0430340513901,
"x":-2052.1084716898763,
"y":-1504.2815562765727}],["122",{"height":325.5929262310466,
"id":"122",
"type":"move",
"width":636.6590728327208,
"x":-2901.246631507637,
"y":-1516.4047914688183}],["123",{"height":1005.1200865578091,
"id":"123",
"type":"move",
"width":746.4301389065369,
"x":-2911.7479337584805,
"y":-1150.0937229468414}],["124",{"height":70,
"id":"124",
"type":"move",
"width":583.4391784549398,
"x":-2898.9322508558025,
"y":-98.21172652671578}],["125",{"height":70,
"id":"125",
"type":"move",
"width":578.4526631715379,
"x":-2901.669946985219,
"y":8.747772550033574}],["126",{"height":70,
"id":"126",
"type":"move",
"width":493.1783390024275,
"x":-2906.8456314982695,
"y":133.62679329792388}],["127",{"height":70,
"id":"127",
"type":"move",
"width":502.62324110325505,
"x":-2903.4852861542645,
"y":242.60669080846532}],["128",{"height":70,
"id":"128",
"type":"move",
"width":485.97491236766103,
"x":-2905.031622720898,
"y":362.46235010090896}],["129",{"height":70,
"id":"129",
"type":"move",
"width":784.3674956441321,
"x":-2910.9994999329124,
"y":476.32436540739184}],["130",{"height":70,
"id":"130",
"type":"move",
"width":351.379461795902,
"x":-2917.8797874045626,
"y":596.4355623268827}],["131",{"height":70,
"id":"131",
"type":"move",
"width":708.0046647910035,
"x":-2919.778960361134,
"y":694.746693147268}],["132",{"height":70,
"id":"132",
"type":"move",
"width":749.2760428756546,
"x":-2921.5519511112507,
"y":806.5106275055509}],["133",{"height":118.22357138329316,
"id":"133",
"type":"move",
"width":292.9612120920244,
"x":-2923.392713016195,
"y":913.3176901397537}],["134",{"height":145.58885771887677,
"id":"134",
"type":"resize",
"width":311.0148487082301,
"x":-2927.5535639138384,
"y":1055.7926780031755}],["135",{"height":127.99575510108697,
"id":"135",
"type":"move",
"width":261.63046386583346,
"x":-3579.5946117506737,
"y":1258.5209648600191}],["136",{"height":785.9113547530488,
"id":"136",
"type":"move",
"width":686.1050899116624,
"x":-3124.2641127105417,
"y":1637.355907678041}],["137",{"height":215.59382227481655,
"id":"137",
"type":"resize",
"width":549.1997702052288,
"x":-556.6292286514098,
"y":1342.6513103627558}],["138",{"height":179.28812151977667,
"id":"138",
"type":"move",
"width":468.87902145903854,
"x":-563.3311978033366,
"y":1111.2355447151117}],["139",{"height":447.0327891948782,
"id":"139",
"type":"move",
"width":397.8258219578094,
"x":-1461.1972267841516,
"y":580.8292668090605}],["140",{"height":70,
"id":"140",
"type":"move",
"width":295.7137600143371,
"x":-969.5440677133031,
"y":573.0323748437008}],["141",{"height":132.68495235630985,
"id":"141",
"type":"resize",
"width":504.05312980926533,
"x":-2081.6816848980593,
"y":1050.696788912919}],["142",{"height":70,
"id":"142",
"type":"resize",
"width":275.35267146434273,
"x":-968.9069711341804,
"y":471.83065786371543}],["143",{"height":70,
"id":"143",
"type":"resize",
"width":332.75637619000366,
"x":-967.1505901959188,
"y":370.17405940229895}],["144",{"height":70,
"id":"144",
"type":"resize",
"width":313.72621628701387,
"x":-976.4058087333451,
"y":266.14391136995357}],["145",{"height":70,
"id":"145",
"type":"resize",
"width":303.61948908176834,
"x":-973.3895671723913,
"y":159.9907937800325}],["146",{"height":80.86796547940673,
"id":"146",
"type":"resize",
"width":328.1471821358873,
"x":-972.6120809652264,
"y":49.925697075867674}],["147",{"height":404.0305157031885,
"id":"147",
"type":"move",
"width":576.9847218690289,
"x":-571.9967667188114,
"y":608.0670336769653}],["148",{"height":2120.75632678419,
"id":"148",
"type":"resize",
"width":841.8225930134754,
"x":-1454.070949552421,
"y":1065.6958247549303}],["149",{"height":70,
"id":"149",
"type":"move",
"width":334.98454177625206,
"x":159.44579804038574,
"y":1208.3050431592706}],["150",{"height":70,
"id":"150",
"type":"move",
"width":411.2260770795761,
"x":157.90138574317422,
"y":1327.7194236656935}],["151",{"height":533.4814938221897,
"id":"151",
"type":"move",
"width":534.0017977888907,
"x":147.75839106430357,
"y":2556.6286783471282}],["152",{"height":862.3917359071584,
"id":"152",
"type":"move",
"width":563.3677504045836,
"x":145.53697059841494,
"y":1654.06740306521}],["153",{"height":70,
"id":"153",
"type":"move",
"width":453.6331012558725,
"x":153.39914723652947,
"y":1424.1432155382097}],["154",{"height":72.47714399013827,
"id":"154",
"type":"move",
"width":379.11816292477204,
"x":155.72711108588794,
"y":1545.881605179679}],["155",{"height":586.3055765896821,
"id":"155",
"type":"resize",
"width":591.1679501418856,
"x":1216.9587587634915,
"y":2070.1636279818167}],["156",{"height":70,
"id":"156",
"type":"resize",
"width":342.8534047710336,
"x":1216.4479802101437,
"y":1972.3961297843848}],["157",{"height":73.15551261794153,
"id":"157",
"type":"resize",
"width":290.02946766894286,
"x":1223.0159955510962,
"y":1846.5009361048656}],["158",{"height":253.19889729231852,
"id":"158",
"type":"resize",
"width":475.663167906716,
"x":1224.9882203956156,
"y":1566.3025881499875}],["159",{"height":146.23349453060996,
"id":"159",
"type":"resize",
"width":382.9337371031307,
"x":1222.5011949865936,
"y":1381.9272789595964}],["160",{"height":254.78533097974935,
"id":"160",
"type":"resize",
"width":402.8645111495349,
"x":1230.2426399453893,
"y":1099.6754588332556}],["161",{"height":218.72427015255764,
"id":"161",
"type":"resize",
"width":861.9023773613956,
"x":1288.3455682731637,
"y":707.7859487533132}]]}},
"titles":{"map":{"__map":true,
"values":[["0",{"id":"0",
"state":false,
"title":"viewExit"}],["1",{"id":"1",
"state":false,
"title":"viewJoin"}],["2",{"id":"2",
"state":false,
"title":"newWindowRequest"}],["3",{"id":"3",
"state":false,
"title":"newId"}],["4",{"id":"4",
"state":false,
"title":"windows"}],["5",{"id":"5",
"state":false,
"title":"windowTypes"}],["6",{"id":"6",
"state":false,
"title":"positions"}],["7",{"id":"7",
"state":false,
"title":"padViews"}],["8",{"id":"8",
"state":false,
"title":"zIndex"}],["9",{"id":"9",
"state":false,
"title":"titles"}],["10",{"id":"10",
"state":false,
"title":"windowEnabled"}],["11",{"id":"11",
"state":false,
"title":"windowContentsModel"}],["12",{"id":"12",
"state":false,
"title":"padTitle"}],["13",{"id":"13",
"state":false,
"title":"docSeparators"}],["14",{"id":"14",
"state":false,
"title":"runRequest"}],["15",{"id":"15",
"state":false,
"title":"resetRequest"}],["16",{"id":"16",
"state":false,
"title":"render"}],["17",{"id":"17",
"state":false,
"title":"renkon"}],["18",{"id":"18",
"state":false,
"title":"searchPanel"}],["19",{"id":"19",
"state":false,
"title":"md"}],["20",{"id":"20",
"state":false,
"title":"css"}],["21",{"id":"21",
"state":false,
"title":"1"}],["22",{"id":"22",
"state":false,
"title":"goToVarName"}],["23",{"id":"23",
"state":false,
"title":"gotoDef"}],["24",{"id":"24",
"state":false,
"title":"gotoTarget"}],["25",{"id":"25",
"state":false,
"title":"allUseOf"}],["26",{"id":"26",
"state":false,
"title":"newEditor"}],["27",{"id":"27",
"state":false,
"title":"newWindowRequestFromView"}],["28",{"id":"28",
"state":false,
"title":"viewId"}],["29",{"id":"29",
"state":false,
"title":"isLocal"}],["30",{"id":"30",
"state":false,
"title":"initialWindowFromView"}],["31",{"id":"31",
"state":false,
"title":"padView"}],["32",{"id":"32",
"state":false,
"title":"modifierState"}],["33",{"id":"33",
"state":false,
"title":"titleChange"}],["34",{"id":"34",
"state":false,
"title":"_padTitleUpdater"}],["35",{"id":"35",
"state":false,
"title":"_focus"}],["36",{"id":"36",
"state":false,
"title":"readyMessages"}],["37",{"id":"37",
"state":false,
"title":"pinnedPositions"}],["38",{"id":"38",
"state":false,
"title":"windowContents"}],["39",{"id":"39",
"state":false,
"title":"initialHome"}],["40",{"id":"40",
"state":false,
"title":"runHandler"}],["41",{"id":"41",
"state":false,
"title":"hoverTooltip"}],["42",{"id":"42",
"state":false,
"title":"DependencyPlugin"}],["43",{"id":"43",
"state":false,
"title":"searchRequest"}],["44",{"id":"44",
"state":false,
"title":"searchUpdate"}],["45",{"id":"45",
"state":false,
"title":"toggleSearchPanel"}],["46",{"id":"46",
"state":false,
"title":"cursorChanged"}],["47",{"id":"47",
"state":false,
"title":"cursorState"}],["48",{"id":"48",
"state":false,
"title":"searchState"}],["49",{"id":"49",
"state":false,
"title":"_searchHandler"}],["50",{"id":"50",
"state":false,
"title":"_searchNext"}],["51",{"id":"51",
"state":false,
"title":"_searchClose"}],["52",{"id":"52",
"state":false,
"title":"searchInputHandler"}],["53",{"id":"53",
"state":false,
"title":"searchNextHandler"}],["54",{"id":"54",
"state":false,
"title":"searchCloseHandler"}],["55",{"id":"55",
"state":false,
"title":"getSearchRequest"}],["56",{"id":"56",
"state":false,
"title":"_searchFieldUpdate"}],["57",{"id":"57",
"state":false,
"title":"1"}],["58",{"id":"58",
"state":false,
"title":"1"}],["59",{"id":"59",
"state":false,
"title":"updateEditorSelection"}],["60",{"id":"60",
"state":false,
"title":"_scrollToEditorPosition"}],["61",{"id":"61",
"state":false,
"title":"searchCSS"}],["62",{"id":"62",
"state":false,
"title":"1"}],["63",{"id":"63",
"state":false,
"title":"analyzed"}],["64",{"id":"64",
"state":false,
"title":"line"}],["65",{"id":"65",
"state":false,
"title":"hovered"}],["66",{"id":"66",
"state":false,
"title":"hoveredB"}],["67",{"id":"67",
"state":false,
"title":"graph"}],["68",{"id":"68",
"state":false,
"title":"_graphRender"}],["69",{"id":"69",
"state":false,
"title":"saveData"}],["70",{"id":"70",
"state":false,
"title":"_saver2"}],["71",{"id":"71",
"state":false,
"title":"loader"}],["72",{"id":"72",
"state":false,
"title":"loadData"}],["73",{"id":"73",
"state":false,
"title":"nameFromUrl"}],["74",{"id":"74",
"state":false,
"title":"_loadFromUrl"}],["75",{"id":"75",
"state":false,
"title":"stringifyInner"}],["76",{"id":"76",
"state":false,
"title":"stringify"}],["77",{"id":"77",
"state":false,
"title":"stringifyCodeMap"}],["78",{"id":"78",
"state":false,
"title":"inputHandler"}],["79",{"id":"79",
"state":false,
"title":"playDown"}],["80",{"id":"80",
"state":false,
"title":"dismissDelayedButton"}],["81",{"id":"81",
"state":false,
"title":"playLeave"}],["82",{"id":"82",
"state":false,
"title":"playUp"}],["83",{"id":"83",
"state":false,
"title":"runRequestFromView"}],["84",{"id":"84",
"state":false,
"title":"playClickHandler"}],["85",{"id":"85",
"state":false,
"title":"playDownHandler"}],["86",{"id":"86",
"state":false,
"title":"playUpHandler"}],["87",{"id":"87",
"state":false,
"title":"playLeaveHandler"}],["88",{"id":"88",
"state":false,
"title":"resetRunnerHandler"}],["89",{"id":"89",
"state":false,
"title":"delayedPlayDown"}],["90",{"id":"90",
"state":false,
"title":"delayedButtonJudge"}],["91",{"id":"91",
"state":false,
"title":"delayed"}],["92",{"id":"92",
"state":false,
"title":"_positionsCss"}],["93",{"id":"93",
"state":false,
"title":"windowDOM"}],["94",{"id":"94",
"state":false,
"title":"windowElements"}],["95",{"id":"95",
"state":false,
"title":"_windowRender"}],["96",{"id":"96",
"state":false,
"title":"dblClick"}],["97",{"id":"97",
"state":false,
"title":"rawPadDown"}],["98",{"id":"98",
"state":false,
"title":"evCache"}],["99",{"id":"99",
"state":false,
"title":"padDown"}],["100",{"id":"100",
"state":false,
"title":"padUp"}],["101",{"id":"101",
"state":false,
"title":"downOrUpOrResize"}],["102",{"id":"102",
"state":false,
"title":"_padMove"}],["103",{"id":"103",
"state":false,
"title":"windowResize"}],["104",{"id":"104",
"state":false,
"title":"moveOrResize"}],["105",{"id":"105",
"state":false,
"title":"moveCompute"}],["106",{"id":"106",
"state":false,
"title":"addCode"}],["107",{"id":"107",
"state":false,
"title":"addRunner"}],["108",{"id":"108",
"state":false,
"title":"addDoc"}],["109",{"id":"109",
"state":false,
"title":"save"}],["110",{"id":"110",
"state":false,
"title":"load"}],["111",{"id":"111",
"state":false,
"title":"search"}],["112",{"id":"112",
"state":false,
"title":"home"}],["113",{"id":"113",
"state":false,
"title":"zoomIn"}],["114",{"id":"114",
"state":false,
"title":"zoomOut"}],["115",{"id":"115",
"state":false,
"title":"homeUponLoad"}],["116",{"id":"116",
"state":false,
"title":"navigationAction"}],["117",{"id":"117",
"state":false,
"title":"padViewChange"}],["118",{"id":"118",
"state":false,
"title":"wheeling"}],["119",{"id":"119",
"state":false,
"title":"queuedKeydown"}],["120",{"id":"120",
"state":false,
"title":"queuedKeyup"}],["121",{"id":"121",
"state":false,
"title":"_padViewUpdate"}],["122",{"id":"122",
"state":false,
"title":"wheel"}],["123",{"id":"123",
"state":false,
"title":"_handleWheel"}],["124",{"id":"124",
"state":false,
"title":"_1_0"}],["125",{"id":"125",
"state":false,
"title":"_1_0"}],["126",{"id":"126",
"state":false,
"title":"_1_0"}],["127",{"id":"127",
"state":false,
"title":"_1_0"}],["128",{"id":"128",
"state":false,
"title":"_1_0"}],["129",{"id":"129",
"state":false,
"title":"isSafari"}],["130",{"id":"130",
"state":false,
"title":"isMobile"}],["131",{"id":"131",
"state":false,
"title":"pointercancel"}],["132",{"id":"132",
"state":false,
"title":"lostpointercapture"}],["133",{"id":"133",
"state":false,
"title":"preventDefault"}],["134",{"id":"134",
"state":false,
"title":"preventDefaultSafari"}],["135",{"id":"135",
"state":false,
"title":"pointerLost"}],["136",{"id":"136",
"state":false,
"title":"_handleNavigationAction"}],["137",{"id":"137",
"state":false,
"title":"showGraph"}],["138",{"id":"138",
"state":false,
"title":"1"}],["139",{"id":"139",
"state":false,
"title":"resetHandler"}],["140",{"id":"140",
"state":false,
"title":"doReset"}],["141",{"id":"141",
"state":false,
"title":"_onInspect"}],["142",{"id":"142",
"state":false,
"title":"remove"}],["143",{"id":"143",
"state":false,
"title":"titleEditChange"}],["144",{"id":"144",
"state":false,
"title":"enabledChange"}],["145",{"id":"145",
"state":false,
"title":"pinRequest"}],["146",{"id":"146",
"state":false,
"title":"inspectRequest"}],["147",{"id":"147",
"state":false,
"title":"_goTo"}],["148",{"id":"148",
"state":false,
"title":"newRunner"}],["149",{"id":"149",
"state":false,
"title":"loadAtOnce"}],["150",{"id":"150",
"state":false,
"title":"loadEvent"}],["151",{"id":"151",
"state":false,
"title":"loadReceiver"}],["152",{"id":"152",
"state":false,
"title":"loadFromFile"}],["153",{"id":"153",
"state":false,
"title":"loadHandler"}],["154",{"id":"154",
"state":false,
"title":"loadFromProgram"}],["155",{"id":"155",
"state":false,
"title":"newDocPane"}],["156",{"id":"156",
"state":false,
"title":"separatorMove"}],["157",{"id":"157",
"state":false,
"title":"docUpdate"}],["158",{"id":"158",
"state":false,
"title":"updateMarkdownDom"}],["159",{"id":"159",
"state":false,
"title":"markdownUpdate"}],["160",{"id":"160",
"state":false,
"title":"initialDoc"}],["161",{"id":"161",
"state":false,
"title":"moveSeparator"}]]}},
"version":3,
"windowEnabled":{"map":{"__map":true,
"values":[]}},
"windowTypes":{"map":{"__map":true,
"values":[["0","code"],["1","code"],["2","code"],["3","code"],["4","code"],["5","code"],["6","code"],["7","code"],["8","code"],["9","code"],["10","code"],["11","code"],["12","code"],["13","code"],["14","code"],["15","code"],["16","code"],["17","code"],["18","code"],["19","code"],["20","code"],["21","code"],["22","code"],["23","code"],["24","code"],["25","code"],["26","code"],["27","code"],["28","code"],["29","code"],["30","code"],["31","code"],["32","code"],["33","code"],["34","code"],["35","code"],["36","code"],["37","code"],["38","code"],["39","code"],["40","code"],["41","code"],["42","code"],["43","code"],["44","code"],["45","code"],["46","code"],["47","code"],["48","code"],["49","code"],["50","code"],["51","code"],["52","code"],["53","code"],["54","code"],["55","code"],["56","code"],["57","code"],["58","code"],["59","code"],["60","code"],["61","code"],["62","code"],["63","code"],["64","code"],["65","code"],["66","code"],["67","code"],["68","code"],["69","code"],["70","code"],["71","code"],["72","code"],["73","code"],["74","code"],["75","code"],["76","code"],["77","code"],["78","code"],["79","code"],["80","code"],["81","code"],["82","code"],["83","code"],["84","code"],["85","code"],["86","code"],["87","code"],["88","code"],["89","code"],["90","code"],["91","code"],["92","code"],["93","code"],["94","code"],["95","code"],["96","code"],["97","code"],["98","code"],["99","code"],["100","code"],["101","code"],["102","code"],["103","code"],["104","code"],["105","code"],["106","code"],["107","code"],["108","code"],["109","code"],["110","code"],["111","code"],["112","code"],["113","code"],["114","code"],["115","code"],["116","code"],["117","code"],["118","code"],["119","code"],["120","code"],["121","code"],["122","code"],["123","code"],["124","code"],["125","code"],["126","code"],["127","code"],["128","code"],["129","code"],["130","code"],["131","code"],["132","code"],["133","code"],["134","code"],["135","code"],["136","code"],["137","code"],["138","code"],["139","code"],["140","code"],["141","code"],["142","code"],["143","code"],["144","code"],["145","code"],["146","code"],["147","code"],["148","code"],["149","code"],["150","code"],["151","code"],["152","code"],["153","code"],["154","code"],["155","code"],["156","code"],["157","code"],["158","code"],["159","code"],["160","code"],["161","code"]]}},
"windows":["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161"],
"zIndex":{"map":{"__map":true,
"values":[["0",100],["1",101],["2",261],["3",102],["4",105],["5",112],["6",111],["7",107],["8",110],["9",106],["10",103],["11",108],["12",109],["13",104],["14",113],["15",114],["16",115],["17",116],["18",117],["19",118],["20",119],["21",120],["22",121],["23",122],["24",125],["25",123],["26",124],["27",126],["28",127],["29",128],["30",129],["31",130],["32",131],["33",132],["34",133],["35",134],["36",135],["37",136],["38",137],["39",138],["40",139],["41",140],["42",141],["43",142],["44",143],["45",144],["46",145],["47",146],["48",147],["49",148],["50",149],["51",150],["52",151],["53",152],["54",153],["55",154],["56",155],["57",156],["58",157],["59",158],["60",159],["61",160],["62",161],["63",162],["64",163],["65",164],["66",165],["67",166],["68",167],["69",168],["70",169],["71",170],["72",171],["73",172],["74",173],["75",174],["76",175],["77",176],["78",177],["79",178],["80",179],["81",180],["82",181],["83",182],["84",183],["85",184],["86",185],["87",186],["88",187],["89",188],["90",189],["91",190],["92",193],["93",192],["94",191],["95",194],["96",195],["97",196],["98",197],["99",198],["100",199],["101",200],["102",201],["103",202],["104",203],["105",204],["106",205],["107",206],["108",207],["109",208],["110",209],["111",210],["112",211],["113",212],["114",213],["115",214],["116",215],["117",216],["118",217],["119",218],["120",219],["121",220],["122",221],["123",222],["124",223],["125",224],["126",225],["127",226],["128",227],["129",228],["130",229],["131",230],["132",231],["133",232],["134",233],["135",234],["136",235],["137",236],["138",241],["139",238],["140",239],["141",240],["142",246],["143",242],["144",243],["145",244],["146",245],["147",237],["148",247],["149",248],["150",250],["151",252],["152",253],["153",249],["154",251],["155",254],["156",255],["157",256],["158",257],["159",258],["160",259],["161",260]]}}}
{__codeMap: true, value: [[`0`, `const viewExit = Events.receiver({queued: true});`],
[`1`, `const viewJoin = Events.receiver({queued: true});`],
[`2`, `const newWindowRequest = ((newWindowRequestFromView, newId) => {
  if (newWindowRequestFromView.type === "initial") {
    if (newId !== 1) {return;}
    return {...newWindowRequestFromView, id: \`\${newId}\`, type: "code"};
  }
  return {...newWindowRequestFromView, id: \`\${newId}\`};
})(newWindowRequestFromView, newId);`],
[`3`, `const newId = Behaviors.select(
  0,
  loadHandler, (_prev, data) => {
    if (data.windows.length === 0) {return 1;}
    const max = Math.max(...data.windows.map((w) => Number.parseInt(w)));
    return max;
  },
  newWindowRequestFromView, (prev, _type) => prev + 1
);`],
[`4`, `const windows = Behaviors.select(
  [],
  loadHandler, (_prev, data) => {
    return data.windows;
  },
  newWindowRequest, (prev, spec) => [...prev, spec.id],
  remove, (prev, removeCommand) => prev.filter((e) => e != removeCommand.id),
);`],
[`5`, `const windowTypes = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, data) => {
    return data.windowTypes;
  },
  newWindowRequest, (prev, spec) => {
    prev.map.set(spec.id, spec.type);
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  }
);`],
[`6`, `const positions = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, data) => {
    return data.positions;
  },
  newWindowRequest, (prev, request) => {
    const padView = request.padView;
    const length = prev.map.size;
    const id = request.id;
    const newX = (length * 5 + 40) / padView.scale - padView.x;
    const newY = (length * 5 + 45) / padView.scale - padView.y;

    const newWindow = (id, type) => {
      return {
        id,
        x: newX,
        y: newY,
        width: type === "code" ? 300 : 800,
        height: type === "code" ? 200 : 400
      }
    };
    prev.map.set(id, newWindow(id, request.type));
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  },
  moveOrResize, (prev, command) => {
    const v = {...prev.map.get(command.id), ...command};
    prev.map.set(command.id, v);
    return {map: prev.map};
  }
);`],
[`7`, `const padViews = Behaviors.select(
  {map: new Map()},
  viewJoin, (prev, viewJoin) => {
    viewJoin.forEach((view) => prev.map.set(view, {x: 0, y: 0, scale: 1}));
    return {map: prev.map};
  },
  viewExit, (prev, viewExit) => {
    viewExit.forEach((view) => prev.map.delete(view));
    return {map: prev.map};
  },
  padViewChange, (prev, view) => {
    let {x, y, scale, viewId, force} = view;
    if (!force) {
      if (scale < 0.05) {
        x = prev.x;
        y = prev.y;
        scale = 0.05;
      }
      if (scale > 30) {
        x = prev.x;
        y = prev.y;
        scale = 30;
      }
    }
    let result = {...prev.map.get(viewId), ...{x, y, scale}};
    prev.map.set(viewId, result);
    return {map: prev.map};
  }
)`],
[`8`, `const zIndex = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, data) => {
    if (data.zIndex) return data.zIndex;
    return {map: new Map(data.windows.map((w, i) => [w, i + 100]))};
  },
  newWindowRequest, (prev, request) => {
    const id = request.id;
    const findMax = (map)  => {
      let maxId = -1;
      let max = -1;
      for (let [id, value] of map) {
        if (value > max) {
          maxId = id;
          max = value;
        }
      }
      return {maxId, max};
    };

    const {maxId:_maxId, max} = findMax(prev.map);
    let z = max < 0 ? 100 : max + 1;
    prev.map.set(id, z++);
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(\`\${remove.id}\`);
    return {map: prev.map};
  },
  moveOrResize, (prev, command) => {
    if (command.type === "move") {
      const z = prev.map.get(command.id);

      const findMax = (map)  => {
        let maxId = -1;
        let max = -1;
        for (let [id, value] of map) {
          if (value > max) {
            maxId = id;
            max = value;
          }
        }
        return {maxId, max};
      };

      const {maxId, max} = findMax(prev.map);
      if (maxId !== command.id) {
        prev.map.set(maxId, z);
        prev.map.set(command.id, max);
      }
      return {map: prev.map};
    }
    return prev;
  },
);`],
[`9`, `const titles = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, data) => {
    return data.titles || {map: new Map()};
  },
  newWindowRequest, (prev, request) => {
    const id = request.id;
    prev.map.set(id, {id, state: false, title: "untitled"});
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  },
  titleEditChange, (prev, change) => {
    const id = change.id;
    const v = {...prev.map.get(id), ...change};
    prev.map.set(id, v);
    return {map: prev.map};
  }
);`],
[`10`, `const windowEnabled = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, loaded) => {
    return loaded.windowEnabled || {map: new Map()};
  },
  newWindowRequest, (prev, request) => {
    const id = request.id;
    prev.map.set(id, {id, enabled: true});
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  },
  enabledChange, (prev, change) => {
    const id = change.id;
    const v = {...prev.map.get(id), ...change};
    prev.map.set(id, v);
    return {map: prev.map};
  }
);`],
[`11`, `const windowContentsModel = Behaviors.select(
  {map: new Map()},
  loadHandler, (prev, loaded) => {
    prev.map.clear();

    for (let [id, type] of loaded.windowTypes.map) {
      let elem;
      if (type === "runner") {
        elem = {type};
      } else if (type === "doc") {
        elem = {type, doc: window.CodeMirrorModel.create({doc: loaded.code.get(id), creator: "newDocPane", id})};
      } else if (type === "code") {
        elem = {type, doc: window.CodeMirrorModel.create({doc: loaded.code.get(id), creator: "newEditor", id})};
      } else {
        elem = {type, doc: loaded.code.get(id)};
      }
      prev.map.set(id, elem);
    }
    return {map: prev.map, loaded: true};
  },
  newWindowRequest, (prev, request) => {
    const id = request.id;
    const type = request.type;
    let elem;
    if (type === "runner") {
      elem = {type};
    } else if (type === "doc") {  
      elem = {type, doc: window.CodeMirrorModel.create({id, creator: "newDocPane", doc: \`# Hello\`})};
    } else if (type === "code") {
      elem = {type, doc: window.CodeMirrorModel.create({id, creator: "newEditor", doc: \`console.log("hello")\`})}
    }
    prev.map.set(id, elem);
    return {map: prev.map};
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  },
  resetRequest, (prev, resetRequest) => {
    const id = resetRequest.id;
    if (prev.map.get(id)?.type !== "runner") {console.log("inconsistent"); return prev;}
    return {map: prev.map};
  }
);`],
[`12`, `const padTitle = Behaviors.select(
  "untitled",
  loadHandler, (_prev, data) => {
    return data.padTitle || "untitled"
  },
  titleChange, (_prev, request) => request
);`],
[`13`, `const docSeparators = Behaviors.select(
  {map: new Map()},
  separatorMove, (prev, separatorMove) => {
    const id = separatorMove.id;
    const containerPosition = positions.map.get(id);
    const containerWidth = containerPosition.width;
    const newX = separatorMove.x;
    const docWidth = Math.min(containerWidth - 8, Math.max(newX - 8, 0));
    const editorWidth = Math.max(containerWidth - 22 - docWidth, 60);
    const editorRight = editorWidth === 60 ? -60 - 16 + (containerWidth - newX) : 0;
    prev.map.set(id, {docWidth, editorWidth, editorRight});
    return {map: prev.map};   
  },
  remove, (prev, remove) => {
    prev.map.delete(remove.id);
    return {map: prev.map};
  },
  moveOrResize, (prev, command) => {
    if (command.type !== "resize") {return prev;}
    const id = command.id;
    const winType = windowTypes.map.get(id);
    if (winType !== "doc") {return prev;}
    const containerPosition = positions.map.get(id);
    const containerWidth = containerPosition.width;
    const newX = containerWidth - 22;
    const docWidth = containerWidth - 8;
    const editorWidth = 60;
    const editorRight = -60;
    prev.map.set(id, {docWidth, editorWidth, editorRight});
    return {map: prev.map};
  }
)`],
[`14`, `const runRequest = Behaviors.keep(runRequestFromView);`],
[`15`, `const resetRequest = Behaviors.receiver();`],
[`16`, `const {h, html, render} = import("./preact.standalone.module.js");`],
[`17`, `const renkon = (() => {
  const renkon = document.createElement("div");
  renkon.id = "renkon";
  renkon.innerHTML = \`
<div id="buttonBox">
  <input class="menuButton" id="padTitle"></input>
  <button class="menuButton" id="addCodeButton">code</button>
  <button class="menuButton" id="addDocButton">doc</button>
  <button class="menuButton" id="addRunnerButton">runner</button>
  <div class="spacer"></div>
  <button class="menuButton" id="searchButton">search</button>
  <button class="menuButton" id="showGraph">show graph</button>
  <button class="menuButton" id="saveButton">save</button>
  <button class="menuButton" id="loadButton">load</button>
</div>
<div id="pad"><div id="mover"></div></div>
<div id="overlay"></div>
<div id="navigationBox">
  <div class="navigationButton"><div id="homeButton" class="navigationButtonImage"></div></div>
  <div class="navigationButton with-border"><div id="zoomInButton" class="navigationButtonImage"></div></div>
  <div class="navigationButton with-border"><div id="zoomOutButton" class="navigationButtonImage"></div></div>
</div>

\`.trim();

  document.body.querySelector("#renkon")?.remove();
  document.body.appendChild(renkon);
  return renkon;
})();`],
[`18`, `const searchPanel = ((renkon) => {
  let search = renkon.querySelector("#search");
  search?.remove();
  const div = document.createElement("div");
  div.innerHTML = \`
<div class="search-panels search-panels-bottom" style="bottom: 0px;">
  <div class="search-search search-panel">
    <input value="" placeholder="Find" aria-label="Find" class="search-textfield" name="search" form="" main-field="true">
    <button class="search-button" name="next" type="button">next</button>
    <!-- <button class="search-button" name="prev" type="button">previous</button>
    <button class="search-button" name="select" type="button">all</button> -->
    <label><input type="checkbox" name="case" form="">match case</label>
    <label><input type="checkbox" name="re" form="">regexp</label>
    <label><input type="checkbox" name="word" form="">by word</label>
    <!-- <input value="" placeholder="Replace" aria-label="Replace" class="search-textfield" name="replace" form="">
    <button class="search-button" name="replace" type="button">replace</button>
    <button class="search-button" name="replaceAll" type="button">replace all</button> -->
    <button name="close" aria-label="close" type="button">Ã—</button>
  </div>
</div>
\`.trim();
  search = div.childNodes[0];
  search.id = "search";
  renkon.appendChild(search);
  return search;
})(renkon);`],
[`19`, `const md = (() => {
  const script = document.createElement("script");
  script.id = "markdownit";
  script.src = "./markdown-it.min.js";
  const promise = new Promise((resolve) => {
    script.onload = () => {
       resolve(window.markdownit);
    };
  });

  document.head.querySelector("#markdownit")?.remove();
  document.head.appendChild(script);
  return promise.then((markdownit) => markdownit({html: true}));
})();`],
[`20`, `const css = \`
@font-face {
  font-family: "OpenSans-Regular";
  src: url("./assets/fonts/open-sans-v17-latin-ext_latin-regular.woff2") format("woff2");
}

@font-face {
  font-family: 'OpenSans-SemiBold';
  src: url("./assets/fonts/open-sans-v17-latin-ext_latin-600.woff2") format('woff2');
}

html, body, #renkon {
  overflow: hidden;
  height: 100%;
  margin: 0px;
}

html, body {
  overscroll-behavior-x: none;
  touch-action: none;
}

#pad {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0px;
  left: 0px;
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAjElEQVR4XuXQAQ0AAAgCQfoHpYbOGt5vEODSdgovd3I+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+wIcWxEeefYmM2dAAAAAASUVORK5CYII=);
}

#mover {
  pointer-events: none;
  position:absolute;
  transform-origin: 0px 0px;
}

#owner {
  position: absolute;
  pointer-events: initial;
}

.editor {
  height: 100%;
  border-radius: 0px 0px 6px 6px;
}

#overlay {
  pointer-events: none;
  height: 100%;
  width: 100%;
  position: absolute;
  top: 0px;
  left: 0px;
  z-index: 10000;
}

.window {
  position: absolute;
  transform-origin: 0px 0px;
  background-color: #eee;
  border-radius: 6px;
  box-shadow: inset 0 2px 2px 0 rgba(255, 255, 255, 0.8), 1px 1px 8px 0 rgba(0, 35, 46, 0.2);
}

.window[pinned="true"] {
  box-shadow: inset 0 4px 4px 0 rgba(255, 255, 255, 0.8), 8px 8px 8px 0 rgb(208 53 53 / 20%);
}

#buttonBox {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-end;
  row-gap: 8px;
  left: 0px;
  top: 0px;
  width: 100%;
  padding-bottom: 8px;
  padding-top: 8px;
  border-bottom: 1px solid black;
  background-color: white;
  position: absolute;
  z-index: 200000;
}

#padTitle {
  margin-left: 24px;
}

.spacer {
  flex-grow: 1;
}

.menuButton {
  font-family: 'OpenSans-SemiBold';
  color: black;
  margin-left: 4px;
  margin-right: 4px;
  border-radius: 4px;
  cursor: pointer;
  border: 2px solid #555;
}

.runnerIframe {
  width: 100%;
  height: 100%;
  border: 2px solid black;
  box-sizing: border-box;
  border-radius: 0px 0px 6px 6px;
  background-color: #fff;
  user-select: none;
}

.titleBar {
  background-color: #bbb;
  width: 100%;
  height: 28px;
  display: flex;
  /* border: 2px ridge #ccc;*/
  /* box-sizing: border-box; */
  border-radius: 6px 6px 0px 0px;
  cursor: -webkit-grab;
  cursor: grab;
  /*overflow: hidden;*/
}

.title {
  font-family: OpenSans-Regular;
  pointer-events: none;
  margin-right: 10px;
  margin-left: 10px;
  margin-top: 2px;
  padding-left: 10px;
  padding-right: 10px;
  max-width: calc(100% - 150px);
  text-wrap: nowrap;
}

.title[contentEditable="true"] {
  background-color: #eee;
  pointer-events: all;
  user-select: all;
}

.titleSpacer {
  flex-grow: 1;
  pointer-events: none;
}

.runButtonContainer {
  display: flex;
  flex-direction: column;
}

.titlebarButton {
  height: 19px;
  width: 19px;
  min-width: 19px;
  min-height: 19px;
  margin: 2px;
  margin-top: 4px;
  pointer-events: all;
  border-radius: 4px;
  background-position: center;
  cursor: pointer;
}

.titlebarButton:hover {
  background-color: #eee;
}

.closeButton {
  background-image: url("data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20data-name%3D%22Layer%201%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M8.48%2C12.25C6.4%2C10.17%2C4.37%2C8.16%2C2.35%2C6.15c-.34-.34-.68-.69-1-1.05a2.34%2C2.34%2C0%2C0%2C1%2C.17-3.26%2C2.3%2C2.3%2C0%2C0%2C1%2C3.25-.09C7%2C3.93%2C9.23%2C6.14%2C11.45%2C8.34a5.83%2C5.83%2C0%2C0%2C1%2C.43.58c.36-.4.62-.71.9-1%2C2-2%2C4.12-4%2C6.12-6.08a2.51%2C2.51%2C0%2C0%2C1%2C3.41%2C0%2C2.37%2C2.37%2C0%2C0%2C1%2C0%2C3.43c-2.18%2C2.22-4.39%2C4.41-6.58%2C6.62-.11.1-.21.22-.34.35l.44.48L22.09%2C19A2.7%2C2.7%2C0%2C0%2C1%2C23%2C20.56a2.49%2C2.49%2C0%2C0%2C1-1.29%2C2.54A2.36%2C2.36%2C0%2C0%2C1%2C19%2C22.69c-2-2-4-4-6.06-6-.33-.33-.62-.68-1-1.12-1.63%2C1.66-3.17%2C3.25-4.73%2C4.82-.79.8-1.6%2C1.59-2.42%2C2.36a2.32%2C2.32%2C0%2C0%2C1-3.21-.1%2C2.3%2C2.3%2C0%2C0%2C1-.19-3.25c2.14-2.2%2C4.31-4.36%2C6.48-6.54Z%22%20fill%3D%22%234D4D4D%22%2F%3E%3C%2Fsvg%3E");
}

.editButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3C!--%20Generator%3A%20Sketch%2064%20(93537)%20-%20https%3A%2F%2Fsketch.com%20--%3E%3Ctitle%3Eicon%2Fmaterial%2Fedit%3C%2Ftitle%3E%3Cdesc%3ECreated%20with%20Sketch.%3C%2Fdesc%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fedit%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-round-edit%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M3%2C17.46%20L3%2C20.5%20C3%2C20.78%203.22%2C21%203.5%2C21%20L6.54%2C21%20C6.67%2C21%206.8%2C20.95%206.89%2C20.85%20L17.81%2C9.94%20L14.06%2C6.19%20L3.15%2C17.1%20C3.05%2C17.2%203%2C17.32%203%2C17.46%20Z%20M20.71%2C7.04%20C20.8972281%2C6.85315541%2021.002444%2C6.59950947%2021.002444%2C6.335%20C21.002444%2C6.07049053%2020.8972281%2C5.81684459%2020.71%2C5.63%20L18.37%2C3.29%20C18.1831554%2C3.10277191%2017.9295095%2C2.99755597%2017.665%2C2.99755597%20C17.4004905%2C2.99755597%2017.1468446%2C3.10277191%2016.96%2C3.29%20L15.13%2C5.12%20L18.88%2C8.87%20L20.71%2C7.04%20Z%22%20id%3D%22Icon-Shape%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.runButton {
  display: none;
  pointer-events: none;
}

.runButtonBackground {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%2F%3E%3C!--%20Right-pointing%20triangle%20(play%20icon)%20--%3E%3Cpath%20d%3D%22M9%207L17%2012L9%2017Z%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}


.resetButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3C!--%20Box%20outline%20--%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%2F%3E%3C%2Fg%3E%3C!--%20Play%20triangle%20(moved%20upward)%20--%3E%3Cpath%20d%3D%22M9%206L17%2011L9%2016Z%22%20fill%3D%22%234D4D4D%22%2F%3E%3C!--%20Rewind%20arrow%20shaft%20(moved%20up%20to%20y%3D18)%20--%3E%3Cpath%20d%3D%22M18%2018%20L7%2018%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%221.2%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%3C!--%20Arrowhead%20(moved%20up%20accordingly)%20--%3E%3Cpath%20d%3D%22M7%2018%20L8.5%2016.5%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%221.2%22%20stroke-linecap%3D%22round%22%2F%3E%3Cpath%20d%3D%22M7%2018%20L8.5%2019.5%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%221.2%22%20stroke-linecap%3D%22round%22%2F%3E%3C%2Fsvg%3E");
}

.pinButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22%234D4D4D%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%221.8%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Scaled%20filled%20top%20--%3E%3Cellipse%20cx%3D%2212%22%20cy%3D%226.5%22%20rx%3D%223.2%22%20ry%3D%221.6%22%2F%3E%3C!--%20Scaled%20neck%20as%20filled%20trapezoid%20--%3E%3Cpolygon%20points%3D%229.8%2C8.3%2014.2%2C8.3%2014.8%2C11.5%209.2%2C11.5%22%2F%3E%3C!--%20Scaled%20filled%20base%20--%3E%3Cellipse%20cx%3D%2212%22%20cy%3D%2213.2%22%20rx%3D%225%22%20ry%3D%221.8%22%2F%3E%3C!--%20Scaled%20short%20pin%20--%3E%3Cline%20x1%3D%2212%22%20y1%3D%2214.9%22%20x2%3D%2212%22%20y2%3D%2220%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.pinButton[state="off"] {
  transform-origin: center;
  transform: rotate(40deg);
}

.runButton[type="runner"] {
  display: inherit;
  pointer-events: all;
}

.runButton2[delayed="true"] {
  display: inline;
  pointer-events: all;
}

.runButton2 {
  display: none;
  pointer-events: all;
  position: relative;
}

.runButton2[delayed="true"] {
  display: block;

}

.resizeHandler {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 6px;
  z-index: 10000;
  background-color: rgba(0.1, 0.1, 0.1, 0.03);
}

.resizeHandler[corner="bottomRight"] {
  cursor: se-resize;
  bottom: -15px;
  right: -15px;
}

.resizeHandler[corner="topLeft"] {
  cursor: nw-resize;
  top: -15px;
  left: -15px;
}

.resizeHandler[corner="bottomLeft"] {
  cursor: sw-resize;
  bottom: -15px;
  left: -15px;
}

.resizeHandler[corner="topRight"] {
  cursor: ne-resize;
  top: -15px;
  right: -15px;
}

.resizeHandler:hover {
  background-color: rgba(0.1, 0.4, 0.1, 0.3);
}

.windowHolder {
  height: calc(100% - 23px);
}

.windowHolder[blurred="true"] {
  filter: blur(4px)
}

#navigationBox {
  display: flex;
  flex-direction: column;
  right: 20px;
  gap: 10px;
  bottom: 80px;
  align-items: center;
  width: 40px;
  border: 1px solid black;
  background-color: #d2d2d2;
  position: absolute;
  z-index: 200000;
  border-radius: 8px;
  box-shadow: 4px 5px 8px -2px rgba(0,0,0,.15);
}

.navigationButton {
  width: 30px;
  height: 30px;
  display: flex;
  cursor: pointer;
}

.with-border {
  border: 1px solid #4D4D4D;
  border-radius: 15px;
  background-color: white;
}

.navigationButton:hover {
  background-color: #eaeaea;
}

.navigationButton:first-child {
  margin-top: 10px;
}

.navigationButton:last-child {
  margin-bottom: 10px;
}

.navigationButtonImage {
  width: 100%;
  height: 100%;
  background-position: center;
  background-repeat: no-repeat;
}

#zoomInButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-in%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-in%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-add%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2013%2013%2013%2013%2019%2011%2019%2011%2013%205%2013%205%2011%2011%2011%2011%205%2013%205%2013%2011%2019%2011%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#zoomOutButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-out%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-out%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-minus%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2012.998%205%2012.998%205%2010.998%2019%2010.998%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#homeButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fview-centered%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fview-centered%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22Group-3%22%20transform%3D%22translate(2.000000%2C%204.000000)%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M0%2C9%20L3%2C9%20L3%2C7%20L0%2C7%20L0%2C9%20Z%20M17%2C9%20L20.001%2C9%20L20.001%2C7%20L17%2C7%20L17%2C9%20Z%20M9%2C3%20L11%2C3%20L11%2C0%20L9%2C0%20L9%2C3%20Z%20M13%2C9%20L11%2C9%20L11%2C11%20L9%2C11%20L9%2C9%20L7%2C9%20L7%2C7%20L9%2C7%20L9%2C5%20L11%2C5%20L11%2C7%20L13%2C7%20L13%2C9%20Z%20M9%2C16%20L11%2C16%20L11%2C13%20L9%2C13%20L9%2C16%20Z%20M13%2C0%20L13%2C2%20L18%2C2%20L18%2C5%20L20%2C5%20L20%2C0%20L13%2C0%20Z%20M18%2C14%20L13%2C14%20L13%2C16%20L20%2C16%20L20%2C11%20L18%2C11%20L18%2C14%20Z%20M0%2C5%20L2%2C5%20L2%2C2%20L7%2C2%20L7%2C0%20L0%2C0%20L0%2C5%20Z%20M2%2C11%20L0%2C11%20L0%2C16%20L7%2C16%20L7%2C14%20L2%2C14%20L2%2C11%20Z%22%20id%3D%22Fill-1%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20stroke-width%3D%222%22%2F%3E%3C!--%20Thicker%20checkmark%20--%3E%3Cpath%20d%3D%22M5.5%2012.5L10.5%2017.5L18.5%207.5%22%20stroke-width%3D%223%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton[disabled="true"] {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%3C%2Fsvg%3E");
}

.inspectorButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Line%201%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%227%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%227%22%20x2%3D%2219%22%20y2%3D%227%22%2F%3E%3C!--%20Line%202%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2212%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2212%22%20x2%3D%2219%22%20y2%3D%2212%22%2F%3E%3C!--%20Line%203%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2217%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2217%22%20x2%3D%2219%22%20y2%3D%2217%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
  display: none;
  pointer-events: none;
}


.inspectorButton[type="runner"] {
  display: inherit;
  pointer-events: all;
}

.cm-tooltip-lint {
  font-size: 12px;
}

.cm-tooltip-dependency {
  background-color: #66b;
  color: white;
  border: none;
  padding: 2px 7px;
  border-radius: 4px;

}

.cm-tooltip-dependency {
  transform: translate(20px, 0px)
}

.cm-tooltip-cursor-wide {
  text-wrap: nowrap;
}

.dependency-link {
  border: 1px solid #66b;
}

.dependency-link:hover {
  border: 1px solid #cc7;
  border-style: outset;
  background-color: #88c;
}

.doc-container {
  display: flex;
  height: 100%;
}

.doc-result {
  height: 100%;
  width: calc(100% - 220px);
  overflow: scroll;
  scroll-behavior: smooth;
  font-size: 13px;
  border: 1px solid black;
  box-sizing: border-box;
  background-color: #fff;
}

.markdown {
  height: 100%;
}

.doc-separator {
  width: 8px;
  min-width: 8px;
  height: 100%;
  background-color: #f8f8f8;
}

.doc-separator:hover {
  background-color: #e8e8e8;
  cursor: ew-resize;
}

.doc-editor {
  width: 100%;
}

.doc-editor-container {
  position: fixed;
  right: 0px;
  height: calc(100% - 36px);
  width: 200px;
  border: 1px solid black;
  padding: 6px;
  min-width: 0px;
  background-color: white;
  white-space: pre-wrap;
  overflow: scroll;
}
\`;`],
[`21`, `((css, renkon) => {
  const style = document.createElement("style");
  style.id = "pad-css";
  style.textContent = css;
  renkon.querySelector("#pad-css")?.remove();
  renkon.appendChild(style);
})(css, renkon);`],
[`22`, `const goToVarName = Events.receiver();`],
[`23`, `const gotoDef = ((varName, windowContents) => {
  const editorsPair = [...windowContents.map].filter(([_id, content]) => content.state);

  for (const [id, content] of editorsPair) {
    try {
      const decls = Renkon.findDecls(content.state.doc.toString());
      for (const decl of decls) {
        if (decl.decls.includes(varName)) {
          return {id, range: {from: decl.start, to: decl.end}, shown: true};
        }
      }
    } catch(e) {
      console.log("Dependency analyzer encountered an error in source code:");
    }
  }
  return undefined;
})(goToVarName, windowContents);`],
[`24`, `const gotoTarget = Events.or(gotoDef, updateEditorSelection);`],
[`25`, `const allUseOf = (varName) => {
  const programState = new Renkon.constructor(0);
  programState.setLog(() => {});

  // There should be a better way... But this function is used in the function that computes
  // windowContents so there is a cyclic dependency
  const windowContents = Renkon.resolved.get("windowContents").value.map;

  const editorsPair = [...windowContents].filter(([_id, content]) => content.state);
  const uses = [];
  for (const [_id, content] of editorsPair) {
    try {
      const doc = content.state.doc.toString();
      const decls = programState.findDecls([doc]);
      for (const decl of decls) {
        programState.setupProgram([doc.slice(decl.start, decl.end)]);
        for (const jsNode of programState.nodes.values()) {
          for (const input of jsNode.inputs) {
            if (/^_[0-9]/.test(input)) {continue;}
            if (input === varName) {
              uses.push(...decl.decls);
            }
          }
        }
      }
    } catch (e) {
      console.log("Dependency analyzer encountered an error in source code:");
      return [];
    }
  }
  return uses;
};`],
[`26`, `const newEditor = (id, docModel) => {
  const mirror = window.CodeMirror;

  const config = {
    // eslint configuration
    languageOptions: {
      globals: window.RenkonWeb.globals,
      parserOptions: {
        ecmaVersion: 2022,
        sourceType: "module",
      },
    },
    rules: {
    },
  };

  const getDecl = (state, pos) => {
    const showDependency = Renkon.resolved.get("showGraph")?.value;
    if (!showDependency || showDependency !== "showDeps") {return;}
    let decls;
    try {
      decls = Renkon.findDecls(state.doc.toString());
    } catch(e) {
      console.log("Dependency analyzer encountered an error in source code:");
      return;
    }
    const head = pos !== undefined ? pos : state.selection.ranges[0]?.head;
    if (typeof head !== "number") {return;}
    const decl = decls.find((d) => d.start <= head && head < d.end);
    if (!decl) {return;}
    const programState = new Renkon.constructor(0);
    programState.setLog(() => {});
    try {
      programState.setupProgram([decl.code]);
    } catch (e) {
      console.log("could not find the declarations as there is a syntax error");
      return;
    }
    const keys = [...programState.nodes.keys()];
    const last = keys[keys.length - 1];
    const deps = [];
    for (const k of keys) {
      const is = programState.nodes.get(k).inputs;
      deps.push(...is.filter((n) => !/_[0-9]/.exec(n)));
    }

    return {deps, name: last}
  }
  const wordHover = hoverTooltip((view, pos, _side) => {
    let node = getDecl(view.state, pos);
    if (!node) return null;
    const {deps, name} = node;
    const uses = allUseOf(name);
    return {
      pos,
      above: true,
      create() {
        let dom = document.createElement("div");
        let children = deps.map((d) => {
          const c = document.createElement("span");
          c.textContent = d;
          c.onclick = (_evt) => Events.send(goToVarName, c.textContent);
          c.style.width = "fitContent";
          c.style.height = "fitContent";
          c.classList.add("dependency-link");
          return c;
        });
        children.forEach((c, i) => {
          dom.appendChild(c);
          if (i !== children.length - 1) {
            const comma = document.createElement("span");
            comma.textContent = ", ";
            dom.appendChild(comma);
          }
        });
        let tail = document.createElement("span");
        tail.textContent = \` -> \${name} -> \`;
        dom.appendChild(tail);

        children = uses.map((d) => {
          const c = document.createElement("span");
          c.textContent = d;
          c.onclick = (_evt) => Events.send(goToVarName, c.textContent);
          c.style.width = "fitContent";
          c.style.height = "fitContent";
          c.classList.add("dependency-link");
          return c;
        });
        children.forEach((c, i) => {
          dom.appendChild(c);
          if (i !== children.length - 1) {
            const comma = document.createElement("span");
            comma.textContent = ", ";
            dom.appendChild(comma);
          }
        });

        dom.className = "cm-tooltip-dependency cm-tooltip-cursor-wide";
        return {dom};
      }
    };
  }, {hoverTime: 1000, hideOnChange: true});

  const openSearch = ({_state, _dispatch }) => {
    Events.send(toggleSearchPanel, true);
    return true;
  };

  const search = {key: "Mod-f", run: openSearch, shift: openSearch};

  const cursorChange = mirror.view.ViewPlugin.fromClass(class {
    update(update) {
      if (update.selectionSet || update.docChanged) {
        this.reportCursor(update.view);
      }
    }

    reportCursor(view) {
      const pos = view.state.selection.main.head;
      Events.send(cursorChanged, {id: id, position: pos});
    }
  });

  const extensions = [
    mirror.view.keymap.of([search]),
    mirror.basicSetup,
    mirror["lang-javascript"].javascript({typescript: true}),
    mirror.EditorView.lineWrapping,
    mirror.EditorView.editorAttributes.of({"class": "editor"}),
    mirror.view.keymap.of([mirror.commands.indentWithTab]),
    mirror.lint.linter(
      mirror["lang-javascript"]
        .esLint(new mirror["eslint-linter-browserify"].Linter(), config)),
    wordHover,
    cursorChange,
  ];

  const editorView = window.CodeMirrorView.create(Renkon, docModel, extensions);
  const editor = editorView.editor;
  editor.dom.id = \`\${id}-editor\`;
  return editor;
};`],
[`27`, `const newWindowRequestFromView = ((viewId, type, padViews) => {
  return {viewId, type, padView: padViews.map.get(viewId) || padView};
})(viewId, Events.or(addCode, addRunner, addDoc, initialWindowFromView), padViews, padView);`],
[`28`, `const viewId = Renkon.app?.viewId || "local";`],
[`29`, `const isLocal = viewId === "local";`],
[`30`, `const initialWindowFromView = isLocal ? "initial" : undefined;`],
[`31`, `const padView = Behaviors.select(
  {x: 0, y: 0, scale: 1},
  padViewChange, (prev, view) => {
    let {x, y, scale, force} = view;
    if (!force) {
      if (scale < 0.05) {
        x = prev.x;
        y = prev.y;
        scale = 0.05;
      }
      if (scale > 30) {
        x = prev.x;
        y = prev.y;
        scale = 30;
      }
    }
    return {...prev, ...{x, y, scale}};
  }
);`],
[`32`, `const modifierState = Behaviors.select(
  {shiftKey: false, ctrlKey: false, metaKey: false, scrollDirection: null},
  // scrollDirection: null|"vertical"|"horizontal"
  queuedKeydown, (prev, keydown) => {
    const ret = {...prev};
    keydown.forEach((key) => {
      ret.shiftKey = ret.shiftKey || key.key === "Shift";
      ret.ctrlKey = ret.ctrlKey || key.key === "Control";
      ret.metaKey = ret.metaKey || key.key === "Meta";
    });
    return ret;
  },
  queuedKeyup, (prev, keyup) => {
    const ret = {...prev};
    let reset = false;
    keyup.forEach((key) => {
      reset = reset || ["Shift", "Control", "Meta"].includes(key.key);
      if (key.key === "Shift") {ret.shiftKey = false;}
      if (key.key === "Control") {ret.ctrlKey = false;}
      if (key.key === "Meta") {ret.metaKey = false;}
    });
    if (reset) {ret.scrollDirection = null;}
    return ret;
  },
  wheeling, (prev, wheeling) => {
    if (prev.scrollDirection === null && wheeling.scrollDirection) {
      const ret = {...prev};
      ret.scrollDirection = wheeling.scrollDirection;
      return ret;
    }
    return prev;
  }
);`],
[`33`, `const titleChange = Events.observe((notify) => {
  const change = (evt) => {
    notify(evt.target.value);
  };

  renkon.querySelector("#padTitle").addEventListener("input", change);
  return () => {renkon.querySelector("#padTitle").removeEventListener("change", change);}
});`],
[`34`, `const _padTitleUpdater = ((padTitle) => {
  if (renkon.querySelector("#padTitle").value !== padTitle) {
    renkon.querySelector("#padTitle").value = padTitle;
  }
})(padTitle);`],
[`35`, `const _focus = ((renkon) => {
  renkon.querySelector("#padTitle").focus();
  renkon.querySelector("#padTitle").blur();
})(renkon);`],
[`36`, `const readyMessages = Events.listener(
  window,
  "message",
  evt => {
    if (typeof evt.data.ready === "string" && evt.data.ready.startsWith("renkon-ready")) {
      return evt;
    }
  }, {queued: true});`],
[`37`, `const pinnedPositions = Behaviors.select(
  {map: new Map()},
  loadHandler, (_prev, _data) => {
    return {map: new Map()}
  },
  pinRequest, (prev, pinRequest) => {
    const {id} = pinRequest;
    if (prev.map.get(id)) {
      prev.map.delete(id);
      return {map: prev.map};
    }

    const position = positions.map.get(id);
    const screenRect = {
      height: position.height * padView.scale,
      width: position.width * padView.scale,
      x: (position.x + padView.x) * padView.scale,
      y: (position.y + padView.y) * padView.scale,
      scale: padView.scale
    };
    prev.map.set(id, screenRect);
    return {map: prev.map};
  },
  remove, (prev, request) => {
    prev.map.delete(request.id);
    return {map: prev.map};
  },
  home, (_prev, _home) => {
    return {map: new Map()}
  }
)`],
[`38`, `const windowContents = Behaviors.select(
  {map: new Map()},
  resetRequest, (prev, reset) => {
    prev.map.set(reset.id, newRunner(reset.id));
  },
  windowContentsModel, (prev, windowContentsModel) => {
    if (windowContentsModel.loaded) {
      prev.map.clear();
    }

    const prevKeys = [...prev.map.keys()];
    const newKeys = [...windowContentsModel.map.keys()];
    const olds = prevKeys.filter((e) => !newKeys.includes(e));
    const news = newKeys.filter((e) => !prevKeys.includes(e));
    olds.forEach((id) => prev.map.delete(\`\${id}\`));
    news.forEach((id) => {
      const {type, doc} = windowContentsModel.map.get(id);
      let elem;
      if (type === "runner") {
        elem = newRunner(id);
      } else if (type === "doc") {
        if (isLocal) {
          elem = doc;
        } else {
          elem = newDocPane(id, doc);
        }
      } else {
        elem = newEditor(id, doc);
      }
      prev.map.set(id, elem);
    });
    return {map: prev.map};
  }
);`],
[`39`, `const initialHome = (() => Events.send(homeUponLoad, "home"))(windowContents, loadHandler);`],
[`40`, `const runHandler = ((runRequest, windowContents, windowEnabled, titles) => {
  const id = runRequest.id;
  const iframe = windowContents.map.get(id);
  const enabled = [...windowContents.map]
    .filter(([id, obj]) => obj.state && windowEnabled.map.get(id)?.enabled !== false);
  const code = enabled
    .filter(([id, obj]) => titles.map.get(id).title !== "Croquet")
    .map(([_id, editor]) => editor.state.doc.toString());
  const croquet = enabled.find(([id, obj]) => {
    return titles.map.get(id).title === "Croquet"})?.[1].state.doc.toString();
  if (!croquet && !isLocal) {
    console.log("No Croquet spec found");
  }
  if (!iframe?.dom?.contentWindow) {/* console.log("iframe is not there yet"); */ return}
  iframe.dom.contentWindow.postMessage({code: code, croquet, path: id});
})(Events.or(runRequest, doReset), windowContents, windowEnabled, titles);`],
[`41`, `function hoverTooltip(source, options = {}) {
  let setHover = window.CodeMirror.state.StateEffect.define();
  let hoverState = window.CodeMirror.state.StateField.define({
    create() {
      return null;
    },
    update(value, tr) {
      for (let effect of tr.effects) {
        if (effect.is(setHover)) {
          // console.log("effect", effect)
          return effect.value;
        }
      }
    }
  })
  return {
    hoverState: hoverState,
    extension: [
      hoverState,
      window.CodeMirror.view.ViewPlugin.define(view => new DependencyPlugin(view, source, setHover, hoverState, {hoverTime: options.hoverTime || 300})),
    ]
  }
}`],
[`42`, `class DependencyPlugin {
  constructor(view, source, setHover, hoverState, options) {
    this.view = view;
    this.source = source;
    this.setHover = setHover;
    this.hoverState = hoverState;
    this.options = options;
    this.lastMove = {x: 0, y: 0, target: view.dom, time: 0};
    view.dom.addEventListener("mouseleave", this.mouseleave = this.mouseleave.bind(this));
    view.dom.addEventListener("mousemove", this.mousemove = this.mousemove.bind(this));
    this.hoverTimeout = -1;
    this.hoverTime = options.hoverTime;
  }

  checkHover() {
    this.hoverTimeout = -1;
    if (this.tooltip) return;
    let hovered = Date.now() - this.lastMove.time;
    if (hovered < this.hoverTime) {
      this.hoverTimeout = setTimeout(() => this.checkHover(), this.hoverTime - hovered);
    } else {
      this.startHover();
    }
  }

  startHover() {
    clearTimeout(this.restartTimeout);
    let {view, lastMove} = this;
    let desc = view.docView.tile.nearest(lastMove.target);
    if (!desc) return;
    let pos = view.posAtCoords(lastMove);

    if (pos === null) return;
    const posCoords = view.coordsAtPos(pos);
    if (!posCoords ||
      lastMove.y < posCoords.top || lastMove.y > posCoords.bottom ||
      lastMove.x < posCoords.left - view.defaultCharacterWidth ||
      lastMove.x > posCoords.right + view.defaultCharacterWidth) return;

    const line = view.state.doc.lineAt(pos);

    if (!this.tooltip) {
      const rect = view.dom.getBoundingClientRect();
      let scaleX = rect.width / view.dom.offsetWidth;
      let scaleY = rect.height / view.dom.offsetHeight;
      const tip = this.source(view, pos, 1);
      if (!tip) {return;}
      this.tooltip = tip.create();
      this.tooltip.dom.style.position = "absolute";
      this.tooltip.dom.classList.add("cm-tooltip-hover");
      this.tooltip.dom.classList.add("cm-tooltip-above");
      this.tooltip.dom.style.left = \`\${(posCoords.left - rect.left) / scaleX}px\`;
      this.tooltip.dom.style.top = \`\${(posCoords.top - rect.top) / scaleY}px\`;
      view.dom.appendChild(this.tooltip.dom);
      this.tooltipPos = {pos, posCoords, line};
      view.dispatch({effects: this.setHover.of({tooltip: this.tooltip, tooltipPos: this.tooltipPos})});
    }
  }

  endHover() {
    this.hoverTimeout = -1;
    if (this.tooltip) {
      this.tooltip.dom?.remove();
      this.tooltip = null;
      this.tooltipPos = null;
      // this.view.dispatch({effects: this.setHover.of(null)});
    }
  }

  update(update) {
    if (update.docChanged) {
      this.endHover();
    }
  }

  isInTooltip(tooltip, event) {
    const tooltipMargin = 4;
    let { left, right, top: top2, bottom } = tooltip.getBoundingClientRect();
    return event.clientX >= left - tooltipMargin &&
      event.clientX <= right + tooltipMargin &&
      event.clientY >= top2 - tooltipMargin &&
      event.clientY <= bottom + tooltipMargin;
  }

  distance(pos, move) {
    return Math.sqrt((pos.left - move.x) ** 2 + (pos.top - move.y) ** 2);
  }

  mousemove(event) {
    this.lastMove = {x: event.clientX, y: event.clientY, target: event.target, time: Date.now()};
    const view = this.view;
    if (this.hoverTimeout < 0) {
      this.hoverTimeout = setTimeout(() => this.checkHover(), this.hoverTime)
    }
    if (this.tooltip && !this.isInTooltip(this.tooltip.dom, event)) {
      const pos = view.posAtCoords(this.lastMove);
      if (pos) {
        const lastPos = this.tooltipPos;
        const line = view.state.doc.lineAt(pos);
        if (this.distance(lastPos.posCoords, this.lastMove) > 30 || lastPos.line.number !== line.number) {
          this.endHover();
        }
      }
    }
  }

  mouseleave(event) {
    clearTimeout(this.hoverTimeout);
    this.hoverTimeout = -1;
    let inTooltip = this.tooltip && this.tooltip.dom.contains(event.relatedTarget);
    if (!inTooltip) {
      this.endHover();
    } else {
      this.watchTooltipLeave(this.tooltip.dom);
    }
  }

  watchTooltipLeave(tooltip) {
    let watch = (_event) => {
      tooltip.removeEventListener("mouseleave", watch);
    }
    tooltip.addEventListener("mouseleave", watch);
  }

  destroy() {
    this.endHover();
    clearTimeout(this.hoverTimeout);
    this.view.dom.removeEventListener("mouseleave", this.mouseleave);
    this.view.dom.removeEventListener("mousemove", this.mousemove);
  }
}`],
[`43`, `const searchRequest = Events.receiver();`],
[`44`, `const searchUpdate = Events.receiver();`],
[`45`, `const toggleSearchPanel = Events.receiver();`],
[`46`, `const cursorChanged = Events.receiver();`],
[`47`, `const cursorState = Behaviors.select(
  {map: new Map()},
  cursorChanged, (prev, cursorChanged) => {
    const id = cursorChanged.id;
    const entry = prev.map.get(id);
    if (!entry || entry.position !== cursorChanged.position) {
      prev.map.set(id, cursorChanged);
      return {map: prev.map, change: id};
    }
    return prev;
  }
);`],
[`48`, `const searchState = Behaviors.select(
  {id: null, range: null, shown: false}, // id: string, editor: EditorView, range: {from: number, to: number}
  search, (prev, _search) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: !prev.shown}),
  toggleSearchPanel, (prev, panelState) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: panelState}),
  searchUpdate, (prev, searchUpdate) => searchUpdate,
  cursorState, (prev, cursorState) => {
    if (cursorState.change) {
      const cursor = cursorState.map.get(cursorState.change);
      return {
        id: cursorState.change,
        range: {from: cursor.position, to: cursor.position},
        shown: prev.shown}
    }
    return prev;
  }
);`],
[`49`, `const _searchHandler = Events.listener(searchPanel.querySelector(\`input[name="search"]\`), "keydown", searchInputHandler);`],
[`50`, `const _searchNext = Events.listener(searchPanel.querySelector(\`button[name="next"]\`), "click", searchNextHandler);`],
[`51`, `const _searchClose = Events.listener(searchPanel.querySelector(\`button[name="close"]\`), "click", searchCloseHandler);`],
[`52`, `const searchInputHandler = (evt) => {
  if (evt.key === "Enter") {
    evt.preventDefault();
    evt.stopPropagation();
    const searchRequest = getSearchRequest(evt.target.parentNode);
    if (searchRequest) {
      Events.send(searchRequest, searchRequest);
    }
  }
};`],
[`53`, `const searchNextHandler = (evt) => {
  const searchRequest = getSearchRequest(evt.target.parentNode);
  if (searchRequest) {
    Events.send(searchRequest, searchRequest);
  }
};`],
[`54`, `const searchCloseHandler = (_evt) => {
  Events.send(toggleSearchPanel, false);
};`],
[`55`, `const getSearchRequest = (searchPanel) => {
  const field = searchPanel.querySelector(\`input[name="search"]\`);
  const search = field?.value;
  const caseSensitive = searchPanel.querySelector(\`input[name="case"]\`)?.checked;
  const regexp = searchPanel.querySelector(\`input[name="re"]\`)?.checked;
  const wholeWord = searchPanel.querySelector(\`input[name="word"]\`)?.checked;
  if (search) {
    return {search, caseSensitive, regexp, wholeWord};
  }
  return null;
}`],
[`56`, `const _searchFieldUpdate = ((searchState) => {
  const searchField = renkon.querySelector("#search");
  if (!searchField) {return;}
  const oldStyle = searchField.style.display;
  const newStyle = searchState.shown ? "inherit" : "none";
  searchField.style.display = newStyle;
  if (newStyle !== oldStyle && newStyle === "inherit") {
    searchField.querySelector(\`input[name="search"]\`).focus();
  }
})(searchState);`],
[`57`, `renkon.querySelector("#search") && (renkon.querySelector("#search").style.display = searchState.shown ? "inherit" : "none");`],
[`58`, `((searchRequest, windowContents, searchState) => {
  const mirror = window.CodeMirror;
  const editorsPair = [...windowContents.map].filter(([_id, content]) => content.state)
  const query = new mirror.search.SearchQuery(searchRequest);
  const startEditorIndex = editorsPair.findIndex((e) => e[0] === searchState.id);
  let found = null;

  for (let i = startEditorIndex <= 0 ? 0 : startEditorIndex; i < editorsPair.length; i++) {
    const myRangeStart = startEditorIndex >= 0 && i === startEditorIndex ? searchState.range.to : 0;
    const targetPair = editorsPair[i];
    const cursor = query.getCursor(targetPair[1].state, myRangeStart);
    cursor.next();
    if (!cursor.done) {
      found = {id: targetPair[0], range: {from: cursor.value.from, to: cursor.value.to}, shown: true};
      break;
    }
  }
  if (found) {
    Events.send(searchUpdate, found);
  } else {
    Events.send(searchUpdate, {id: null, range: null, shown: true});
  }
})(searchRequest, windowContents, searchState)`],
[`59`, `const updateEditorSelection = ((searchUpdate, windowContents) => {
  if (!searchUpdate.id || !searchUpdate.range) {return;}
  const editor = windowContents.map.get(searchUpdate.id);
  const scrollIntoView = editor.scrollDOM.scrollHeight > editor.scrollDOM.clientHeight;
  editor.dispatch({
    changes: [], // no text change
    selection: {anchor: searchUpdate.range.from, head: searchUpdate.range.to},
    scrollIntoView: scrollIntoView,
  });
  editor.focus();
  return searchUpdate;
})(searchUpdate, windowContents);`],
[`60`, `const _scrollToEditorPosition = ((padView, positions, gotoTarget, windowContents, viewId) => {
  const pad = document.body.querySelector("#pad").getBoundingClientRect();

  const visiblePad = {
    x: -padView.x,
    y: -padView.y,
    width: pad.width / padView.scale,
    height: pad.height / padView.scale
  };
  const position = positions.map.get(\`\${gotoTarget.id}\`);

  const allVisible = position.x >= visiblePad.x && position.y >= visiblePad.y &&
        position.width + position.x <= visiblePad.x + visiblePad.width &&
        position.height + position.y <= visiblePad.y + visiblePad.height;

  if (allVisible) {return;}
  const editor = windowContents.map.get(gotoTarget.id);

  const textPos = editor.coordsAtPos(gotoTarget.range.from);
  if (!textPos) {return;}
  const scrollRect = editor.scrollDOM.getBoundingClientRect();
  const top = textPos.top - scrollRect.top + editor.scrollDOM.scrollTop;
  const targetY = position.y + top / padView.scale;
  let x = -position.x + 30;
  let y = padView.y;
  if (targetY < visiblePad.y) {
    y = -targetY + 50 / padView.scale;
  } else if (targetY - 50 > visiblePad.y + visiblePad.height) {
    y = -targetY + visiblePad.height / 2 / padView.scale;
  }

  Events.send(padViewChange, {x: x, y: y, scale: padView.scale, viewId})
})(padView, positions, gotoTarget, windowContents, viewId);`],
[`61`, `const searchCSS = \`
.search-panels {
  position: absolute;
  top: 40px;
  right: 10px;
  background-color: #f5f5f5;
  color: black;
  display: none;
  max-height: 30px;
}
    
.search-panels[open="true"] {
  display: inherit;
}
    
.search-panels-bottom {
  border-top: 1px solid #ddd;
}
    
.search-search {
  padding: 2px 6px 4px;
}
    
.search-search input, .search-search button, .search-search label {
  margin: .2em .6em .2em 0;
}

.search-textfield {
  background-color: white;
}

.search-textfield {
  vertical-align: middle;
  color: inherit;
  font-size: 70%;
  border: 1px solid silver;
  padding: .2em .5em;
}
    
.search-button {
  background-image: linear-gradient(#eff1f5, #d9d9df);
  border: 1px solid #888;
}

.search-button {
  vertical-align: middle;
  color: inherit;
  font-size: 70%;
  padding: .2em 1em;
  border-radius: 1px;
}
    
.search-search label {
  font-size: 80%;
  white-space: pre;
}
    
.search-search button[name="close"] {
  background-color: inherit;
  border: none;
  font: inherit;
  padding: 0;
  margin: 0;
}
    
.search-search button[name="close"]:hover {
  background-color: #eee;
}
\`.trim();`],
[`62`, `((css, renkon) => {
  const style = document.createElement("style");
  style.id = "search-css";
  style.textContent = css;
  renkon.querySelector("#search-css")?.remove();
  renkon.appendChild(style);
})(searchCSS, renkon);`],
[`63`, `const analyzed = ((windowContents, windowEnabled, trigger, showGraph) => {
  if (!showGraph) {return new Map()}
  if (trigger === null) {return new Map()}
  if (typeof trigger === "object" && trigger.id) {return new Map();}
  const programState = new Renkon.constructor(0);
  programState.setLog(() => {});

  const blockMap = new Map() // name -> blockId
  const nodes = new Map(); // blockId -> {exports:Set, imports: Set}
  const edges = new Map(); // blockId -> {edgesOut: [{id, dest}], edgesIn: [{id, origin}], exports: [id]}

  const code = [...windowContents.map].filter(
    ([id, editor]) => editor.state && windowEnabled.map.get(id)?.enabled !== false)
    .map(([id, editor]) => ({blockId: id, code: editor.state.doc.toString()}));
  try {
    code.forEach(info => {
      const blockId = info.blockId;
      programState.setupProgram([info.code]);
      nodes.set(blockId, {exports: new Set(), imports: new Set()});
      edges.set(blockId, {edgesOut: [], edgesIn: [], exports: []});
      const obj = nodes.get(blockId);
      for (const jsNode of programState.nodes.values()) {
        for (const input of jsNode.inputs) {
          if (/^_[0-9]/.test(input)) {continue;}
          obj.imports.add(input)
        }
        if (jsNode.outputs === "") {continue;}
        if (/^_[0-9]/.test(jsNode.outputs)) {continue;}
        blockMap.set(jsNode.outputs, blockId)
        obj.exports.add(jsNode.outputs);
      }
    });
  } catch(e) {
    console.log("Graph analyzer encountered an error in source code:");
    return new Map();
  }

  for (let [id, obj] of nodes) {
    for (const exported of obj.exports) {//exported:string
      const edgesOut = edges.get(id).edgesOut;
      const exports = edges.get(id).exports;
      for (let [importId, importObj] of nodes) {
        if (importId === id) {continue;}
        const edgesIn = edges.get(importId).edgesIn;
        if (importObj.imports.has(exported)) {
          if (edgesOut.findIndex((already) => already.id === exported && already.dest === importId) < 0) {
            edgesOut.push({id: exported, dest: importId});
            if (exports.indexOf(exported) < 0) {
              exports.push(exported);
            }
          }
          if (edgesIn.findIndex((already) => already.id === exported && already.origin === id) < 0) {
            edgesIn.push({id: exported, origin: id});
          }
        }
      }
    }
  }
  return edges;
})(windowContents, windowEnabled, Events.or(remove, hovered), showGraph === "showGraph");`],
[`64`, `const line = (p1, p2, color, label) => {
  let pl;
  let pr;
  if (p1.x < p2.x) {
    pl = p1;
    pr = p2;
  } else {
    pl = p2;
    pr = p1;
  }
  const c0 = \`\${pl.x} \${pl.y}\`;
  const c1 = \`\${pl.x + (pr.x - pl.x) * 0.5} \${pl.y + (pr.y - pl.y) * 0.2}\`;
  const c2 = \`\${pr.x - (pr.x - pl.x) * 0.2} \${pl.y + (pr.y - pl.y) * 0.6}\`;
  const c3 = \`\${pr.x} \${pr.y}\`;
  return html\`<path d="M \${c0} C \${c1} \${c2} \${c3}" stroke="\${color}"
    fill="transparent" stroke-width="2" stroke-linecap="round"></path><text
    x="\${p1.x + 5}" y="\${p1.y}">\${label}</text>\`;
};`],
[`65`, `const hovered = Events.receiver();`],
[`66`, `const hoveredB = Behaviors.keep(hovered);`],
[`67`, `const graph = ((positions, padView, analyzed, hoveredB, showGraph) => {
  if (hoveredB === null) {return [];}
  if (!showGraph) {return [];}

  const edges = analyzed.get(hoveredB);

  if (!edges) {return [];} // runner does not have edges

  const exportEdges = new Set();
  const importEdges = new Set();

  const outEdges = edges.edgesOut.map((edge) => {
    const ind = edges.exports.indexOf(edge.id);
    let p1 = positions.map.get(hoveredB);
    p1 = {x: p1.x + p1.width, y: p1.y};
    // p1 = {x: p1.x * padView.scale + padView.x, y: p1.y * padView.scale + padView.y};
    p1 = {x: (p1.x + padView.x) * padView.scale, y: (p1.y + padView.y) * padView.scale};
    p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
    let p2 = positions.map.get(edge.dest);
    p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
    p2 = {x: p2.x, y: p2.y + 10};
    let e = "";
    if (!exportEdges.has(edge.id)) {
      exportEdges.add(edge.id);
      e = edge.id;
    }
    return line(p1, p2, "#d88", e);
  });

  const inEdges = edges.edgesIn.map((edge) => {
    const exporter = analyzed.get(edge.origin);
    const ind = exporter.exports.indexOf(edge.id);
    let p1 = positions.map.get(edge.origin);
    p1 = {x: p1.x + p1.width, y: p1.y};
    p1 = {x: (p1.x + padView.x) * padView.scale , y: (p1.y + padView.y) * padView.scale};
    p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
    let p2 = positions.map.get(hoveredB);
    p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
    p2 = {x: p2.x, y: p2.y + 10};
    let e = "";
    if (!importEdges.has(edge.id)) {
      importEdges.add(edge.id);
      e = edge.id;
    }
    return line(p1, p2, "#88d", e);
  });

  return html\`<svg viewBox="0 0 \${window.innerWidth} \${window.innerHeight}"
                     xmlns="http://www.w3.org/2000/svg">\${outEdges}\${inEdges}</svg>\`;
})(positions, padView, Behaviors.keep(analyzed), hoveredB, showGraph === "showGraph");`],
[`68`, `const _graphRender = render(graph, document.querySelector("#overlay"));`],
[`69`, `const saveData = (windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
  const code = new Map(
    [...windowContents.map].map(([id, content]) => {
      if (content.state) {
        return [id, content.state.doc.toString()];
      } else if (content.editor) {
        let state = content.editor.editor?.state;
        if (!state) {
          state = content.editor.state;
        }
        return [id, state.doc.toString()];
      } else if (content.doc) {
        return [id, content.doc];
      } else {
        return null;
      }
    }).filter(item => item !== null));
  const myTitles = new Map([...titles.map].map(([id, obj]) => ([id, {...obj, state: false}])));
  const data1 = stringify({
    version: 3,
    windows,
    positions,
    zIndex,
    titles: {map: myTitles},
    windowTypes,
    padTitle,
    windowEnabled
  });

  const data2 = stringifyCodeMap(code);

  return encodeURIComponent(data1) + encodeURIComponent(data2);
};`],
[`70`, `const _saver2 = ((windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
  const data = saveData(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled);

  const dataStr = "data:text/plain;charset=utf-8," + data;
  const div = document.createElement("a");
  div.setAttribute("href", dataStr);
  div.setAttribute("download", \`\${padTitle}.renkon\`);
  div.click();
})(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled, save);`],
[`71`, `const loader = (() => {
  const input = document.createElement("div");
  input.innerHTML = \`<input id="imageinput" type="file" accept=".json,.renkon">\`;
  const imageInput = input.firstChild;

  imageInput.onchange = () => {
    const file = imageInput.files[0];
    if (!file) {imageInput.remove(); return;}
    new Promise(resolve => {
      let reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsArrayBuffer(file);
    }).then(async (data) => {
      const result = new TextDecoder("utf-8").decode(data);
    loadData(result, imageInput);
    });
    imageInput.value = "";
  };
  imageInput.oncancel = () => imageInput.remove();
  document.body.appendChild(imageInput);
  imageInput.click();
})(load);`],
[`72`, `const loadData = async (data, maybeImageInput) => {
  const array = new TextEncoder().encode(data);
  if (isLocal) {
    Events.send(loadAtOnce, {key: 1, array: [array], done: true});
    return;
  }
      
  let ind = 0;
  const key = Math.random();

  Events.send(loadEvent, {key, type: "loadStart"});
  const throttle = array.length > 80000;

  while (ind < array.length) {
    let buf = array.slice(ind, ind + 2880);
    Events.send(loadEvent, {key, type: "loadOne", array: buf});
    ind += 2880;
    if (throttle) {
      await new Promise((resolve) => {
        setTimeout(resolve, 16);
      });
    }
  }
  if (maybeImageInput) maybeImageInput.remove();
  Events.send(loadEvent, {key, type: "loadDone"});
}`],
[`73`, `const nameFromUrl = (() => {
  const maybeUrl = new URL(window.location).searchParams.get("file");
  if (maybeUrl) {
    return maybeUrl;
  }
  return undefined;
})();`],
[`74`, `const _loadFromUrl = fetch(nameFromUrl).then((resp) => resp.text()).then((result) => {
  loadData(result, null);
});`],
[`75`, `const stringifyInner = (node, seen) => {
  if (node === undefined) return undefined;
  if (typeof node === 'number') return Number.isFinite(node) ? \`\${node}\` : 'null';
  if (typeof node !== 'object') return JSON.stringify(node, null, 4);

  let out;
  if (Array.isArray(node)) {
    out = '[';
    for (let i = 0; i < node.length; i++) {
      if (i > 0) out += ',';
      out += stringifyInner(node[i], seen) || 'null';
    }
    return out + ']';
  }

  if (node === null) return 'null';

  if (seen.has(node)) {
    throw new TypeError('Converting circular structure to JSON');
  }

  seen.add(node);

  if (node.constructor === window.Map) {
    let replacement = {__map: true, values: [...node]};
    return stringifyInner(replacement, seen);
  }

  if (node.constructor === window.Set) {
    let replacement = {__set: true, values: [...node]};
    return stringifyInner(replacement, seen);
  }

  let keys = Object.keys(node).sort();
  out = '';
  for (let i = 0; i < keys.length; i++) {
    let key = keys[i];
    let value = stringifyInner(node[key], seen, out);
    if (!value) continue;
    if (out !== '') out += ',\\n';
    out += JSON.stringify(key) + ':' + value;
  }
  seen.delete(node);
  return '{' + out + '}';
}`],
[`76`, `const stringify = (obj) => {
  let seen = new Set();
  return stringifyInner(obj, seen);
}`],
[`77`, `const stringifyCodeMap = (map) => {
  const replace = (str) => {
    return str.replaceAll("\\\\", "\\\\\\\\").replaceAll("\`", "\\\\\`").replaceAll("\$", "\\\\\$");
  }

  return "\\n{__codeMap: true, value: " + "[" +
    [...map].map(([key, value]) => ("[" + "\`" + replace(key) + "\`" + ", " + "\`" +
                                    replace(value) + "\`" + "]")).join(",\\n") + "]" + "}"
}`],
[`78`, `const inputHandler = (evt) => {
  if (evt.key === "Enter") {
    evt.preventDefault();
    evt.stopPropagation();
    Events.send(titleEditChange, {
      id: \`\${Number.parseInt(evt.target.id)}\`,
      title: evt.target.textContent,
      state: false
    });
    evt.target.textContent = "";
  }
};`],
[`79`, `const playDown = Events.receiver();`],
[`80`, `const dismissDelayedButton = Events.receiver();`],
[`81`, `const playLeave = Events.receiver();`],
[`82`, `const playUp = Events.receiver();`],
[`83`, `const runRequestFromView = Events.receiver();`],
[`84`, `const playClickHandler = (evt, delayed) => {
  if (delayed) {
    return;
  }
  Events.send(runRequestFromView, {id: \`\${Number.parseInt(evt.target.id)}\`});
}`],
[`85`, `const playDownHandler = (evt) => {
  evt.stopPropagation();
  if (evt.isPrimary) {
      evt.target.setPointerCapture(evt.pointerId);
  }
  Events.send(playDown, evt);
};`],
[`86`, `const playUpHandler = (evt) => {
  evt.target.releasePointerCapture(evt.pointerId);
  // console.log(evt.target.id, evt.currentTarget.id)
  Events.send(playUp, evt);
};`],
[`87`, `const playLeaveHandler = (evt) => {
  // console.log("leave");
  // evt.target.releasePointerCapture(evt.pointerId);
  Events.send(playLeave, evt);
};`],
[`88`, `const resetRunnerHandler = (evt) => {
  // console.log("reset")
  Events.send(dismissDelayedButton, evt.target.id);
  Events.send(resetRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
}`],
[`89`, `const delayedPlayDown = Events.delay(playDown, 500);`],
[`90`, `const delayedButtonJudge = Events.select(
  {result: null, queue: []},
  playDown, (_prev, down) => ({result: null, queue: [down]}),
  playUp, (prev, up) => ({result: prev.result, queue: [up]}),
  playLeave, (prev, leave) => ({result: prev.result, queue: [...prev.queue, leave]}),
  delayedPlayDown, (prev, down) => {
    if (prev.queue.length === 0) return [];
    if (prev.queue.length === 1) {
      if (prev.queue[0] === down) {return {result: down, queue: [down]};}
      return {result: null, queue: []}
    }
    if ([prev.length - 1].type === "pointerup") {return {result: null, queue: []};}
    if ([prev.length - 1].type === "pointerleave") {return prev;}
  },
  dismissDelayedButton, (_prev, _dismiss) => ({result: null, queue: []})
);`],
[`91`, `const delayed = Behaviors.select(
  null,
  Events.or(delayedButtonJudge), (_prev, judge) => {
    const evt = judge.result;
    if (evt && evt.type === "pointerdown") {
      evt.target.releasePointerCapture(evt.pointerId);
      return \`\${Number.parseInt(evt.target.id)}\`;
    }
    return null;
  },
  playUp, (prev, _evt) => {return prev},
  playLeave, (prev, _evt) => {return prev}
)`],
[`92`, `const _positionsCss = ((positions, zIndex, pinnedPositions, padView) => {
  let style = document.body.querySelector("#positions-css");
  if (!style) {
    style = document.createElement("style");
    style.id = "positions-css";
    document.body.appendChild(style);
  }

  const css = [...positions.map].map(([id, rect]) => {
    let x;
    let y;
    let scale;
    const pinned = pinnedPositions.map.get(id);
    if (!pinned) {
      x = rect.x;
      y = rect.y;
      scale = 1;
    } else {
      // t(x) = pinned.x
      // t(a) = a * padView.scale + padView.x;
      // x * padView.scale + padView.x = pinned.x;
      // x = pinned.x / padView.scale - padView.x;
      scale = pinned.scale / padView.scale;
      x = pinned.x / padView.scale - padView.x;
      y = pinned.y / padView.scale - padView.y;
      // console.log(pinned.x, scale, x, padView.x);
    }
    return \`
[id="\${id}-win"] {
    transform: translate(\${x}px, \${y}px) scale(\${scale});
    width: \${rect.width}px;
    height: \${rect.height}px;
    z-index: \${zIndex.map.get(id)};
}\`.trim();
  }).join("\\n");
  style.textContent = css;
})(positions, zIndex, pinnedPositions, padView);`],
[`93`, `const windowDOM = (id, title, windowContent, type, windowEnabled, pinnedPosition, delayed) => {
  return h("div", {
    key: \`\${id}\`,
    id: \`\${id}-win\`,
    "class": "window",
    pinned: !!pinnedPosition,
    ref: (ref) => {
      if (ref) {
        const holder = ref.querySelector(".windowHolder");
        if (holder.firstChild && holder.firstChild !== windowContent.dom) {
          holder.firstChild.remove();
        }
        if (holder !== windowContent.dom.parentNode) {
          holder.appendChild(windowContent.dom);
        }
      }
    },
    onPointerEnter: (evt) => Events.send(hovered, \`\${Number.parseInt(evt.target.id)}\`),
    onPointerLeave: (_evt) => Events.send(hovered, null)
  }, [
    h("div", {
      id: \`\${id}-titleBar\`,
      "class": "titleBar",
    }, [
      h("div", {
        id: \`\${id}-enabledButton\`,
        disabled: !!(windowEnabled && !windowEnabled.enabled),
        style: {
          display: \`\${type !== "code" ? "none" : "inheirt"}\`
        },
        "class": "titlebarButton enabledButton",
        onClick: (evt) => {
          Events.send(enabledChange, {
            id: \`\${Number.parseInt(evt.target.id)}\`,
            enabled: !windowEnabled || !windowEnabled.enabled});
        },
      }),
      h("div", {
        id: \`\${id}-runButtonContainer\`,
        "class": "runButtonContainer",
      }, [
        h("div", {
          id: \`\${id}-runButton\`,
          "class": "titlebarButton runButtonBackground runButton",
          type,
          onClick: (evt) => playClickHandler(evt, delayed),
          onPointerDown: playDownHandler,
          onPointerUp: playUpHandler,
          onPointerLeave: playLeaveHandler,
        }),
        h("div", {
          id: \`\${id}-runButton2\`,
          "class": "titlebarButton resetButton runButton2",
          type,
          delayed: delayed === id,
          onPoionterUp: resetRunnerHandler,
          onClick: resetRunnerHandler,
        })
      ]),
      h("div", {
        id: \`\${id}-inspectorButton\`,
        "class": "titlebarButton inspectorButton",
        type,
        onClick: (evt) => {
          Events.send(inspectRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
        },
      }),
      h("div", {
        id: \`\${id}-title\`,
        "class": "title",
        contentEditable: \`\${title.state}\`,
        onKeydown: inputHandler,
      }, title.title),
      h("div", {
        id: \`\${id}-titleSpacer\`,
        "class": "titleSpacer",
      }),
      h("div", {
        id: \`\${id}-edit\`,
        "class": \`titlebarButton editButton\`,
        onClick: (evt) => {
          // console.log(evt);
          Events.send(titleEditChange, {id: \`\${Number.parseInt(evt.target.id)}\`, state: !title.state});
        },
      }, []),
      h("div", {
        id: \`\${id}-pin\`,
        "class": "titlebarButton pinButton",
        state: pinnedPosition ? "off" : "on",
        onClick: (evt) => {
          Events.send(pinRequest, {id: \`\${Number.parseInt(evt.target.id)}\`})
        }
      }),
      h("div", {
        id: \`\${id}-close\`,
        "class": "titlebarButton closeButton",
        onClick: (evt) => {
          Events.send(remove, {id: \`\${Number.parseInt(evt.target.id)}\`, type: "remove"})
        }
      }),
    ]),
    h("div", {
      id: \`\${id}-bottomRight-resize\`,
      corner: "bottomRight",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-topLeft-resize\`,
      corner: "topLeft",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-bottomLeft-resize\`,
      corner: "bottomLeft",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-topRight-resize\`,
      corner: "topRight",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-windowHolder\`,
      blurred: \`\${type !== "code" ? false : (windowEnabled ? !windowEnabled.enabled : false)}\`,
      "class": "windowHolder",
    }, [])
  ])
};`],
[`94`, `const windowElements = ((windows, titles, windowContents, windowTypes, windowEnabled, pinnedPositions, delayed) => {
  return h("div", {id: "owner", "class": "owner"}, windows.map((id) => {
    return windowDOM(
      id,
      titles.map.get(id), windowContents.map.get(id),
      windowTypes.map.get(id), windowEnabled.map.get(id),
      pinnedPositions.map.get(id), delayed)
  }));
})(windows, titles, windowContents, windowTypes, windowEnabled, pinnedPositions, delayed);`],
[`95`, `const _windowRender = render(windowElements, document.querySelector("#mover"));`],
[`96`, `const dblClick = Events.listener(renkon.querySelector("#pad"), "dblclick", (evt) => evt);`],
[`97`, `const rawPadDown = Events.listener(renkon.querySelector("#pad"), "pointerdown", (evt) => {
  const strId = evt.target.id;
  if (strId.endsWith("-title") && (evt.target.getAttribute("contenteditable") === "true")) {
    return evt;
  }
  if (strId) {
    evt.preventDefault();
    evt.stopPropagation();
  }
  return evt;
}, {queued: true});`],
[`98`, `const evCache = new Map();`],
[`99`, `const padDown = Events.collect(undefined, rawPadDown, (old, evts) => {
  let type;
  let id;
  let corner;
  if (evts.length <= 2 && evts[0].isPrimary) {
    let primary = evts[0];
    const strId = primary.target.id;
    if (!strId) {return {...old, type: ""};}
    let x = primary.clientX;
    let y = primary.clientY;
    if (strId === "pad") {
      type = "padDragDown";
      id = strId;
    } else {
      id = \`\${Number.parseInt(strId)}\`;
      if (strId.endsWith("-titleBar")) {
        type = "moveDown";
      } else if (strId.endsWith("-resize")) {
        corner = (/[0-9]+-(.*)-resize/.exec(strId))[1];
        type = "windowResizeDown";
      } else if (strId.endsWith("-doc-separator")) {
        type = "docSeparator";
      }
    }
    if (type) {
      primary.target.setPointerCapture(primary.pointerId);
      if (strId === "pad") {
        evCache.set("primary", {x, y});
      }
      if (evts.length === 1) {
        return {
          id, target: primary.target, type, x: primary.clientX, y: primary.clientY, corner
        };
      }
    } else {
      return {...old, type: ""};
    }
  }

  let secondary;
  if (evCache.get("primary")) {
    if (evts.length === 1 && evCache.size === 1 && !evts[0].isPrimary) {
      secondary = evts[0];
    }
    if (evts.length === 2 && evCache.size === 1 && !evts[1].isPrimary) {
      secondary = evts[1];
    }
  }
  if (!secondary) {return old;}

  const strId = secondary.target.id;
  if (strId !== "pad") {return {type: "stuck", secondary: secondary.pointerId};}
  let primary =  evCache.get("primary");
  let x = secondary.clientX;
  let y = secondary.clientY;
  let dx = primary.x - secondary.clientX;
  let dy = primary.y - secondary.clientY;
  let origDiff = Math.sqrt(dx * dx + dy * dy);
  evCache.set(secondary.pointerId, {origDiff, origScale: padView.scale, x, y});
  return {type: "pinch", secondary: secondary.pointerId};
});`],
[`100`, `const padUp = Events.listener(renkon.querySelector("#pad"), "pointerup", (evt) => {
  // console.log("ev1", evCache);
  evt.target.releasePointerCapture(evt.pointerId);
  evCache.clear();
  // console.log("ev2", evCache);
  return {type: "pointerup", x: evt.clientX, y: evt.clientY};
});`],
[`101`, `const downOrUpOrResize = Events.or(padDown, padUp, pointercancel, lostpointercapture, windowResize);`],
[`102`, `const _padMove = Events.listener("#pad", "pointermove", moveCompute);`],
[`103`, `const windowResize = Events.receiver();`],
[`104`, `const moveOrResize = Events.receiver();`],
[`105`, `const moveCompute = ((downOrUpOrResize, positions, padView, viewId) => {
  if (downOrUpOrResize.type === "moveDown" || downOrUpOrResize.type === "windowResizeDown") {
    const start = positions.map.get(downOrUpOrResize.id);
    const scale = padView.scale;
    const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
    const type = downOrUpOrResize.type === "moveDown" ? "move" : "resize";
    return (move) => {
      const diffX = (move.clientX - downPoint.x) / scale;
      const diffY = (move.clientY - downPoint.y) / scale;
      const result = {id: downOrUpOrResize.id, type};
      // const position = positions.map.get(downOrUpOrResize.id);
      if (type === "move") {
        if (pinnedPositions.map.get(downOrUpOrResize.id)) {return move;}
        result.x = start.x + diffX;
        result.y = start.y + diffY;
      } else {
        if (downOrUpOrResize.corner === "bottomRight") {
          const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
          const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
          result.width = start.width + realDiffX;
          result.height = start.height + realDiffY;
        } else if (downOrUpOrResize.corner === "topLeft") {
          const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
          const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
          result.width = start.width - realDiffX;
          result.height = start.height - realDiffY;
          result.x = start.x + realDiffX;
          result.y = start.y + realDiffY;
        } else if (downOrUpOrResize.corner === "topRight") {
          const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
          const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
          result.width = start.width + realDiffX;
          result.height = start.height - realDiffY;
          result.y = start.y + realDiffY;
        } else if (downOrUpOrResize.corner === "bottomLeft") {
          const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
          const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
          result.width = start.width - realDiffX;
          result.height = start.height + realDiffY;
          result.x = start.x + realDiffX;
        }
      }
      Events.send(moveOrResize, result);
      return move;
    }
  } else if (downOrUpOrResize.type === "padDragDown") {
    const start = padView;
    const scale = start.scale;
    const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
    const type = "padDrag";
    return (move) => {
      const diffX = move.clientX - downPoint.x;
      const diffY = move.clientY - downPoint.y;
      const result = {id: downOrUpOrResize.id, type, scale, viewId};
      result.x = start.x + (diffX / scale);
      result.y = start.y + (diffY / scale);
      Events.send(padViewChange, result);
      return move;
    };
  } else if (downOrUpOrResize.type === "docSeparator") {
    const start = positions.map.get(downOrUpOrResize.id);
    const scale = padView.scale;
    const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
    const scaledDownX =  downOrUpOrResize.x / scale - padView.x - start.x;
    const type = downOrUpOrResize.type;
    return (move) => {
      const winX = move.clientX / scale - padView.x - start.x;
      const result = {id: downOrUpOrResize.id, type};
      if (pinnedPositions.map.get(downOrUpOrResize.id)) {return move;}
      result.x = winX;
      result.startX = scaledDownX;
      Events.send(separatorMove, result);
      return move;
    }
  } else if (downOrUpOrResize.type === "pinch") {
    return (move) => {
      const keys = [...evCache.keys()];
      const primary = evCache.get("primary");
      if (!primary) {
        // the first finger has been lifted
        return move;
      }
      const otherKey = keys.find((k) => k !== "primary");
      const secondary = evCache.get(otherKey);
      const isPrimary = move.isPrimary;

      if (isPrimary) {
        const newRecord = {...primary};
        newRecord.x = move.clientX;
        newRecord.y = move.clientY;
        evCache.set("primary", newRecord);
      } else {
        const newRecord = {...secondary};
        newRecord.x = move.clientX;
        newRecord.y = move.clientY;
        evCache.set(otherKey, newRecord);
      }

      const origDiff = secondary.origDiff;
      const origScale = secondary.origScale;

      const pX = isPrimary ? move.clientX : primary.x;
      const pY = isPrimary ? move.clientY : primary.y;

      const sX = isPrimary ? secondary.x : move.clientX;
      const sY = isPrimary ? secondary.y : move.clientY;

      const newDiff = Math.sqrt((pX - sX) ** 2 + (pY - sY) ** 2);

      const newScale = (newDiff / origDiff) * origScale;

      const newCenterX = (pX - sX) / 2 + sX;
      const newCenterY = (pY - sY) / 2 + sY;

      const xInMover = (newCenterX / padView.scale) - padView.x;
      const newX = newCenterX / newScale - xInMover;

      const yInMover = (newCenterY / padView.scale) - padView.y;
      const newY = newCenterY / newScale - yInMover;

      Events.send(padViewChange, {x: newX, y: newY, scale: newScale, viewId});
      return move;
    }
  } else if (["pointerup", "lost", "stuck"].includes(downOrUpOrResize.type)) {
    return (move) => move;
  }
})(downOrUpOrResize, positions, padView, viewId);`],
[`106`, `const addCode = Events.listener(renkon.querySelector("#addCodeButton"), "click", () => "code");`],
[`107`, `const addRunner = Events.listener(renkon.querySelector("#addRunnerButton"), "click", () => "runner");`],
[`108`, `const addDoc = Events.listener(renkon.querySelector("#addDocButton"), "click", () => "doc");`],
[`109`, `const save = Events.listener(renkon.querySelector("#saveButton"), "click", (evt) => evt);`],
[`110`, `const load = Events.listener(renkon.querySelector("#loadButton"), "click", (evt) => evt);`],
[`111`, `const search = Events.listener(renkon.querySelector("#searchButton"), "click", (evt) => evt);`],
[`112`, `const home = Events.listener(renkon.querySelector("#homeButton"), "click", () => "home");`],
[`113`, `const zoomIn = Events.listener(renkon.querySelector("#zoomInButton"), "click", () => "zoomIn");`],
[`114`, `const zoomOut = Events.listener(renkon.querySelector("#zoomOutButton"), "click", () => "zoomOut");`],
[`115`, `const homeUponLoad = Events.receiver();`],
[`116`, `const navigationAction = Events.or(home, zoomIn, zoomOut, homeUponLoad);`],
[`117`, `const padViewChange = Events.receiver();`],
[`118`, `const wheeling = Events.receiver();`],
[`119`, `const queuedKeydown = Events.listener(document.body, "keydown", evt => evt, {queued: true});`],
[`120`, `const queuedKeyup = Events.listener(document.body, "keyup", evt => evt, {queued: true});`],
[`121`, `const _padViewUpdate = ((padView) => {
  const mover = document.querySelector("#mover");
  const pad = document.querySelector("#pad");
  mover.style.setProperty("transform", \`scale(\${padView.scale}) translate(\${padView.x}px, \${padView.y}px)\`);

  pad.style.setProperty("background-position", \`\${padView.x * padView.scale}px \${padView.y * padView.scale}px\`);
  pad.style.setProperty("background-size", \`\${64 * padView.scale}px \${64 * padView.scale}px\`);
})(padView);`],
[`122`, `const wheel = Events.listener(renkon.querySelector("#pad"), "wheel", (evt) => {
  let pinch;
  if (isSafari) {
    pinch = (Number.isInteger(evt.deltaX) && !Number.isInteger(evt.deltaY)) || evt.metaKey;
  } else {
    pinch = evt.ctrlKey || evt.metaKey;
  }
  const strId = evt.target.id;
  if (pinch) {
    evt.preventDefault();
    if (strId === "pad") {
      evt.stopPropagation();
    }
  }
  return evt;
});`],
[`123`, `const _handleWheel = ((wheel, padView, modifierState, viewId) => {
  let pinch;
  if (isSafari) {
    pinch = (Number.isInteger(wheel.deltaX) && !Number.isInteger(wheel.deltaY)) || wheel.metaKey;
  } else {
    pinch = wheel.ctrlKey || wheel.metaKey;
  }

  const shiftKey = modifierState.shiftKey;
  const scrollDirection = modifierState.scrollDirection;
  const strId = wheel.target.id;

  let deltaX = wheel.deltaX;
  let deltaY = wheel.deltaY;
  let zoom = padView.scale;

  let absDeltaY = Math.min(30, Math.abs(deltaY));
  let diff = Math.sign(deltaY) * absDeltaY;

  let desiredZoom = zoom * (1 - diff / 50);

  const xInMover = (wheel.clientX / padView.scale) - padView.x;
  const newX = wheel.clientX / desiredZoom - xInMover;

  const yInMover = (wheel.clientY / padView.scale) - padView.y;
  const newY = wheel.clientY / desiredZoom - yInMover;

  if (scrollDirection === null && shiftKey) {
    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      Events.send(wheeling, {scrollDirection: "horizontal"});
      deltaY = 0;
    } else {
      Events.send(wheeling, {scrollDirection: "vertical"});
      deltaX = 0;
    }
  } else if (scrollDirection !== null && shiftKey) {
    if (scrollDirection === "vertical") {
      deltaX = 0;
    }
    if (scrollDirection === "horizontal") {
      deltaY = 0;
    }
  }

  if (pinch) {
    Events.send(padViewChange, {x: newX, y: newY, scale: desiredZoom, viewId});
  } else {
    if (strId === "pad") {
      Events.send(padViewChange, {x: padView.x - deltaX / padView.scale,
                                  y: padView.y - deltaY / padView.scale, scale: padView.scale, viewId});
    }
  }
})(wheel, padView, modifierState, viewId);`],
[`124`, `Events.listener(renkon.querySelector("#buttonBox"), "wheel", preventDefault);`],
[`125`, `Events.listener(renkon.querySelector("#navigationBox"), "wheel", preventDefault);`],
[`126`, `Events.listener(document.body, "gesturestart", preventDefaultSafari);`],
[`127`, `Events.listener(document.body, "gesturechange", preventDefaultSafari);`],
[`128`, `Events.listener(document.body, "gestureend", preventDefaultSafari);`],
[`129`, `const isSafari = window.navigator.userAgent.includes("Safari") && !window.navigator.userAgent.includes("Chrome");`],
[`130`, `const isMobile = !!("ontouchstart" in window);`],
[`131`, `const pointercancel = Events.listener(renkon.querySelector("#pad"), "pointercancel", pointerLost);`],
[`132`, `const lostpointercapture = Events.listener(renkon.querySelector("#pad"), "lostpointercapture", pointerLost);`],
[`133`, `const preventDefault = (evt) => {
  evt.preventDefault();
  return evt;
};`],
[`134`, `const preventDefaultSafari = (evt) => {
  if (!isSafari || isMobile) {
    evt.preventDefault();
  }
  return evt;
};`],
[`135`, `const pointerLost = (evt) => {
  evCache.clear();
  evt.preventDefault();
  return {type: "lost"};
};`],
[`136`, `const _handleNavigationAction = ((navigationAction, positions, padView, viewId) => {
  if (navigationAction === "zoomIn" || navigationAction === "zoomOut") {
    const pad = document.body.querySelector("#pad").getBoundingClientRect();
    const newScale = padView.scale * ( navigationAction === "zoomIn" ? 1.1 : 0.9);
    const centerX = pad.width / 2 / padView.scale - padView.x;
    const centerY = pad.height / 2 / padView.scale - padView.y;
    const newX = pad.width / 2 / newScale - centerX;
    const newY = pad.height / 2 / newScale - centerY;
    // const newX = (padView.x - (pad.width / 2)) * (newScale / padView.scale) + pad.width / 2;
    // const newY = (padView.y - (pad.height / 2)) * (newScale / padView.scale) + pad.height / 2;
    Events.send(padViewChange, {x: newX, y: newY, scale: newScale});
  } else if (navigationAction === "home") {
    let minLeft = Number.MAX_VALUE;
    let minTop = Number.MAX_VALUE;
    let maxRight = Number.MIN_VALUE;
    let maxBottom = Number.MIN_VALUE;

    if (positions.map.size === 0) {
      Events.send(padViewChange, {x: 0, y: 0, scale: 1, viewId});
      return;
    }
    for (let [_, position] of positions.map) {
      minLeft = Math.min(position.x, minLeft);
      minTop = Math.min(position.y, minTop);
      maxRight = Math.max(position.x + position.width, maxRight);
      maxBottom = Math.max(position.y + position.height, maxBottom);
    }

    const pad = document.body.querySelector("#pad").getBoundingClientRect();

    const scaleX = pad.width / (maxRight - minLeft);
    const scaleY = pad.height / (maxBottom - minTop);
    const scale = Math.min(1, scaleX, scaleY) * 0.9;

    const centerX = (maxRight + minLeft) / 2;
    const centerY = (maxBottom + minTop) / 2;
    let x = (pad.width / 2 / scale - centerX);
    let y = (pad.height / 2 / scale - centerY);
    Events.send(padViewChange, {x, y, scale, force: true, viewId});
  }
})(navigationAction, positions, padView, viewId);`],
[`137`, `const showGraph = Behaviors.collect(
  "showDeps",
  Events.listener(renkon.querySelector("#showGraph"), "click", (evt) => evt),
  (now, _click) => {
    if (now === "showGraph") {return "hide";}
    if (now === "showDeps") {return "showGraph";}
    if (now === "hide") {return "showDeps"}
    return now;
  }
);`],
[`138`, `((showGraph) => {
  let str;
  if (showGraph === "showGraph") {str = "show graph";}
  if (showGraph === "showDeps") {str = "show deps";}
  if (showGraph === "hide") {str = "hide graph"}
  document.querySelector("#showGraph").textContent = str;
})(showGraph);`],
[`139`, `const resetHandler = Events.select(
  {},
  resetRequest, (prev, reset) => {
    if (prev.ready) {
      if (prev.ready.includes(reset.id)) {
        Events.send(doReset, reset);
        return {};
      }
    }
    return {resetRequest: reset};
  },
  readyMessages, (prev, ready) => {
    const readyIds = ready.map((r) => r.data.id);
    if (prev.resetRequest) {
      if (readyIds.includes(prev.resetRequest.id)) {
        Events.send(doReset, prev.resetRequest);
      }
    }
    return {};
  },
  windowContents, (_prev, _win) => ({})
);`],
[`140`, `const doReset = Events.receiver();`],
[`141`, `const _onInspect = ((inspectRequest) => {
  const id = inspectRequest.id;
  const iframe = windowContents.map.get(id);
  iframe.dom.contentWindow.postMessage({inspector: true, path: id});
})(inspectRequest);`],
[`142`, `const remove = Events.receiver();`],
[`143`, `const titleEditChange = Events.receiver();`],
[`144`, `const enabledChange = Events.receiver();`],
[`145`, `const pinRequest = Events.receiver();`],
[`146`, `const inspectRequest = Events.receiver();`],
[`147`, `const _goTo = ((padView, positions, dblClick, viewId) => {
  const strId = dblClick.target.id;
  if (!strId.endsWith("-titleBar")) {return;}
  const id = Number.parseInt(strId);
  const position = positions.map.get(\`\${id}\`);

  const pad = document.body.querySelector("#pad").getBoundingClientRect();

  const scaleX = pad.width / position.width;
  const scaleY = pad.height / position.height;
  const scale = Math.min(scaleX, scaleY) * 0.95;

  const centerX = position.x + position.width / 2;
  const centerY = position.y + position.height / 2;

  const x = pad.width / 2 / scale - centerX;
  const y = pad.height / 2 / scale - centerY;

  Events.send(padViewChange, {x, y, scale, viewId});
})(padView, positions, dblClick, viewId);`],
[`148`, `const newRunner = (id) => {
  const runnerIframe = document.createElement("iframe");
  runnerIframe.srcdoc = \`
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      .dock {
        position: fixed;
        top: 0px;
        right: 0px;
        width: 35%;
        height: 80%;
        display: flex;
        box-shadow: 10px 10px 5px #4d4d4d, -10px -10px 5px #dddddd;
        transition: left 0.5s;
        background-color: white;
        z-index: 1000000;
        overflow-y: scroll;
      }

      .dock #inspector {
        flex-grow: 1;
        margin: 0px 20px 0px 20px;
        background-color: #ffffff;
        border: 1px solid black;
      }
    </style>
    <script type="module">
      import {ProgramState, globals} from "./renkon-core.js";
      import {newInspector} from "./renkon-inspector.js";
      import {startWithCodeMirrorWithCroquet, startWithCodeMirrorNoCroquet,
              parse, splitStrs, toFunction, parseCroquet} from "./loader.js";
      window.RenkonWeb = {globals};
      let prevSession;
      let prevView;

      window.onmessage = async (evt) => {
        let promise;
        let croquet;
        if (evt.data.croquet) {
          croquet = parseCroquet(evt.data.croquet);
        }
        if (evt.data && Array.isArray(evt.data.code)) {
          if (!croquet?.parameters?.appParameters?.name) {
              startWithCodeMirrorNoCroquet({code: evt.data.code.map((c, i) => ([(i).toString(), c])), ProgramState});
          } else {
            if (!prevView) {
              const obj = await startWithCodeMirrorWithCroquet({
                code: evt.data.code.map((c, i) => ([(i).toString(), c])), ProgramState, croquet, options: {}});
              const {CodeMirror, CodeMirrorModel, CodeMirrorView, session} = obj;
              prevSession = session;
              prevView = session.view;
            } else {
              const func = toFunction(evt.data.code, prevSession.name);
              const strs = splitStrs(func, new Map(croquet.realm.model.map((key) => [key, "Model"])));
              const {viewNodeStr, modelEventsStr} = strs;
              prevView.programState.updateProgram([viewNodeStr, modelEventsStr]);            
            }
          }
        }

        if (evt.data && typeof evt.data.inspector === "boolean") {
          const ps = prevSession?.view?.programState || window.programState;
          if (ps) {
            if (document.body.querySelector(".dock")) {
              document.body.querySelector(".dock").remove();
              return;
            }
            const dock = document.createElement("div");
            dock.classList.add("dock");
            const dom = document.createElement("div");
            dom.id = "renkonInspector";

            dock.appendChild(dom);
            document.body.appendChild(dock);
            const result = ps.order.map((id) => [
                id + " (" + ps.types.get(id) + ")",
                ps.resolved.get(id)]);
            dom.addEventListener('contextmenu', event => {
              event.preventDefault(); event.stopPropagation();}, {capture: true});
            dom.addEventListener('pointerup', event => {
              if (event.button !== 0) {
                function findFieldElem(elem) {
                  while (elem) {
                    if (elem.classList?.contains("observablehq--field")) {return elem;}
                    elem = elem.parentNode;
                  }
                }
                const fieldElem = findFieldElem(event.target);
                if (!fieldElem) {return;}
                const key = fieldElem.querySelector(".observablehq--key");
                if (!key) {return;}
                const text = key.textContent;
                const match = /(.*)\\\\\\\\W(Behavior|Event)\\\\\\\\W/.exec(text);
                if (!match) {return;}
                const keyName = match[1].trim();
              }
            });
            newInspector(Object.fromEntries(result), dom);
          }
        }
      };

      window.parent.postMessage({ready: "renkon-ready", type: "runner", id: "\${id}"});
    </script>
  </head>
  <body></body>
</html>\`.trim();
  runnerIframe.classList = "runnerIframe";
  runnerIframe.id = \`runner-\${id}\`;
  return {dom: runnerIframe};
};`],
[`149`, `const loadAtOnce = Events.receiver();`],
[`150`, `const loadEvent = Events.receiver({queued: true});`],
[`151`, `const loadReceiver = Behaviors.select(
  undefined, // {key:number, array}
  loadEvent, (prev, events) => {
    let result = prev;
    for (const event of events) {
      if (event.type === "loadStart") {
        result = {key: event.key, array: []};
      } else if (event.type === "loadOne") {
        if (result?.key !== event.key) {
          result = undefined;
          break;
        }
        result = {key: result.key, array: [...result.array, event.array]}
      } else if (event.type === "loadDone") {
        if (result?.key !== event.key ) {
          result = undefined;
          break;
        }
        result = {key: result.key, array: result.array, done: true}
      }
    }
    return result;
  },
  loadAtOnce, (_prev, value) => {
    return value;
  }
);`],
[`152`, `const loadFromFile = ((loadReceiver) => {
  if (!loadReceiver?.done) {return;}

  const array = loadReceiver.array;
  let len = array.reduce((acc, cur) => acc + cur.length, 0);
  let all = new Uint8Array(len);
  let ind = 0;
  for (let i = 0; i < array.length; i++) {
    all.set(array[i], ind);
    ind += array[i].length;
  }

  const parse = (string) => {
    return JSON.parse(string, (_key, value) => {
      if (typeof value === "object" && value !== null && value.__map) {
        return new Map(value.values);
      } else if (typeof value === "object" && value !== null && value.__set) {
        return new Set(value.values);
      }
      return value;
    });
  }

  const parseCodeMap = (string) => {
    const array = eval("(" + string + ")");
    return new Map(array.value);
  }

  let result = new TextDecoder("utf-8").decode(all);

  const index = result.indexOf("{__codeMap: true, value:");

  const data1 = result.slice(0, index);
  const data2 = result.slice(index);

  const loaded = parse(data1);

  if (loaded.version === 2 || loaded.version === 3) {
    const code = parseCodeMap(data2);
    loaded.code = code;
    return loaded;
  }
  console.log("unknown type of data");
  return;
})(Events.change(loadReceiver));`],
[`153`, `const loadHandler = Events.or(loadFromFile, loadFromProgram);`],
[`154`, `const loadFromProgram = Events.receiver();`],
[`155`, `const newDocPane = (id, docModel) => {
  const mirror = window.CodeMirror;
  const container = document.createElement("div");
  container.id = \`\${id}-doc-container\`;
  container.classList.add("doc-container");
  container.innerHTML = \`
   <div id="\${id}-doc-result" class="doc-result"></div>
   <div id="\${id}-doc-separator" class="doc-separator"></div>
   <div id="\${id}-editor-container" class="doc-editor-container"></div>
\`.trim();

  const callback = (id, viewUpdate) => {
    if (viewUpdate.docChanged) {
      const str = viewUpdate.state.doc.toString();
      Events.send(docUpdate, {id, doc: str});
    }
  };
  const extensions = [
    mirror.basicSetup,
    mirror.EditorView.lineWrapping,
    mirror.EditorView.updateListener.of((viewUpdate) => callback(id, viewUpdate)),
    mirror.EditorView.editorAttributes.of({"class": "doc-editor"}),
    mirror.view.keymap.of([mirror.commands.indentWithTab])
  ];
  const editorView = window.CodeMirrorView.create(Renkon, docModel, extensions);
  const editor = editorView.editor;
  editor.dom.id = \`\${id}-doc-editor\`;
  container.querySelector(".doc-editor-container").appendChild(editor.dom);
  return {dom: container, editor: editor, viewState: true};
}`],
[`156`, `const separatorMove = Events.receiver();`],
[`157`, `const docUpdate = Events.receiver();`],
[`158`, `const updateMarkdownDom = (container, id, doc, md) => {
  if (container.lastDoc === doc) {return;}
  const result = md.render(doc);
  const div = document.createElement("div");
  div.id = \`\${id}-markdown\`;
  div.classList.add("markdown");
  container.dom.querySelector(".markdown")?.remove();
  container.dom.querySelector(".doc-result").appendChild(div);
  div.innerHTML = result;
  container.lastDoc = doc;
  return div;  
}`],
[`159`, `const markdownUpdate = ((docUpdate) => {
  const {id, doc} = docUpdate;
  const container = windowContents.map.get(id);
  if (!container) {return;}
  updateMarkdownDom(container, id, doc, md);
})(docUpdate);`],
[`160`, `const initialDoc = ((md) => {
  for (const [id, contents] of windowContents.map) {
    if (!contents.editor) {continue;}
    let editor = contents.editor;
    if (editor.editor) {
      editor = editor.editor;
    }
    const doc = editor.state.doc.toString();
    const container = contents;
    updateMarkdownDom(container, id, doc, md);
  }
})(md);`],
[`161`, `const moveSeparator = ((docSeparators) => {
  // console.log(docSeparators);
  for (const [id, docSeparator] of docSeparators.map) {
    const container = windowContents.map.get(id);
    container.dom.querySelector(".doc-result").style.width = \`\${docSeparator.docWidth}px\`;
    container.dom.querySelector(".doc-editor-container").style.width = \`\${docSeparator.editorWidth}px\`;
    container.dom.querySelector(".doc-editor-container").style.right = \`\${docSeparator.editorRight}px\`;
    container.dom.querySelector(".doc-editor-container").style.display = docSeparator.editorWidth <= 60 ? "none" : "inherit";
  }
})(docSeparators);`]]}