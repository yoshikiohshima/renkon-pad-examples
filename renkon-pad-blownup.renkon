{"padTitle":"Blown up",
"positions":{"map":{"__map":true,
"values":[["0",{"height":70,
"id":"0",
"type":"move",
"width":660.7792174532964,
"x":163.1155120678772,
"y":99.19127312559954}],["1",{"height":70,
"id":"1",
"type":"move",
"width":704.5846785057596,
"x":169.74605354391446,
"y":-25.06858743445042}],["2",{"height":70,
"id":"2",
"type":"move",
"width":645.5695966956372,
"x":160.4568997485342,
"y":206.62927584685792}],["3",{"height":70,
"id":"3",
"type":"move",
"width":646.6040262341983,
"x":155.06000625079133,
"y":314.8793699585072}],["4",{"height":70,
"id":"4",
"type":"move",
"width":631.4733026447343,
"x":149.25986056004993,
"y":430.61592869669306}],["5",{"height":70,
"id":"5",
"type":"move",
"width":652.988058146682,
"x":-4125.950591188174,
"y":1628.9117660716133}],["6",{"height":70,
"id":"6",
"type":"move",
"width":629.3073041003747,
"x":-4125.998816485247,
"y":1505.7464160114216}],["7",{"height":70,
"id":"7",
"type":"move",
"width":678.9539403388976,
"x":-4117.902601899033,
"y":1382.983214952563}],["8",{"height":70,
"id":"8",
"type":"move",
"width":704.1833008536792,
"x":-4124.877664195861,
"y":1265.3602435519028}],["9",{"height":70,
"id":"9",
"type":"move",
"width":598.8319989962013,
"x":-4124.2759015348865,
"y":1154.5888726281817}],["10",{"height":70,
"id":"10",
"type":"move",
"width":515.4273154885475,
"x":-4130.495600433975,
"y":1056.4483047779463}],["11",{"height":70,
"id":"11",
"type":"move",
"width":324.797525328595,
"x":-82.58801822376563,
"y":-604.7816757280077}],["12",{"height":70,
"id":"12",
"type":"move",
"width":270.364395896507,
"x":-4126.854403249901,
"y":953.8272253449666}],["13",{"height":70,
"id":"13",
"type":"move",
"width":647.3930288956187,
"x":-4129.723688119256,
"y":827.1435317142772}],["14",{"height":70,
"id":"14",
"type":"move",
"width":649.5231352483734,
"x":-4113.49612156203,
"y":709.3595653747436}],["15",{"height":212.25756627604326,
"id":"15",
"type":"move",
"width":799.9214356889031,
"x":165.05889724684653,
"y":-934.4171800590409}],["16",{"height":338.8907104658142,
"id":"16",
"type":"move",
"width":673.1464215190854,
"x":-4133.196307294671,
"y":2012.042077669412}],["17",{"height":1021.1150705148515,
"id":"17",
"type":"move",
"width":687.5745984898447,
"x":-4151.798438622351,
"y":2466.084770055421}],["18",{"height":70,
"id":"18",
"type":"move",
"width":553.2521013815373,
"x":-4130.858444343087,
"y":1869.4774460363494}],["19",{"height":70,
"id":"19",
"type":"move",
"width":581.1513847907345,
"x":-4133.806772574615,
"y":1744.2599504806549}],["20",{"height":70,
"id":"20",
"type":"move",
"width":508.5577382007746,
"x":-3196.365380528984,
"y":1793.5317804426863}],["21",{"height":70,
"id":"21",
"type":"move",
"width":500.79162422573074,
"x":-3185.111300346829,
"y":1669.050599848882}],["22",{"height":70,
"id":"22",
"type":"move",
"width":484.46310117912356,
"x":-3183.281804586387,
"y":1547.3889895737536}],["23",{"height":70,
"id":"23",
"type":"move",
"width":781.4274893653917,
"x":-3181.562925193776,
"y":1441.89775090692}],["24",{"height":70,
"id":"24",
"type":"move",
"width":341.82786040706225,
"x":-3182.9319660608176,
"y":1349.631730336639}],["25",{"height":70,
"id":"25",
"type":"move",
"width":681.1837785630975,
"x":-3187.1391481026535,
"y":1232.1230723507817}],["26",{"height":70,
"id":"26",
"type":"move",
"width":763.3095391355946,
"x":-3189.3824982734077,
"y":1115.8220522579186}],["27",{"height":114.71590044917274,
"id":"27",
"type":"move",
"width":264.9272272094793,
"x":-3179.9379921470686,
"y":946.4729802311683}],["28",{"height":150.209188627743,
"id":"28",
"type":"move",
"width":304.01726402626116,
"x":-3186.990684961935,
"y":775.2942827201438}],["29",{"height":132.06439699019813,
"id":"29",
"type":"move",
"width":267.96030628498613,
"x":-2844.820790604504,
"y":920.9744538530921}],["30",{"height":792.8461729267065,
"id":"30",
"type":"move",
"width":695.9376056884976,
"x":-3202.3784863087367,
"y":-115.67333343452623}],["31",{"height":222.24257988704957,
"id":"31",
"type":"move",
"width":546.0999205040972,
"x":-2182.438323824862,
"y":763.8657520467083}],["32",{"height":191.6791635981673,
"id":"32",
"type":"move",
"width":435.3343778646468,
"x":-2190.8529397440634,
"y":522.4664882863439}],["33",{"height":195.1953880131353,
"id":"33",
"type":"move",
"width":542.6373789046249,
"x":-1367.6991874008045,
"y":821.8755118176382}],["34",{"height":140.27786776103943,
"id":"34",
"type":"move",
"width":493.27603005633347,
"x":-1227.6678286879082,
"y":526.5640295584091}],["35",{"height":70,
"id":"35",
"type":"move",
"width":263.2093771136171,
"x":-1627.7383281837426,
"y":679.7251538275071}],["36",{"height":70,
"id":"36",
"type":"move",
"width":323.3251833328794,
"x":-1632.6653240090834,
"y":565.8326482350981}],["37",{"height":70,
"id":"37",
"type":"move",
"width":303.7488499487827,
"x":-1625.6049941512367,
"y":445.14500068125585}],["38",{"height":70,
"id":"38",
"type":"move",
"width":289.52290384242355,
"x":-1632.0812662532762,
"y":299.4895095817181}],["39",{"height":70,
"id":"39",
"type":"move",
"width":283.24201442942723,
"x":-1634.0180818974995,
"y":75.13376777517226}],["40",{"height":70,
"id":"40",
"type":"move",
"width":326.83635292674853,
"x":-1620.6828520431675,
"y":171.96877186913832}],["41",{"height":419.20739930361196,
"id":"41",
"type":"move",
"width":551.8298099747456,
"x":1067.2953801282038,
"y":-1020.4104039609305}],["42",{"height":252.64161480198575,
"id":"42",
"type":"move",
"width":363.04375319094606,
"x":1335.634105815594,
"y":-1960.0806254702989}],["43",{"height":734.2273485113307,
"id":"43",
"type":"move",
"width":500.8177043081718,
"x":158.5592103572299,
"y":-1810.3569533415784}],["44",{"height":2077.6201081985096,
"id":"44",
"type":"move",
"width":679.0269530717298,
"x":1904.5703352046996,
"y":-2285.7837030885053}],["45",{"height":214.65378459448175,
"id":"45",
"type":"move",
"width":761.1020265413226,
"x":938.9928407034083,
"y":-1625.576034259374}],["46",{"height":74.44881095877128,
"id":"46",
"type":"move",
"width":559.6490434134375,
"x":1129.240705471055,
"y":-2126.009536505382}],["47",{"height":70.98212142153437,
"id":"47",
"type":"move",
"width":300.33766456531527,
"x":2729.574643765884,
"y":-1291.592377748895}],["48",{"height":534.5505476573741,
"id":"48",
"type":"move",
"width":782.9953942269789,
"x":2727.5287577913546,
"y":-1883.1068608430496}],["49",{"height":232.4758275263231,
"id":"49",
"type":"move",
"width":804.1707143007505,
"x":2720.000448385392,
"y":-2290.095654884038}],["50",{"height":435.7649031601367,
"id":"50",
"type":"move",
"width":573.6283564174902,
"x":3604.2385110541836,
"y":-1116.273482863526}],["51",{"height":169.5576635225756,
"id":"51",
"type":"move",
"width":515.3249414730516,
"x":3597.943686447481,
"y":-2318.9416632139587}],["52",{"height":563.7247661006144,
"id":"52",
"type":"move",
"width":461.29110736559954,
"x":3619.366623163413,
"y":-1830.2840938696254}],["53",{"height":119.2081250055636,
"id":"53",
"type":"move",
"width":419.2030952133014,
"x":3609.2744473439852,
"y":-2032.3800278635713}],["54",{"height":868.5083064111947,
"id":"54",
"type":"move",
"width":587.660195020592,
"x":2705.6364963611322,
"y":-282.23498537242995}],["55",{"height":107.52493104565487,
"id":"55",
"type":"move",
"width":283.7095606377894,
"x":2705.9742924892516,
"y":-458.00996056595625}],["56",{"height":218.0031636209736,
"id":"56",
"type":"move",
"width":552.7551571038636,
"x":2702.5890887504065,
"y":-749.8042040953849}],["57",{"height":220.07049664071505,
"id":"57",
"type":"move",
"width":642.2138672281287,
"x":2722.486111305088,
"y":-1153.7939588177887}],["58",{"height":125.96921950547319,
"id":"58",
"type":"move",
"width":329.8915538902033,
"x":2707.8739257529624,
"y":-901.8664298787318}],["59",{"height":7319.393875590242,
"id":"59",
"type":"move",
"width":1154.6858367894695,
"x":4338.769859447189,
"y":-2353.0022523121593}],["60",{"height":185.38740916513947,
"id":"60",
"type":"move",
"width":398.17884048438316,
"x":3571.4779459595084,
"y":2710.5585023328726}],["61",{"height":1160.0995756676598,
"id":"61",
"type":"move",
"width":767.8408967942803,
"x":3557.32683359733,
"y":-28.940189570327504}],["62",{"height":395.56438070628747,
"id":"62",
"type":"move",
"width":562.0112106915165,
"x":3576.627169685912,
"y":-546.4785897829973}],["63",{"height":70,
"id":"63",
"type":"move",
"width":294.3041041154018,
"x":2949.5227856767488,
"y":1258.560119647325}],["64",{"height":70,
"id":"64",
"type":"move",
"width":323.7038118428682,
"x":3103.571831571032,
"y":1541.7286186970061}],["65",{"height":968.2637061950229,
"id":"65",
"type":"move",
"width":662.0305077848506,
"x":3554.2672379532346,
"y":1230.91538893712}],["66",{"height":83.94017159934342,
"id":"66",
"type":"move",
"width":550.2545008015798,
"x":3566.9601184345993,
"y":2359.050163977869}],["67",{"height":213.12523939471512,
"id":"67",
"type":"move",
"width":554.1865908129284,
"x":-4623.947816729073,
"y":-1163.430361940493}],["68",{"height":392.0277686227466,
"id":"68",
"type":"move",
"width":433.91421701319075,
"x":-4039.5865315225046,
"y":-1087.9378865792316}],["69",{"height":646.5558433158577,
"id":"69",
"type":"move",
"width":585.1915759341334,
"x":-3585.0867090399483,
"y":-1026.096609704642}],["70",{"height":661.6424260223915,
"id":"70",
"type":"move",
"width":449.66625548623443,
"x":-2964.3184207034465,
"y":-916.633069639403}],["71",{"height":253.36780127470888,
"id":"71",
"type":"move",
"width":274.625120903346,
"x":-2473.3689133742714,
"y":-171.72590713880436}],["72",{"height":616.6366018136953,
"id":"72",
"type":"move",
"width":500.3196977133371,
"x":-2476.813220678753,
"y":-824.684793084563}],["73",{"height":445.5518800661647,
"id":"73",
"type":"move",
"width":444.5985491535055,
"x":-1945.5330694070133,
"y":-740.3750945732043}],["74",{"height":419.85703356398824,
"id":"74",
"type":"move",
"width":471.8092715299341,
"x":-1457.7287883977156,
"y":-655.0438949462601}],["75",{"height":1004.1746527361445,
"id":"75",
"type":"move",
"width":431.7161056676987,
"x":-941.7209542186833,
"y":-568.1722171516737}],["76",{"height":70,
"id":"76",
"type":"move",
"width":346.14166068722216,
"x":432.14074340084335,
"y":-649.4281885957997}],["77",{"height":221.4924183359326,
"id":"77",
"type":"move",
"width":487.99362286064684,
"x":427.7418810257332,
"y":-513.73945262647}],["78",{"height":70,
"id":"78",
"type":"move",
"width":577.0850999850154,
"x":417.59033789162515,
"y":-228.8256311820926}],["79",{"height":660.2609391265044,
"id":"79",
"type":"move",
"width":537.142020843003,
"x":1078.7700828825855,
"y":-560.7072083639522}],["80",{"height":392.14987704772903,
"id":"80",
"type":"resize",
"width":309.1534052289146,
"x":-83.64327766018518,
"y":-473.20174527991696}],["81",{"height":171.36345378145296,
"id":"81",
"type":"move",
"width":329.26190755280953,
"x":-461.94779291952403,
"y":-511.62540221122856}],["82",{"height":184.43100422220152,
"id":"82",
"type":"move",
"width":625.0578186589581,
"x":-725.8835259418756,
"y":875.4240141994029}],["83",{"height":139.93529456675822,
"id":"83",
"type":"move",
"width":447.76037605953655,
"x":-795.9704946295881,
"y":1169.4307336360398}],["84",{"height":115.56121120254417,
"id":"84",
"type":"move",
"width":326.1351008814972,
"x":-799.8651837901117,
"y":1369.8881102631378}],["85",{"height":186.7523454949838,
"id":"85",
"type":"move",
"width":633.6227674930169,
"x":1049.804819817264,
"y":480.9828045146551}],["86",{"height":70,
"id":"86",
"type":"move",
"width":479.05345722603056,
"x":382.3174489851551,
"y":655.9105312796489}],["87",{"height":585.4207834269453,
"id":"87",
"type":"move",
"width":789.0452636919383,
"x":-1750.8744478270032,
"y":1100.7603559946615}],["88",{"height":569.1851734850386,
"id":"88",
"type":"move",
"width":620.0409619259696,
"x":359.44238437349713,
"y":773.1255719187235}],["89",{"height":1916.0672307939396,
"id":"89",
"type":"move",
"width":616.6468796751831,
"x":-885.8928197151264,
"y":-2729.992043690442}],["90",{"height":1333.2998092800249,
"id":"90",
"type":"move",
"width":607.5405919868615,
"x":-1707.1508699443227,
"y":-2709.4869534398595}],["91",{"height":70,
"id":"91",
"type":"move",
"width":626.8064642413565,
"x":-2418.465471786565,
"y":1626.1271593542237}],["92",{"height":240.95786200548795,
"id":"92",
"type":"move",
"width":651.6530728901292,
"x":-3208.136796893817,
"y":1927.143401535148}],["93",{"height":70,
"id":"93",
"type":"move",
"width":218.50866830305935,
"x":-3227.2982041125265,
"y":2265.6613389468025}],["94",{"height":1120.218930580686,
"id":"94",
"type":"move",
"width":663.2841013145107,
"x":-3222.7955940484144,
"y":2462.2276902328726}],["95",{"height":169.6830676598425,
"id":"95",
"type":"move",
"width":586.1559632646488,
"x":-2426.98557609259,
"y":1777.6042891179932}],["96",{"height":70,
"id":"96",
"type":"move",
"width":718.9692415330453,
"x":-1756.7868377715226,
"y":2725.314825080868}],["97",{"height":70,
"id":"97",
"type":"move",
"width":489.5541205639888,
"x":-1748.2862856647948,
"y":2595.1292796971507}],["98",{"height":70,
"id":"98",
"type":"move",
"width":316.2837054890918,
"x":-1760.5925562070222,
"y":2339.347954359047}],["99",{"height":70,
"id":"99",
"type":"move",
"width":319.2350630604313,
"x":-1754.8345259478403,
"y":2465.9353600999725}],["100",{"height":2106.177328080853,
"id":"100",
"type":"move",
"width":620.5912161867511,
"x":-2438.3877472029153,
"y":2094.742750444343}],["101",{"height":70,
"id":"101",
"type":"move",
"width":325.39397243673346,
"x":-446.02410448666956,
"y":3317.123544985276}],["102",{"height":70,
"id":"102",
"type":"move",
"width":301.30146670680597,
"x":-1054.5745199668931,
"y":3471.5213756909243}],["103",{"height":70,
"id":"103",
"type":"move",
"width":341.2025122889016,
"x":-1093.2825327218852,
"y":3220.074207067488}],["104",{"height":70,
"id":"104",
"type":"move",
"width":322.58563836800494,
"x":-815.4395206765566,
"y":1587.3501262279506}],["105",{"height":277.1563585405847,
"id":"105",
"type":"move",
"width":492.0557360902654,
"x":-821.5408160419771,
"y":1748.3453423989097}],["106",{"height":338.8959698993341,
"id":"106",
"type":"move",
"width":828.5993846983099,
"x":-852.1700248172989,
"y":2743.9431345741655}],["107",{"height":70,
"id":"107",
"type":"move",
"width":833.018990552591,
"x":944.9340049770234,
"y":2322.969185274219}],["108",{"height":70,
"id":"108",
"type":"move",
"width":794.3007533502969,
"x":948.3051831011497,
"y":2221.732650185394}],["109",{"height":70,
"id":"109",
"type":"move",
"width":823.8789136567655,
"x":282.28809657075544,
"y":2060.266799105434}],["110",{"height":225.36604768478279,
"id":"110",
"type":"move",
"width":492.60559315664307,
"x":1036.9451182547914,
"y":2632.993438039932}],["111",{"height":150.78260522838056,
"id":"111",
"type":"move",
"width":480.30124446373827,
"x":1026.8603602451085,
"y":1209.921264702365}],["112",{"height":97.44646978974322,
"id":"112",
"type":"move",
"width":332.1925750371701,
"x":-465.32081521965887,
"y":3541.58176505253}],["113",{"height":244.38067487501812,
"id":"113",
"type":"move",
"width":670.3391762989297,
"x":947.2726306982631,
"y":1570.203258449751}],["114",{"height":215.60970509275026,
"id":"114",
"type":"move",
"width":469.89017120495123,
"x":1224.1284974055818,
"y":1894.5488167317935}],["115",{"height":70,
"id":"115",
"type":"move",
"width":852.033558714774,
"x":313.70301259586574,
"y":3139.063009457567}],["116",{"height":463.79252778406254,
"id":"116",
"type":"move",
"width":716.8954448460285,
"x":189.59498069583285,
"y":1498.3939434187741}],["117",{"height":289.7234934862039,
"id":"117",
"type":"move",
"width":566.1332655302615,
"x":-1109.7837858495436,
"y":3935.655695942667}],["118",{"height":628.433989502905,
"id":"118",
"type":"move",
"width":611.5478859128032,
"x":295.06339588378427,
"y":2203.673470918034}],["119",{"height":1300.9340533522713,
"id":"119",
"type":"move",
"width":525.5872996104251,
"x":286.79044276389016,
"y":3310.2214512493015}],["120",{"height":169.40626403517152,
"id":"120",
"type":"move",
"width":395.34539507444106,
"x":311.644317856858,
"y":2897.7739513361757}],["121",{"height":4663.297628520957,
"id":"121",
"type":"move",
"width":826.0402281761541,
"x":1770.4828787391064,
"y":-17.538992900670166}],["122",{"height":111.68874314128945,
"id":"122",
"type":"move",
"width":298.965835048011,
"x":-929.9520555421766,
"y":-699.875265792145}],["123",{"height":349.4877400548697,
"id":"123",
"type":"move",
"width":617.0760459533608,
"x":1059.536069958339,
"y":760.1108177172088}],["124",{"height":91.61629801097395,
"id":"124",
"type":"resize",
"width":471.6445901920439,
"x":1129.0502829218108,
"y":179.24747085048017}]]}},
"titles":{"map":{"__map":true,
"values":[["0",{"id":"0",
"state":false,
"title":"addCode"}],["1",{"id":"1",
"state":false,
"title":"addRunner"}],["2",{"id":"2",
"state":false,
"title":"addDoc"}],["3",{"id":"3",
"state":false,
"title":"save"}],["4",{"id":"4",
"state":false,
"title":"load"}],["5",{"id":"5",
"state":false,
"title":"search"}],["6",{"id":"6",
"state":false,
"title":"home"}],["7",{"id":"7",
"state":false,
"title":"zoomIn"}],["8",{"id":"8",
"state":false,
"title":"zoomOut"}],["9",{"id":"9",
"state":false,
"title":"homeUponLoad"}],["10",{"id":"10",
"state":false,
"title":"navigationAction"}],["11",{"id":"11",
"state":false,
"title":"padViewChange"}],["12",{"id":"12",
"state":false,
"title":"wheeling"}],["13",{"id":"13",
"state":false,
"title":"queuedKeydown"}],["14",{"id":"14",
"state":false,
"title":"queuedKeyup"}],["15",{"id":"15",
"state":false,
"title":"_padViewUpdate"}],["16",{"id":"16",
"state":false,
"title":"wheel"}],["17",{"id":"17",
"state":false,
"title":"_handleWheel"}],["18",{"id":"18",
"state":false,
"title":"_1_0"}],["19",{"id":"19",
"state":false,
"title":"_1_0"}],["20",{"id":"20",
"state":false,
"title":"_1_0"}],["21",{"id":"21",
"state":false,
"title":"_1_0"}],["22",{"id":"22",
"state":false,
"title":"_1_0"}],["23",{"id":"23",
"state":false,
"title":"isSafari"}],["24",{"id":"24",
"state":false,
"title":"isMobile"}],["25",{"id":"25",
"state":false,
"title":"pointercancel"}],["26",{"id":"26",
"state":false,
"title":"lostpointercapture"}],["27",{"id":"27",
"state":false,
"title":"preventDefault"}],["28",{"id":"28",
"state":false,
"title":"preventDefaultSafari"}],["29",{"id":"29",
"state":false,
"title":"pointerLost"}],["30",{"id":"30",
"state":false,
"title":"_handleNavigationAction"}],["31",{"id":"31",
"state":false,
"title":"showGraph"}],["32",{"id":"32",
"state":false,
"title":"1"}],["33",{"id":"33",
"state":false,
"title":"_onRun"}],["34",{"id":"34",
"state":false,
"title":"_onInspect"}],["35",{"id":"35",
"state":false,
"title":"remove"}],["36",{"id":"36",
"state":false,
"title":"titleEditChange"}],["37",{"id":"37",
"state":false,
"title":"enabledChange"}],["38",{"id":"38",
"state":false,
"title":"pinRequest"}],["39",{"id":"39",
"state":false,
"title":"runRequest"}],["40",{"id":"40",
"state":false,
"title":"inspectRequest"}],["41",{"id":"41",
"state":false,
"title":"_goTo"}],["42",{"id":"42",
"state":false,
"title":"inputHandler"}],["43",{"id":"43",
"state":false,
"title":"_positionsCss"}],["44",{"id":"44",
"state":false,
"title":"windowDOM"}],["45",{"id":"45",
"state":false,
"title":"windowElements"}],["46",{"id":"46",
"state":false,
"title":"_windowRender"}],["47",{"id":"47",
"state":false,
"title":"loadRequest"}],["48",{"id":"48",
"state":false,
"title":"saveData"}],["49",{"id":"49",
"state":false,
"title":"_saver2"}],["50",{"id":"50",
"state":false,
"title":"_loader"}],["51",{"id":"51",
"state":false,
"title":"nameFromUrl"}],["52",{"id":"52",
"state":false,
"title":"loadData"}],["53",{"id":"53",
"state":false,
"title":"_loadFromUrl"}],["54",{"id":"54",
"state":false,
"title":"stringifyInner"}],["55",{"id":"55",
"state":false,
"title":"stringify"}],["56",{"id":"56",
"state":false,
"title":"parse"}],["57",{"id":"57",
"state":false,
"title":"stringifyCodeMap"}],["58",{"id":"58",
"state":false,
"title":"parseCodeMap"}],["59",{"id":"59",
"state":false,
"title":"css"}],["60",{"id":"60",
"state":false,
"title":"1"}],["61",{"id":"61",
"state":false,
"title":"analyzed"}],["62",{"id":"62",
"state":false,
"title":"line"}],["63",{"id":"63",
"state":false,
"title":"hovered"}],["64",{"id":"64",
"state":false,
"title":"hoveredB"}],["65",{"id":"65",
"state":false,
"title":"graph"}],["66",{"id":"66",
"state":false,
"title":"_graphRender"}],["67",{"id":"67",
"state":false,
"title":"windows"}],["68",{"id":"68",
"state":false,
"title":"windowTypes"}],["69",{"id":"69",
"state":false,
"title":"positions"}],["70",{"id":"70",
"state":false,
"title":"pinnedPositions"}],["71",{"id":"71",
"state":false,
"title":"findMax"}],["72",{"id":"72",
"state":false,
"title":"zIndex"}],["73",{"id":"73",
"state":false,
"title":"titles"}],["74",{"id":"74",
"state":false,
"title":"windowEnabled"}],["75",{"id":"75",
"state":false,
"title":"windowContents"}],["76",{"id":"76",
"state":false,
"title":"initialData"}],["77",{"id":"77",
"state":false,
"title":"newId"}],["78",{"id":"78",
"state":false,
"title":"newWindowRequest"}],["79",{"id":"79",
"state":false,
"title":"modifierState"}],["80",{"id":"80",
"state":false,
"title":"padView"}],["81",{"id":"81",
"state":false,
"title":"padTitle"}],["82",{"id":"82",
"state":false,
"title":"titleChange"}],["83",{"id":"83",
"state":false,
"title":"_padTitleUpdater"}],["84",{"id":"84",
"state":false,
"title":"_focus"}],["85",{"id":"85",
"state":false,
"title":"readyMessages"}],["86",{"id":"86",
"state":false,
"title":"render"}],["87",{"id":"87",
"state":false,
"title":"renkon"}],["88",{"id":"88",
"state":false,
"title":"searchPanel"}],["89",{"id":"89",
"state":false,
"title":"newEditor"}],["90",{"id":"90",
"state":false,
"title":"newRunner"}],["91",{"id":"91",
"state":false,
"title":"dblClick"}],["92",{"id":"92",
"state":false,
"title":"rawPadDown"}],["93",{"id":"93",
"state":false,
"title":"evCache"}],["94",{"id":"94",
"state":false,
"title":"padDown"}],["95",{"id":"95",
"state":false,
"title":"padUp"}],["96",{"id":"96",
"state":false,
"title":"downOrUpOrResize"}],["97",{"id":"97",
"state":false,
"title":"_padMove"}],["98",{"id":"98",
"state":false,
"title":"windowResize"}],["99",{"id":"99",
"state":false,
"title":"moveOrResize"}],["100",{"id":"100",
"state":false,
"title":"moveCompute"}],["101",{"id":"101",
"state":false,
"title":"searchRequest"}],["102",{"id":"102",
"state":false,
"title":"searchUpdate"}],["103",{"id":"103",
"state":false,
"title":"toggleSearchPanel"}],["104",{"id":"104",
"state":false,
"title":"cursorChanged"}],["105",{"id":"105",
"state":false,
"title":"cursorState"}],["106",{"id":"106",
"state":false,
"title":"searchState"}],["107",{"id":"107",
"state":false,
"title":"_searchHandler"}],["108",{"id":"108",
"state":false,
"title":"_searchNext"}],["109",{"id":"109",
"state":false,
"title":"_searchClose"}],["110",{"id":"110",
"state":false,
"title":"searchInputHandler"}],["111",{"id":"111",
"state":false,
"title":"searchNextHandler"}],["112",{"id":"112",
"state":false,
"title":"searchCloseHandler"}],["113",{"id":"113",
"state":false,
"title":"getSearchRequest"}],["114",{"id":"114",
"state":false,
"title":"_searchFieldUpdate"}],["115",{"id":"115",
"state":false,
"title":"1"}],["116",{"id":"116",
"state":false,
"title":"1"}],["117",{"id":"117",
"state":false,
"title":"updateEditorSelection"}],["118",{"id":"118",
"state":false,
"title":"_searchGoTo"}],["119",{"id":"119",
"state":false,
"title":"searchCSS"}],["120",{"id":"120",
"state":false,
"title":"1"}],["121",{"id":"121",
"state":false,
"title":"doc"}],["122",{"id":"122",
"state":false,
"title":"newDocPane"}],["123",{"id":"123",
"state":false,
"title":"_handleDocReady"}],["124",{"id":"124",
"state":false,
"title":"docUpdate"}]]}},
"version":3,
"windowEnabled":{"map":{"__map":true,
"values":[["0",{"enabled":true,
"id":"0"}],["1",{"enabled":true,
"id":"1"}],["2",{"enabled":true,
"id":"2"}],["3",{"enabled":true,
"id":"3"}],["4",{"enabled":true,
"id":"4"}],["5",{"enabled":true,
"id":"5"}],["6",{"enabled":true,
"id":"6"}],["7",{"enabled":true,
"id":"7"}],["8",{"enabled":true,
"id":"8"}],["9",{"enabled":true,
"id":"9"}],["10",{"enabled":true,
"id":"10"}],["11",{"enabled":true,
"id":"11"}],["12",{"enabled":true,
"id":"12"}],["13",{"enabled":true,
"id":"13"}],["14",{"enabled":true,
"id":"14"}],["15",{"enabled":true,
"id":"15"}],["16",{"enabled":true,
"id":"16"}],["17",{"enabled":true,
"id":"17"}],["18",{"enabled":true,
"id":"18"}],["19",{"enabled":true,
"id":"19"}],["20",{"enabled":true,
"id":"20"}],["21",{"enabled":true,
"id":"21"}],["22",{"enabled":true,
"id":"22"}],["23",{"enabled":true,
"id":"23"}],["24",{"enabled":true,
"id":"24"}],["25",{"enabled":true,
"id":"25"}],["26",{"enabled":true,
"id":"26"}],["27",{"enabled":true,
"id":"27"}],["28",{"enabled":true,
"id":"28"}],["29",{"enabled":true,
"id":"29"}],["30",{"enabled":true,
"id":"30"}],["31",{"enabled":true,
"id":"31"}],["32",{"enabled":true,
"id":"32"}],["33",{"enabled":true,
"id":"33"}],["34",{"enabled":true,
"id":"34"}],["35",{"enabled":true,
"id":"35"}],["36",{"enabled":true,
"id":"36"}],["37",{"enabled":true,
"id":"37"}],["38",{"enabled":true,
"id":"38"}],["39",{"enabled":true,
"id":"39"}],["40",{"enabled":true,
"id":"40"}],["41",{"enabled":true,
"id":"41"}],["42",{"enabled":true,
"id":"42"}],["43",{"enabled":true,
"id":"43"}],["44",{"enabled":true,
"id":"44"}],["45",{"enabled":true,
"id":"45"}],["46",{"enabled":true,
"id":"46"}],["47",{"enabled":true,
"id":"47"}],["48",{"enabled":true,
"id":"48"}],["49",{"enabled":true,
"id":"49"}],["50",{"enabled":true,
"id":"50"}],["51",{"enabled":true,
"id":"51"}],["52",{"enabled":true,
"id":"52"}],["53",{"enabled":true,
"id":"53"}],["54",{"enabled":true,
"id":"54"}],["55",{"enabled":true,
"id":"55"}],["56",{"enabled":true,
"id":"56"}],["57",{"enabled":true,
"id":"57"}],["58",{"enabled":true,
"id":"58"}],["59",{"enabled":true,
"id":"59"}],["60",{"enabled":true,
"id":"60"}],["61",{"enabled":true,
"id":"61"}],["62",{"enabled":true,
"id":"62"}],["63",{"enabled":true,
"id":"63"}],["64",{"enabled":true,
"id":"64"}],["65",{"enabled":true,
"id":"65"}],["66",{"enabled":true,
"id":"66"}],["67",{"enabled":true,
"id":"67"}],["68",{"enabled":true,
"id":"68"}],["69",{"enabled":true,
"id":"69"}],["70",{"enabled":true,
"id":"70"}],["71",{"enabled":true,
"id":"71"}],["72",{"enabled":true,
"id":"72"}],["73",{"enabled":true,
"id":"73"}],["74",{"enabled":true,
"id":"74"}],["75",{"enabled":true,
"id":"75"}],["76",{"enabled":true,
"id":"76"}],["77",{"enabled":true,
"id":"77"}],["78",{"enabled":true,
"id":"78"}],["79",{"enabled":true,
"id":"79"}],["80",{"enabled":true,
"id":"80"}],["81",{"enabled":true,
"id":"81"}],["82",{"enabled":true,
"id":"82"}],["83",{"enabled":true,
"id":"83"}],["84",{"enabled":true,
"id":"84"}],["85",{"enabled":true,
"id":"85"}],["86",{"enabled":true,
"id":"86"}],["87",{"enabled":true,
"id":"87"}],["88",{"enabled":true,
"id":"88"}],["89",{"enabled":true,
"id":"89"}],["90",{"enabled":true,
"id":"90"}],["91",{"enabled":true,
"id":"91"}],["92",{"enabled":true,
"id":"92"}],["93",{"enabled":true,
"id":"93"}],["94",{"enabled":true,
"id":"94"}],["95",{"enabled":true,
"id":"95"}],["96",{"enabled":true,
"id":"96"}],["97",{"enabled":true,
"id":"97"}],["98",{"enabled":true,
"id":"98"}],["99",{"enabled":true,
"id":"99"}],["100",{"enabled":true,
"id":"100"}],["101",{"enabled":true,
"id":"101"}],["102",{"enabled":true,
"id":"102"}],["103",{"enabled":true,
"id":"103"}],["104",{"enabled":true,
"id":"104"}],["105",{"enabled":true,
"id":"105"}],["106",{"enabled":true,
"id":"106"}],["107",{"enabled":true,
"id":"107"}],["108",{"enabled":true,
"id":"108"}],["109",{"enabled":true,
"id":"109"}],["110",{"enabled":true,
"id":"110"}],["111",{"enabled":true,
"id":"111"}],["112",{"enabled":true,
"id":"112"}],["113",{"enabled":true,
"id":"113"}],["114",{"enabled":true,
"id":"114"}],["115",{"enabled":true,
"id":"115"}],["116",{"enabled":true,
"id":"116"}],["117",{"enabled":true,
"id":"117"}],["118",{"enabled":true,
"id":"118"}],["119",{"enabled":true,
"id":"119"}],["120",{"enabled":true,
"id":"120"}],["121",{"enabled":true,
"id":"121"}],["122",{"enabled":true,
"id":"122"}],["123",{"enabled":true,
"id":"123"}],["124",{"enabled":true,
"id":"124"}]]}},
"windowTypes":{"map":{"__map":true,
"values":[["0","code"],["1","code"],["2","code"],["3","code"],["4","code"],["5","code"],["6","code"],["7","code"],["8","code"],["9","code"],["10","code"],["11","code"],["12","code"],["13","code"],["14","code"],["15","code"],["16","code"],["17","code"],["18","code"],["19","code"],["20","code"],["21","code"],["22","code"],["23","code"],["24","code"],["25","code"],["26","code"],["27","code"],["28","code"],["29","code"],["30","code"],["31","code"],["32","code"],["33","code"],["34","code"],["35","code"],["36","code"],["37","code"],["38","code"],["39","code"],["40","code"],["41","code"],["42","code"],["43","code"],["44","code"],["45","code"],["46","code"],["47","code"],["48","code"],["49","code"],["50","code"],["51","code"],["52","code"],["53","code"],["54","code"],["55","code"],["56","code"],["57","code"],["58","code"],["59","code"],["60","code"],["61","code"],["62","code"],["63","code"],["64","code"],["65","code"],["66","code"],["67","code"],["68","code"],["69","code"],["70","code"],["71","code"],["72","code"],["73","code"],["74","code"],["75","code"],["76","code"],["77","code"],["78","code"],["79","code"],["80","code"],["81","code"],["82","code"],["83","code"],["84","code"],["85","code"],["86","code"],["87","code"],["88","code"],["89","code"],["90","code"],["91","code"],["92","code"],["93","code"],["94","code"],["95","code"],["96","code"],["97","code"],["98","code"],["99","code"],["100","code"],["101","code"],["102","code"],["103","code"],["104","code"],["105","code"],["106","code"],["107","code"],["108","code"],["109","code"],["110","code"],["111","code"],["112","code"],["113","code"],["114","code"],["115","code"],["116","code"],["117","code"],["118","code"],["119","code"],["120","code"],["121","code"],["122","code"],["123","code"],["124","code"]]}},
"windows":["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124"],
"zIndex":{"map":{"__map":true,
"values":[["0",100],["1",101],["2",102],["3",103],["4",186],["5",105],["6",106],["7",107],["8",108],["9",109],["10",111],["11",180],["12",112],["13",113],["14",134],["15",176],["16",104],["17",115],["18",117],["19",118],["20",121],["21",120],["22",122],["23",123],["24",124],["25",125],["26",126],["27",127],["28",128],["29",208],["30",170],["31",131],["32",114],["33",130],["34",137],["35",138],["36",136],["37",139],["38",133],["39",190],["40",135],["41",140],["42",221],["43",224],["44",146],["45",129],["46",144],["47",156],["48",161],["49",148],["50",160],["51",157],["52",152],["53",149],["54",151],["55",155],["56",153],["57",159],["58",147],["59",213],["60",150],["61",154],["62",164],["63",165],["64",163],["65",162],["66",220],["67",179],["68",189],["69",167],["70",168],["71",145],["72",169],["73",171],["74",173],["75",177],["76",142],["77",184],["78",175],["79",178],["80",172],["81",174],["82",119],["83",181],["84",182],["85",110],["86",185],["87",183],["88",205],["89",166],["90",143],["91",194],["92",158],["93",191],["94",193],["95",195],["96",199],["97",196],["98",116],["99",198],["100",192],["101",200],["102",187],["103",204],["104",132],["105",203],["106",197],["107",206],["108",207],["109",201],["110",215],["111",210],["112",209],["113",214],["114",219],["115",217],["116",211],["117",202],["118",216],["119",212],["120",218],["121",141],["122",188],["123",222],["124",223]]}}}
{__codeMap: true, value: [[`0`, `const addCode = Events.listener(renkon.querySelector("#addCodeButton"), "click", () => "code");`],
[`1`, `const addRunner = Events.listener(renkon.querySelector("#addRunnerButton"), "click", () => "runner");`],
[`2`, `const addDoc = Events.listener(renkon.querySelector("#addDocButton"), "click", () => "doc");`],
[`3`, `const save = Events.listener(renkon.querySelector("#saveButton"), "click", (evt) => evt);`],
[`4`, `const load = Events.listener(renkon.querySelector("#loadButton"), "click", (evt) => evt);`],
[`5`, `const search = Events.listener(renkon.querySelector("#searchButton"), "click", (evt) => evt);`],
[`6`, `const home = Events.listener(renkon.querySelector("#homeButton"), "click", () => "home");`],
[`7`, `const zoomIn = Events.listener(renkon.querySelector("#zoomInButton"), "click", () => "zoomIn");`],
[`8`, `const zoomOut = Events.listener(renkon.querySelector("#zoomOutButton"), "click", () => "zoomOut");`],
[`9`, `const homeUponLoad = ((_positions, _loadRequest) => "home")(positions, loadRequest);`],
[`10`, `const navigationAction = Events.or(home, zoomIn, zoomOut, homeUponLoad);`],
[`11`, `const padViewChange = Events.receiver();`],
[`12`, `const wheeling = Events.receiver();`],
[`13`, `const queuedKeydown = Events.listener(document.body, "keydown", evt => evt, {queued: true});`],
[`14`, `const queuedKeyup = Events.listener(document.body, "keyup", evt => evt, {queued: true});`],
[`15`, `const _padViewUpdate = ((padView) => {
  const mover = document.querySelector("#mover");
  const pad = document.querySelector("#pad");
  mover.style.setProperty("transform", \`scale(\${padView.scale}) translate(\${padView.x}px, \${padView.y}px)\`);

  pad.style.setProperty("background-position", \`\${padView.x * padView.scale}px \${padView.y * padView.scale}px\`);
  pad.style.setProperty("background-size", \`\${64 * padView.scale}px \${64 * padView.scale}px\`);
})(padView);`],
[`16`, `const wheel = Events.listener(renkon.querySelector("#pad"), "wheel", (evt) => {
  let pinch;
  if (isSafari) {
    pinch = (Number.isInteger(evt.deltaX) && !Number.isInteger(evt.deltaY)) || evt.metaKey;
  } else {
    pinch = evt.ctrlKey || evt.metaKey;
  }
  const strId = evt.target.id;
  if (pinch) {
    evt.preventDefault();
    if (strId === "pad") {
      evt.stopPropagation();
    }
  }
  return evt;
});`],
[`17`, `const _handleWheel = ((wheel, padView, modifierState) => {
  let pinch;
  if (isSafari) {
    pinch = (Number.isInteger(wheel.deltaX) && !Number.isInteger(wheel.deltaY)) || wheel.metaKey;
  } else {
    pinch = wheel.ctrlKey || wheel.metaKey;
  }

  const shiftKey = modifierState.shiftKey;
  const scrollDirection = modifierState.scrollDirection;
  const strId = wheel.target.id;

  let deltaX = wheel.deltaX;
  let deltaY = wheel.deltaY;
  let zoom = padView.scale;

  let absDeltaY = Math.min(30, Math.abs(deltaY));
  let diff = Math.sign(deltaY) * absDeltaY;

  let desiredZoom = zoom * (1 - diff / 50);

  const xInMover = (wheel.clientX / padView.scale) - padView.x;
  const newX = wheel.clientX / desiredZoom - xInMover;

  const yInMover = (wheel.clientY / padView.scale) - padView.y;
  const newY = wheel.clientY / desiredZoom - yInMover;

  if (scrollDirection === null && shiftKey) {
    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      Events.send(wheeling, {scrollDirection: "horizontal"});
      deltaY = 0;
    } else {
      Events.send(wheeling, {scrollDirection: "vertical"});
      deltaX = 0;
    }
  } else if (scrollDirection !== null && shiftKey) {
    if (scrollDirection === "vertical") {
      deltaX = 0;
    }
    if (scrollDirection === "horizontal") {
      deltaY = 0;
    }
  }

  if (pinch) {
    Events.send(padViewChange, {x: newX, y: newY, scale: desiredZoom});
  } else {
    if (strId === "pad") {
      Events.send(padViewChange, {x: padView.x - deltaX / padView.scale,
                                  y: padView.y - deltaY / padView.scale, scale: padView.scale});
    }
  }
})(wheel, padView, modifierState);`],
[`18`, `Events.listener(renkon.querySelector("#buttonBox"), "wheel", preventDefault);`],
[`19`, `Events.listener(renkon.querySelector("#navigationBox"), "wheel", preventDefault);`],
[`20`, `Events.listener(document.body, "gesturestart", preventDefaultSafari);`],
[`21`, `Events.listener(document.body, "gesturechange", preventDefaultSafari);`],
[`22`, `Events.listener(document.body, "gestureend", preventDefaultSafari);`],
[`23`, `const isSafari = window.navigator.userAgent.includes("Safari") && !window.navigator.userAgent.includes("Chrome");`],
[`24`, `const isMobile = !!("ontouchstart" in window);`],
[`25`, `const pointercancel = Events.listener(renkon.querySelector("#pad"), "pointercancel", pointerLost);`],
[`26`, `const lostpointercapture = Events.listener(renkon.querySelector("#pad"), "lostpointercapture", pointerLost);`],
[`27`, `const preventDefault = (evt) => {
  evt.preventDefault();
  return evt;
};`],
[`28`, `const preventDefaultSafari = (evt) => {
  if (!isSafari || isMobile) {
    evt.preventDefault();
  }
  return evt;
};`],
[`29`, `const pointerLost = (evt) => {
  evCache.clear();
  evt.preventDefault();
  return {type: "lost"};
};`],
[`30`, `const _handleNavigationAction = ((navigationAction, positions, padView) => {
  if (navigationAction === "zoomIn" || navigationAction === "zoomOut") {
    const pad = document.body.querySelector("#pad").getBoundingClientRect();
    const newScale = padView.scale * ( navigationAction === "zoomIn" ? 1.1 : 0.9);
    const centerX = pad.width / 2 / padView.scale - padView.x;
    const centerY = pad.height / 2 / padView.scale - padView.y;
    const newX = pad.width / 2 / newScale - centerX;
    const newY = pad.height / 2 / newScale - centerY;
    // const newX = (padView.x - (pad.width / 2)) * (newScale / padView.scale) + pad.width / 2;
    // const newY = (padView.y - (pad.height / 2)) * (newScale / padView.scale) + pad.height / 2;
    Events.send(padViewChange, {x: newX, y: newY, scale: newScale});
  } else if (navigationAction === "home") {
    let minLeft = Number.MAX_VALUE;
    let minTop = Number.MAX_VALUE;
    let maxRight = Number.MIN_VALUE;
    let maxBottom = Number.MIN_VALUE;

    if (positions.map.size === 0) {
      Events.send(padViewChange, {x: 0, y: 0, scale: 1});
      return;
    }
    for (let [_, position] of positions.map) {
      minLeft = Math.min(position.x, minLeft);
      minTop = Math.min(position.y, minTop);
      maxRight = Math.max(position.x + position.width, maxRight);
      maxBottom = Math.max(position.y + position.height, maxBottom);
    }

    const pad = document.body.querySelector("#pad").getBoundingClientRect();

    const scaleX = pad.width / (maxRight - minLeft);
    const scaleY = pad.height / (maxBottom - minTop);
    const scale = Math.min(1, scaleX, scaleY) * 0.9;

    const centerX = (maxRight + minLeft) / 2;
    const centerY = (maxBottom + minTop) / 2;
    let x = (pad.width / 2 / scale - centerX);
    let y = (pad.height / 2 / scale - centerY);
    Events.send(padViewChange, {x, y, scale, force: true});
  }
})(navigationAction, positions, padView);`],
[`31`, `const showGraph = Behaviors.collect(
  "showGraph",
  Events.listener(renkon.querySelector("#showGraph"), "click", (evt) => evt),
  (now, _click) => {
    if (now === "showGraph") {return "showDeps";}
    if (now === "showDeps") {return "hide";}
    if (now === "hide") {return "showGraph"}
    return now;
  }
);`],
[`32`, `((showGraph) => {
  let str;
  if (showGraph === "showGraph") {str = "show graph";}
  if (showGraph === "showDeps") {str = "show deps";}
  if (showGraph === "hide") {str = "hide graph"}
  document.querySelector("#showGraph").textContent = str;
})(showGraph);`],
[`33`, `const _onRun = ((runRequest, windowContents, windowEnabled) => {
  const id = runRequest.id;
  const iframe = windowContents.map.get(id);
  const code = [...windowContents.map]
    .filter(([id, obj]) => obj.state && windowEnabled.map.get(id).enabled)
    .map(([_id, editor]) => editor.state.doc.toString());
  iframe.dom.contentWindow.postMessage({code: code, path: id});
})(runRequest, windowContents, windowEnabled);`],
[`34`, `const _onInspect = ((inspectRequest) => {
  const id = inspectRequest.id;
  const iframe = windowContents.map.get(id);
  iframe.dom.contentWindow.postMessage({inspector: true, path: id});
})(inspectRequest);`],
[`35`, `const remove = Events.receiver();`],
[`36`, `const titleEditChange = Events.receiver();`],
[`37`, `const enabledChange = Events.receiver();`],
[`38`, `const pinRequest = Events.receiver();`],
[`39`, `const runRequest = Events.receiver();`],
[`40`, `const inspectRequest = Events.receiver();`],
[`41`, `const _goTo = ((padView, positions, dblClick) => {
  const strId = dblClick.target.id;
  if (!strId.endsWith("-titleBar")) {return;}
  const id = Number.parseInt(strId);
  const position = positions.map.get(\`\${id}\`);

  const pad = document.body.querySelector("#pad").getBoundingClientRect();

  const scaleX = pad.width / position.width;
  const scaleY = pad.height / position.height;
  const scale = Math.min(scaleX, scaleY) * 0.95;

  const centerX = position.x + position.width / 2;
  const centerY = position.y + position.height / 2;

  const x = pad.width / 2 / scale - centerX;
  const y = pad.height / 2 / scale - centerY;

  Events.send(padViewChange, {x, y, scale});
})(padView, positions, dblClick);`],
[`42`, `const inputHandler = (evt) => {
  if (evt.key === "Enter") {
    evt.preventDefault();
    evt.stopPropagation();
    Events.send(titleEditChange, {
      id: \`\${Number.parseInt(evt.target.id)}\`,
      title: evt.target.textContent,
      state: false
    });
    evt.target.textContent = "";
  }
};`],
[`43`, `const _positionsCss = ((positions, zIndex, pinnedPositions, padView) => {
  let style = document.body.querySelector("#positions-css");
  if (!style) {
    style = document.createElement("style");
    style.id = "positions-css";
    document.body.appendChild(style);
  }

  const css = [...positions.map].map(([id, rect]) => {
    let x;
    let y;
    let scale;
    const pinned = pinnedPositions.map.get(id);
    if (!pinned) {
      x = rect.x;
      y = rect.y;
      scale = 1;
    } else {
      // t(x) = pinned.x
      // t(a) = a * padView.scale + padView.x;
      // x * padView.scale + padView.x = pinned.x;
      // x = pinned.x / padView.scale - padView.x;
      scale = pinned.scale / padView.scale;
      x = pinned.x / padView.scale - padView.x;
      y = pinned.y / padView.scale - padView.y;
      // console.log(pinned.x, scale, x, padView.x);
    }
    return \`
[id="\${id}-win"] {
    transform: translate(\${x}px, \${y}px) scale(\${scale});
    width: \${rect.width}px;
    height: \${rect.height}px;
    z-index: \${zIndex.map.get(id)};
}\`.trim();
  }).join("\\n");
  style.textContent = css;
})(positions, zIndex, pinnedPositions, padView);`],
[`44`, `const windowDOM = (id, title, windowContent, type, windowEnabled, pinnedPosition) => {
  return h("div", {
    key: \`\${id}\`,
    id: \`\${id}-win\`,
    "class": "window",
    pinned: !!pinnedPosition,
    ref: (ref) => {
      if (ref) {
        if (ref.querySelector(".windowHolder") !== windowContent.dom.parentNode) {
          ref.querySelector(".windowHolder").appendChild(windowContent.dom);
        }
      }
    },
    onPointerEnter: (evt) => Events.send(hovered, \`\${Number.parseInt(evt.target.id)}\`),
    onPointerLeave: (_evt) => Events.send(hovered, null)
  }, [
    h("div", {
      id: \`\${id}-titleBar\`,
      "class": "titleBar",
    }, [
      h("div", {
        id: \`\${id}-enabledButton\`,
        disabled: !!(windowEnabled && !windowEnabled.enabled),
        style: {
          display: \`\${type !== "code" ? "none" : "inheirt"}\`
        },
        "class": "titlebarButton enabledButton",
        onClick: (evt) => {
          Events.send(enabledChange, {
            id: \`\${Number.parseInt(evt.target.id)}\`,
            enabled: !windowEnabled || !windowEnabled.enabled});
        },
      }),
      h("div", {
        id: \`\${id}-runButton\`,
        "class": "titlebarButton runButton",
        type,
        onClick: (evt) => {
          Events.send(runRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
        },
      }),
      h("div", {
        id: \`\${id}-inspectorButton\`,
        "class": "titlebarButton inspectorButton",
        type,
        onClick: (evt) => {
          Events.send(inspectRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
        },
      }),
      h("div", {
        id: \`\${id}-title\`,
        "class": "title",
        contentEditable: \`\${title.state}\`,
        onKeydown: inputHandler,
      }, title.title),
      h("div", {
        id: \`\${id}-titleSpacer\`,
        "class": "titleSpacer",
      }),
      h("div", {
        id: \`\${id}-edit\`,
        "class": \`titlebarButton editButton\`,
        onClick: (evt) => {
          // console.log(evt);
          Events.send(titleEditChange, {id: \`\${Number.parseInt(evt.target.id)}\`, state: !title.state});
        },
      }, []),
      h("div", {
        id: \`\${id}-pin\`,
        "class": "titlebarButton pinButton",
        state: pinnedPosition ? "off" : "on",
        onClick: (evt) => {
          Events.send(pinRequest, {id: \`\${Number.parseInt(evt.target.id)}\`})
        }
      }),
      h("div", {
        id: \`\${id}-close\`,
        "class": "titlebarButton closeButton",
        onClick: (evt) => {
          Events.send(remove, {id: \`\${Number.parseInt(evt.target.id)}\`, type: "remove"})
        }
      }),
    ]),
    h("div", {
      id: \`\${id}-bottomRight-resize\`,
      corner: "bottomRight",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-topLeft-resize\`,
      corner: "topLeft",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-bottomLeft-resize\`,
      corner: "bottomLeft",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-topRight-resize\`,
      corner: "topRight",
      "class": "resizeHandler",
    }, []),
    h("div", {
      id: \`\${id}-windowHolder\`,
      blurred: \`\${type !== "code" ? false : (windowEnabled ? !windowEnabled.enabled : false)}\`,
      "class": "windowHolder",
    }, [])
  ])
};`],
[`45`, `const windowElements = ((windows, titles, windowContents, windowTypes, windowEnabled, pinnedPositions) => {
  return h("div", {id: "owner", "class": "owner"}, windows.map((id) => {
    return windowDOM(
      id,
      titles.map.get(id), windowContents.map.get(id),
      windowTypes.map.get(id), windowEnabled.map.get(id),
      pinnedPositions.map.get(id));
  }));
})(windows, titles, windowContents, windowTypes, windowEnabled, pinnedPositions);`],
[`46`, `const _windowRender = render(windowElements, document.querySelector("#mover"));`],
[`47`, `const loadRequest = Events.receiver();`],
[`48`, `const saveData = (windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
  const code = new Map(
    [...windowContents.map].map(([id, content]) => {
      if (content.state) {
        return [id, content.state.doc.toString()];
      } else if (content.doc) {
        return [id, content.doc];
      } else {
        return null;
      }
    }).filter(item => item !== null));
  const myTitles = new Map([...titles.map].map(([id, obj]) => ([id, {...obj, state: false}])));
  const data1 = stringify({
    version: 3,
    windows,
    positions,
    zIndex,
    titles: {map: myTitles},
    windowTypes,
    padTitle,
    windowEnabled
  });

  const data2 = stringifyCodeMap(code);

  return encodeURIComponent(data1) + encodeURIComponent(data2);
};`],
[`49`, `const _saver2 = ((windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
  const data = saveData(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled);

  const dataStr = "data:text/plain;charset=utf-8," + data;
  const div = document.createElement("a");
  div.setAttribute("href", dataStr);
  div.setAttribute("download", \`\${padTitle}.renkon\`);
  div.click();
})(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled, save);`],
[`50`, `const _loader = (() => {
  const input = document.createElement("div");
  input.innerHTML = \`<input id="imageinput" type="file" accept=".json,.renkon">\`;
  const imageInput = input.firstChild;

  imageInput.onchange = () => {
    const file = imageInput.files[0];
    if (!file) {imageInput.remove(); return;}
    new Promise(resolve => {
      let reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsArrayBuffer(file);
    }).then((data) => {
      const result = new TextDecoder("utf-8").decode(data);
      loadData(result, imageInput);
    });
    imageInput.value = "";
  };
  imageInput.oncancel = () => imageInput.remove();
  document.body.appendChild(imageInput);
  imageInput.click();
})(load);`],
[`51`, `const nameFromUrl = (() => {
  const maybeUrl = new URL(window.location).searchParams.get("file");
  if (maybeUrl) {
    return maybeUrl;
  }
  return undefined;
})();`],
[`52`, `const loadData = (result, maybeImageInput) => {
  const index = result.indexOf("{__codeMap: true, value:");
  if (index < 0) {
    const loaded = parse(result);
    if (loaded.version === 1) {
      Events.send(loadRequest, loaded);
      maybeImageInput?.remove();
      return;
    }
    console.log("unknown type of data");
    maybeImageInput?.remove();
    return;
  }

  const data1 = result.slice(0, index);
  const data2 = result.slice(index);

  const loaded = parse(data1);

  if (loaded.version === 2 || loaded.version === 3) {
    const code = parseCodeMap(data2);
    loaded.code = code;
    Events.send(loadRequest, loaded);
    maybeImageInput?.remove();
    return;
  }
  console.log("unknown type of data");
  maybeImageInput.remove();
}`],
[`53`, `const _loadFromUrl = fetch(nameFromUrl).then((resp) => resp.text()).then((result) => {
  loadData(result, null);
});`],
[`54`, `const stringifyInner = (node, seen) => {
  if (node === undefined) return undefined;
  if (typeof node === 'number') return Number.isFinite(node) ? \`\${node}\` : 'null';
  if (typeof node !== 'object') return JSON.stringify(node, null, 4);

  let out;
  if (Array.isArray(node)) {
    out = '[';
    for (let i = 0; i < node.length; i++) {
      if (i > 0) out += ',';
      out += stringifyInner(node[i], seen) || 'null';
    }
    return out + ']';
  }

  if (node === null) return 'null';

  if (seen.has(node)) {
    throw new TypeError('Converting circular structure to JSON');
  }

  seen.add(node);

  if (node.constructor === window.Map) {
    let replacement = {__map: true, values: [...node]};
    return stringifyInner(replacement, seen);
  }

  if (node.constructor === window.Set) {
    let replacement = {__set: true, values: [...node]};
    return stringifyInner(replacement, seen);
  }

  let keys = Object.keys(node).sort();
  out = '';
  for (let i = 0; i < keys.length; i++) {
    let key = keys[i];
    let value = stringifyInner(node[key], seen, out);
    if (!value) continue;
    if (out !== '') out += ',\\n';
    out += JSON.stringify(key) + ':' + value;
  }
  seen.delete(node);
  return '{' + out + '}';
}`],
[`55`, `const stringify = (obj) => {
  let seen = new Set();
  return stringifyInner(obj, seen);
}`],
[`56`, `const parse = (string) => {
  return JSON.parse(string, (_key, value) => {
    if (typeof value === "object" && value !== null && value.__map) {
      return new Map(value.values);
    } else if (typeof value === "object" && value !== null && value.__set) {
      return new Set(value.values);
    }
    return value;
  });
}`],
[`57`, `const stringifyCodeMap = (map) => {
  const replace = (str) => {
    return str.replaceAll("\\\\", "\\\\\\\\").replaceAll("\`", "\\\\\`").replaceAll("\$", "\\\\\$");
  }

  return "\\n{__codeMap: true, value: " + "[" +
    [...map].map(([key, value]) => ("[" + "\`" + replace(key) + "\`" + ", " + "\`" +
                                    replace(value) + "\`" + "]")).join(",\\n") + "]" + "}"
}`],
[`58`, `const parseCodeMap = (string) => {
  const array = eval("(" + string + ")");
  return new Map(array.value);
}`],
[`59`, `const css = \`
@font-face {
  font-family: "OpenSans-Regular";
  src: url("./assets/fonts/open-sans-v17-latin-ext_latin-regular.woff2") format("woff2");
}

@font-face {
  font-family: 'OpenSans-SemiBold';
  src: url("./assets/fonts/open-sans-v17-latin-ext_latin-600.woff2") format('woff2');
}

html, body, #renkon {
  overflow: hidden;
  height: 100%;
  margin: 0px;
}

html, body {
  overscroll-behavior-x: none;
  touch-action: none;
}

#pad {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0px;
  left: 0px;
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAjElEQVR4XuXQAQ0AAAgCQfoHpYbOGt5vEODSdgovd3I+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+wIcWxEeefYmM2dAAAAAASUVORK5CYII=);
}

#mover {
  pointer-events: none;
  position:absolute;
  transform-origin: 0px 0px;
}

#owner {
  position: absolute;
  pointer-events: initial;
}

.editor {
  height: 100%;
  border-radius: 0px 0px 6px 6px;
}

#overlay {
  pointer-events: none;
  height: 100%;
  width: 100%;
  position: absolute;
  top: 0px;
  left: 0px;
  z-index: 10000;
}

.window {
  position: absolute;
  transform-origin: 0px 0px;
  background-color: #eee;
  border-radius: 6px;
  box-shadow: inset 0 2px 2px 0 rgba(255, 255, 255, 0.8), 1px 1px 8px 0 rgba(0, 35, 46, 0.2);
}

.window[pinned="true"] {
  box-shadow: inset 0 4px 4px 0 rgba(255, 255, 255, 0.8), 8px 8px 8px 0 rgb(208 53 53 / 20%);
}

#buttonBox {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-end;
  row-gap: 8px;
  left: 0px;
  top: 0px;
  width: 100%;
  padding-bottom: 8px;
  padding-top: 8px;
  border-bottom: 1px solid black;
  background-color: white;
  position: absolute;
  z-index: 200000;
}

#padTitle {
  margin-left: 24px;
}

.spacer {
  flex-grow: 1;
}

.menuButton {
  font-family: 'OpenSans-SemiBold';
  color: black;
  margin-left: 4px;
  margin-right: 4px;
  border-radius: 4px;
  cursor: pointer;
  border: 2px solid #555;
}

.runnerIframe {
  width: 100%;
  height: 100%;
  border: 2px solid black;
  box-sizing: border-box;
  border-radius: 0px 0px 6px 6px;
  background-color: #fff;
  user-select: none;
}

.titleBar {
  background-color: #bbb;
  width: 100%;
  height: 28px;
  display: flex;
  /* border: 2px ridge #ccc;*/
  /* box-sizing: border-box; */
  border-radius: 6px 6px 0px 0px;
  cursor: -webkit-grab;
  cursor: grab;
  overflow: hidden;
}

.title {
  font-family: OpenSans-Regular;
  pointer-events: none;
  margin-right: 10px;
  margin-left: 10px;
  margin-top: 2px;
  padding-left: 10px;
  padding-right: 10px;
  max-width: calc(100% - 150px);
  text-wrap: nowrap;
}

.title[contentEditable="true"] {
  background-color: #eee;
  pointer-events: all;
  user-select: all;
}

.titleSpacer {
  flex-grow: 1;
  pointer-events: none;
}

.titlebarButton {
  height: 19px;
  width: 19px;
  min-width: 19px;
  min-height: 19px;
  margin: 2px;
  margin-top: 4px;
  pointer-events: all;
  border-radius: 4px;
  background-position: center;
  cursor: pointer;
}

.titlebarButton:hover {
  background-color: #eee;
}

.closeButton {
  background-image: url("data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20data-name%3D%22Layer%201%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M8.48%2C12.25C6.4%2C10.17%2C4.37%2C8.16%2C2.35%2C6.15c-.34-.34-.68-.69-1-1.05a2.34%2C2.34%2C0%2C0%2C1%2C.17-3.26%2C2.3%2C2.3%2C0%2C0%2C1%2C3.25-.09C7%2C3.93%2C9.23%2C6.14%2C11.45%2C8.34a5.83%2C5.83%2C0%2C0%2C1%2C.43.58c.36-.4.62-.71.9-1%2C2-2%2C4.12-4%2C6.12-6.08a2.51%2C2.51%2C0%2C0%2C1%2C3.41%2C0%2C2.37%2C2.37%2C0%2C0%2C1%2C0%2C3.43c-2.18%2C2.22-4.39%2C4.41-6.58%2C6.62-.11.1-.21.22-.34.35l.44.48L22.09%2C19A2.7%2C2.7%2C0%2C0%2C1%2C23%2C20.56a2.49%2C2.49%2C0%2C0%2C1-1.29%2C2.54A2.36%2C2.36%2C0%2C0%2C1%2C19%2C22.69c-2-2-4-4-6.06-6-.33-.33-.62-.68-1-1.12-1.63%2C1.66-3.17%2C3.25-4.73%2C4.82-.79.8-1.6%2C1.59-2.42%2C2.36a2.32%2C2.32%2C0%2C0%2C1-3.21-.1%2C2.3%2C2.3%2C0%2C0%2C1-.19-3.25c2.14-2.2%2C4.31-4.36%2C6.48-6.54Z%22%20fill%3D%22%234D4D4D%22%2F%3E%3C%2Fsvg%3E");
}

.editButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3C!--%20Generator%3A%20Sketch%2064%20(93537)%20-%20https%3A%2F%2Fsketch.com%20--%3E%3Ctitle%3Eicon%2Fmaterial%2Fedit%3C%2Ftitle%3E%3Cdesc%3ECreated%20with%20Sketch.%3C%2Fdesc%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fedit%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-round-edit%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M3%2C17.46%20L3%2C20.5%20C3%2C20.78%203.22%2C21%203.5%2C21%20L6.54%2C21%20C6.67%2C21%206.8%2C20.95%206.89%2C20.85%20L17.81%2C9.94%20L14.06%2C6.19%20L3.15%2C17.1%20C3.05%2C17.2%203%2C17.32%203%2C17.46%20Z%20M20.71%2C7.04%20C20.8972281%2C6.85315541%2021.002444%2C6.59950947%2021.002444%2C6.335%20C21.002444%2C6.07049053%2020.8972281%2C5.81684459%2020.71%2C5.63%20L18.37%2C3.29%20C18.1831554%2C3.10277191%2017.9295095%2C2.99755597%2017.665%2C2.99755597%20C17.4004905%2C2.99755597%2017.1468446%2C3.10277191%2016.96%2C3.29%20L15.13%2C5.12%20L18.88%2C8.87%20L20.71%2C7.04%20Z%22%20id%3D%22Icon-Shape%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.runButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%2F%3E%3C!--%20Right-pointing%20triangle%20(play%20icon)%20--%3E%3Cpath%20d%3D%22M9%207L17%2012L9%2017Z%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
  display: none;
  pointer-events: none;
}

.pinButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22%234D4D4D%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%221.8%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Scaled%20filled%20top%20--%3E%3Cellipse%20cx%3D%2212%22%20cy%3D%226.5%22%20rx%3D%223.2%22%20ry%3D%221.6%22%2F%3E%3C!--%20Scaled%20neck%20as%20filled%20trapezoid%20--%3E%3Cpolygon%20points%3D%229.8%2C8.3%2014.2%2C8.3%2014.8%2C11.5%209.2%2C11.5%22%2F%3E%3C!--%20Scaled%20filled%20base%20--%3E%3Cellipse%20cx%3D%2212%22%20cy%3D%2213.2%22%20rx%3D%225%22%20ry%3D%221.8%22%2F%3E%3C!--%20Scaled%20short%20pin%20--%3E%3Cline%20x1%3D%2212%22%20y1%3D%2214.9%22%20x2%3D%2212%22%20y2%3D%2220%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.pinButton[state="off"] {
  transform-origin: center;
  transform: rotate(40deg);
}

.runButton[type="runner"] {
  display: inherit;
  pointer-events: all;
}

.resizeHandler {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 6px;
  z-index: 10000;
  background-color: rgba(0.1, 0.1, 0.1, 0.03);
}

.resizeHandler[corner="bottomRight"] {
  cursor: se-resize;
  bottom: -15px;
  right: -15px;
}

.resizeHandler[corner="topLeft"] {
  cursor: nw-resize;
  top: -15px;
  left: -15px;
}

.resizeHandler[corner="bottomLeft"] {
  cursor: sw-resize;
  bottom: -15px;
  left: -15px;
}

.resizeHandler[corner="topRight"] {
  cursor: ne-resize;
  top: -15px;
  right: -15px;
}

.resizeHandler:hover {
  background-color: rgba(0.1, 0.4, 0.1, 0.3);
}

.windowHolder {
  height: calc(100% - 24px);
  box-sizing: border
}

.windowHolder[blurred="true"] {
  filter: blur(4px)
}

#navigationBox {
  display: flex;
  flex-direction: column;
  right: 20px;
  gap: 10px;
  bottom: 80px;
  align-items: center;
  width: 40px;
  border: 1px solid black;
  background-color: #d2d2d2;
  position: absolute;
  z-index: 200000;
  border-radius: 8px;
  box-shadow: 4px 5px 8px -2px rgba(0,0,0,.15);
}

.navigationButton {
  width: 30px;
  height: 30px;
  display: flex;
  cursor: pointer;
}

.with-border {
  border: 1px solid #4D4D4D;
  border-radius: 15px;
  background-color: white;
}

.navigationButton:hover {
  background-color: #eaeaea;
}

.navigationButton:first-child {
  margin-top: 10px;
}

.navigationButton:last-child {
  margin-bottom: 10px;
}

.navigationButtonImage {
  width: 100%;
  height: 100%;
  background-position: center;
  background-repeat: no-repeat;
}

#zoomInButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-in%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-in%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-add%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2013%2013%2013%2013%2019%2011%2019%2011%2013%205%2013%205%2011%2011%2011%2011%205%2013%205%2013%2011%2019%2011%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#zoomOutButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-out%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-out%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-minus%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2012.998%205%2012.998%205%2010.998%2019%2010.998%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#homeButton {
  background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fview-centered%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fview-centered%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22Group-3%22%20transform%3D%22translate(2.000000%2C%204.000000)%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M0%2C9%20L3%2C9%20L3%2C7%20L0%2C7%20L0%2C9%20Z%20M17%2C9%20L20.001%2C9%20L20.001%2C7%20L17%2C7%20L17%2C9%20Z%20M9%2C3%20L11%2C3%20L11%2C0%20L9%2C0%20L9%2C3%20Z%20M13%2C9%20L11%2C9%20L11%2C11%20L9%2C11%20L9%2C9%20L7%2C9%20L7%2C7%20L9%2C7%20L9%2C5%20L11%2C5%20L11%2C7%20L13%2C7%20L13%2C9%20Z%20M9%2C16%20L11%2C16%20L11%2C13%20L9%2C13%20L9%2C16%20Z%20M13%2C0%20L13%2C2%20L18%2C2%20L18%2C5%20L20%2C5%20L20%2C0%20L13%2C0%20Z%20M18%2C14%20L13%2C14%20L13%2C16%20L20%2C16%20L20%2C11%20L18%2C11%20L18%2C14%20Z%20M0%2C5%20L2%2C5%20L2%2C2%20L7%2C2%20L7%2C0%20L0%2C0%20L0%2C5%20Z%20M2%2C11%20L0%2C11%20L0%2C16%20L7%2C16%20L7%2C14%20L2%2C14%20L2%2C11%20Z%22%20id%3D%22Fill-1%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20stroke-width%3D%222%22%2F%3E%3C!--%20Thicker%20checkmark%20--%3E%3Cpath%20d%3D%22M5.5%2012.5L10.5%2017.5L18.5%207.5%22%20stroke-width%3D%223%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton[disabled="true"] {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%3C%2Fsvg%3E");
}

.inspectorButton {
  background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Line%201%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%227%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%227%22%20x2%3D%2219%22%20y2%3D%227%22%2F%3E%3C!--%20Line%202%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2212%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2212%22%20x2%3D%2219%22%20y2%3D%2212%22%2F%3E%3C!--%20Line%203%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2217%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2217%22%20x2%3D%2219%22%20y2%3D%2217%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
  display: none;
  pointer-events: none;
}

.inspectorButton[type="runner"] {
  display: inherit;
  pointer-events: all;
}

.cm-tooltip-lint {
  font-size: 12px;
}

.cm-tooltip-dependency {
  background-color: #66b;
  color: white;
  border: none;
  padding: 2px 7px;
  border-radius: 4px;
}

.cm-tooltip-cursor-wide {
  text-wrap: nowrap;
}
\`;`],
[`60`, `((css, renkon) => {
  const style = document.createElement("style");
  style.id = "pad-css";
  style.textContent = css;
  renkon.querySelector("#pad-css")?.remove();
  renkon.appendChild(style);
})(css, renkon);`],
[`61`, `const analyzed = ((windowContents, windowEnabled, trigger, showGraph) => {
  if (!showGraph) {return new Map()}
  if (trigger === null) {return new Map()}
  if (typeof trigger === "object" && trigger.id) {return new Map();}
  const programState = new Renkon.constructor(0);
  programState.setLog(() => {});

  const blockMap = new Map() // name -> blockId
  const nodes = new Map(); // blockId -> {exports:Set, imports: Set}
  const edges = new Map(); // blockId -> {edgesOut: [{id, dest}], edgesIn: [{id, origin}], exports: [id]}

  const code = [...windowContents.map].filter(
    ([id, editor]) => editor.state && windowEnabled.map.get(id)?.enabled)
    .map(([id, editor]) => ({blockId: id, code: editor.state.doc.toString()}));
  try {
    code.forEach(info => {
      const blockId = info.blockId;
      programState.setupProgram([info.code]);
      nodes.set(blockId, {exports: new Set(), imports: new Set()});
      edges.set(blockId, {edgesOut: [], edgesIn: [], exports: []});
      const obj = nodes.get(blockId);
      for (const jsNode of programState.nodes.values()) {
        for (const input of jsNode.inputs) {
          if (/^_[0-9]/.test(input)) {continue;}
          obj.imports.add(input)
        }
        if (jsNode.outputs === "") {continue;}
        if (/^_[0-9]/.test(jsNode.outputs)) {continue;}
        blockMap.set(jsNode.outputs, blockId)
        obj.exports.add(jsNode.outputs);
      }
    });
  } catch(e) {
    console.log("Graph analyzer encountered an error in source code:");
    return new Map();
  }

  for (let [id, obj] of nodes) {
    for (const exported of obj.exports) {//exported:string
      const edgesOut = edges.get(id).edgesOut;
      const exports = edges.get(id).exports;
      for (let [importId, importObj] of nodes) {
        if (importId === id) {continue;}
        const edgesIn = edges.get(importId).edgesIn;
        if (importObj.imports.has(exported)) {
          if (edgesOut.findIndex((already) => already.id === exported && already.dest === importId) < 0) {
            edgesOut.push({id: exported, dest: importId});
            if (exports.indexOf(exported) < 0) {
              exports.push(exported);
            }
          }
          if (edgesIn.findIndex((already) => already.id === exported && already.origin === id) < 0) {
            edgesIn.push({id: exported, origin: id});
          }
        }
      }
    }
  }
  return edges;
})(windowContents, windowEnabled, Events.or(remove, hovered), showGraph === "showGraph");`],
[`62`, `const line = (p1, p2, color, label) => {
  let pl;
  let pr;
  if (p1.x < p2.x) {
    pl = p1;
    pr = p2;
  } else {
    pl = p2;
    pr = p1;
  }
  const c0 = \`\${pl.x} \${pl.y}\`;
  const c1 = \`\${pl.x + (pr.x - pl.x) * 0.5} \${pl.y + (pr.y - pl.y) * 0.2}\`;
  const c2 = \`\${pr.x - (pr.x - pl.x) * 0.2} \${pl.y + (pr.y - pl.y) * 0.6}\`;
  const c3 = \`\${pr.x} \${pr.y}\`;
  return html\`<path d="M \${c0} C \${c1} \${c2} \${c3}" stroke="\${color}"
    fill="transparent" stroke-width="2" stroke-linecap="round"></path><text
    x="\${p1.x + 5}" y="\${p1.y}">\${label}</text>\`;
};`],
[`63`, `const hovered = Events.receiver();`],
[`64`, `const hoveredB = Behaviors.keep(hovered);`],
[`65`, `const graph = ((positions, padView, analyzed, hoveredB, showGraph) => {
  if (hoveredB === null) {return [];}
  if (!showGraph) {return [];}

  const edges = analyzed.get(hoveredB);

  if (!edges) {return [];} // runner does not have edges

  const exportEdges = new Set();
  const importEdges = new Set();

  const outEdges = edges.edgesOut.map((edge) => {
    const ind = edges.exports.indexOf(edge.id);
    let p1 = positions.map.get(hoveredB);
    p1 = {x: p1.x + p1.width, y: p1.y};
    // p1 = {x: p1.x * padView.scale + padView.x, y: p1.y * padView.scale + padView.y};
    p1 = {x: (p1.x + padView.x) * padView.scale, y: (p1.y + padView.y) * padView.scale};
    p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
    let p2 = positions.map.get(edge.dest);
    p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
    p2 = {x: p2.x, y: p2.y + 10};
    let e = "";
    if (!exportEdges.has(edge.id)) {
      exportEdges.add(edge.id);
      e = edge.id;
    }
    return line(p1, p2, "#d88", e);
  });

  const inEdges = edges.edgesIn.map((edge) => {
    const exporter = analyzed.get(edge.origin);
    const ind = exporter.exports.indexOf(edge.id);
    let p1 = positions.map.get(edge.origin);
    p1 = {x: p1.x + p1.width, y: p1.y};
    p1 = {x: (p1.x + padView.x) * padView.scale , y: (p1.y + padView.y) * padView.scale};
    p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
    let p2 = positions.map.get(hoveredB);
    p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
    p2 = {x: p2.x, y: p2.y + 10};
    let e = "";
    if (!importEdges.has(edge.id)) {
      importEdges.add(edge.id);
      e = edge.id;
    }
    return line(p1, p2, "#88d", e);
  });

  return html\`<svg viewBox="0 0 \${window.innerWidth} \${window.innerHeight}"
                     xmlns="http://www.w3.org/2000/svg">\${outEdges}\${inEdges}</svg>\`;
})(positions, padView, Behaviors.keep(analyzed), hoveredB, showGraph === "showGraph");`],
[`66`, `const _graphRender = render(graph, document.querySelector("#overlay"));`],
[`67`, `const windows = Behaviors.select(
  [\`\${initialData.id}\`],
  loadRequest, (_prev, data) => {
    return data.windows
  },
  newWindowRequest, (prev, spec) => [...prev, \`\${spec.id}\`],
  remove, (prev, removeCommand) => prev.filter((e) => e != removeCommand.id),
);`],
[`68`, `const windowTypes = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, data) => {
    return data.windowTypes;
  },
  newWindowRequest, (prev, spec) => {
    prev.map.set(\`\${spec.id}\`, spec.type);
    return {map: prev.map};
  },
  windows, (prev, windows) => {
    const keys = [...prev.map.keys()];
    const news = windows.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !windows.includes(e));

    olds.forEach((id) => prev.map.delete(\`\${id}\`));
    news.forEach((id) => prev.map.set(\`\${id}\`, "code"));
    return {map: prev.map};
  }
);`],
[`69`, `const positions = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, data) => {
    return data.positions;
  },
  windowTypes, (prev, types) => {
    const keys = [...prev.map.keys()];
    const typeKeys = [...types.map.keys()];
    const news = typeKeys.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !typeKeys.includes(e));

    const newX = (typeKeys.length * 5 + 40) / padView.scale - padView.x;
    const newY = (typeKeys.length * 5 + 45) / padView.scale - padView.y;

    const newWindow = (id, type) => {
      return {
        id,
        x: newX,
        y: newY,
        width: type === "code" ? 300 : 800,
        height: type === "code" ? 200 : 400
      }
    };
    olds.forEach((id) => prev.map.delete(\`\${id}\`));
    news.forEach((id) => prev.map.set(\`\${id}\`, newWindow(id, types.map.get(id))));
    return {map: prev.map};
  },
  moveOrResize, (prev, command) => {
    const v = {...prev.map.get(command.id), ...command};
    prev.map.set(command.id, v);
    return {map: prev.map};
  }
);`],
[`70`, `const pinnedPositions = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, _data) => {
    return {map: new Map()}
  },
  pinRequest, (prev, pinRequest) => {
    const {id} = pinRequest;
    if (prev.map.get(id)) {
      prev.map.delete(id);
      return {map: prev.map};
    }

    const position = positions.map.get(id);
    const screenRect = {
      height: position.height * padView.scale,
      width: position.width * padView.scale,
      x: (position.x + padView.x) * padView.scale,
      y: (position.y + padView.y) * padView.scale,
      scale: padView.scale
    };
    prev.map.set(id, screenRect);
    return {map: prev.map};
  },
  windowTypes, (prev, types) => {
    const keys = [...prev.map.keys()];
    const typeKeys = [...types.map.keys()];
    const olds = keys.filter((e) => !typeKeys.includes(e));
    olds.forEach((id) => prev.map.delete(\`\${id}\`));
    return {map: prev.map};
  },
  home, (_prev, _home) => {
    return {map: new Map()}
  }
)`],
[`71`, `const findMax = (map)  => {
  let maxId = -1;
  let max = -1;
  for (let [id, value] of map) {
    if (value > max) {
      maxId = id;
      max = value;
    }
  }
  return {maxId, max};
};`],
[`72`, `const zIndex = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, data) => {
    if (data.zIndex) return data.zIndex;
    return {map: new Map(data.windows.map((w, i) => [w, i + 100]))};
  },
  windows, (prev, command) => {
    const keys = [...prev.map.keys()];
    const news = command.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !command.includes(e));

    const {maxId:_maxId, max} = findMax(prev.map);
    let z = max < 0 ? 100 : max + 1;
    olds.forEach((id) => prev.map.delete(id));
    news.forEach((id) => prev.map.set(id, z++));
    return {map: prev.map};
  },
  moveOrResize, (prev, command) => {
    if (command.type === "move") {
      const z = prev.map.get(command.id);

      const {maxId, max} = findMax(prev.map);
      if (maxId !== command.id) {
        prev.map.set(maxId, z);
        prev.map.set(command.id, max);
      }
      return {map: prev.map};
    }
    return prev;
  },
);`],
[`73`, `const titles = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, loaded) => {
    return loaded.titles || {map: new Map()};
  },
  windows, (prev, command) => {
    const keys = [...prev.map.keys()];
    const news = command.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !command.includes(e));

    olds.forEach((id) => prev.map.delete(id));
    news.forEach((id) => prev.map.set(id, {id, state: false, title: "untitled"}));
    return {map: prev.map};
  },
  titleEditChange, (prev, change) => {
    const id = change.id;
    const v = {...prev.map.get(id), ...change};
    prev.map.set(id, v);
    return {map: prev.map};
  }
);`],
[`74`, `const windowEnabled = Behaviors.select(
  {map: new Map()},
  loadRequest, (_prev, loaded) => {
    return loaded.windowEnabled || {map: new Map()};
  },
  windows, (prev, command) => {
    const keys = [...prev.map.keys()];
    const news = command.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !command.includes(e));

    olds.forEach((id) => prev.map.delete(id));
    news.forEach((id) => prev.map.set(id, {id, enabled: true}));
    return {map: prev.map};
  },
  enabledChange, (prev, change) => {
    const id = change.id;
    const v = {...prev.map.get(id), ...change};
    prev.map.set(id, v);
    return {map: prev.map};
  }
);`],
[`75`, `const windowContents = Behaviors.select(
  {map: new Map()},
  loadRequest, (prev, loaded) => {
    for (let editor of prev.map.values()) {
      editor.dom.remove();
    }
    prev.map.clear();

    for (let [id, type] of loaded.windowTypes.map) {
      let elem;
      if (type === "runner") {
        elem = newRunner(id)
      } else if (type === "doc") {
        elem = newDocPane(id, loaded.code.get(id));
      } else {
        elem = newEditor(id, loaded.code.get(id));
      }
      prev.map.set(id, elem);
    }
    return {map: prev.map};
  },
  windowTypes, (prev, types) => {
    const keys = [...prev.map.keys()];
    const typeKeys = [...types.map.keys()];
    const news = typeKeys.filter((e) => !keys.includes(e));
    const olds = keys.filter((e) => !typeKeys.includes(e));
    olds.forEach((id) => {
      const editor = prev.map.get(id);
      editor.dom.remove();
      prev.map.delete(id)
    });
    news.forEach((id) => {
      const type = types.map.get(id);
      let elem;
      if (type === "runner") {
        elem = newRunner(id);
      } else if (type === "doc") {
        elem = newDocPane(id ,"");
      } else {
        elem = newEditor(id)
      }
      prev.map.set(id, elem);
    });
    return {map: prev.map};
  },
  docUpdate, (prev, docUpdate) => {
    const {id, code} = docUpdate;
    let elem = prev.map.get(id);
    if (!elem) {return prev;}
    elem.doc = code;
    return {map: prev.map};
  }
);`],
[`76`, `const initialData = {id: 0, type: "code"};`],
[`77`, `const newId = Behaviors.select(
  0,
  loadRequest, (_prev, request) => {
    if (request.windows.length === 0) {return 1;}
    const max = Math.max(...request.windows.map((w) => Number.parseInt(w)));
    return max;
  },
  Events.or(addCode, addRunner, addDoc), (prev, _type) => prev + 1
);`],
[`78`, `const newWindowRequest = {id: newId, type: Events.or(addCode, addRunner, addDoc)};`],
[`79`, `const modifierState = Behaviors.select(
  {shiftKey: false, ctrlKey: false, metaKey: false, scrollDirection: null},
  // scrollDirection: null|"vertical"|"horizontal"
  queuedKeydown, (prev, keydown) => {
    const ret = {...prev};
    keydown.forEach((key) => {
      ret.shiftKey = ret.shiftKey || key.key === "Shift";
      ret.ctrlKey = ret.ctrlKey || key.key === "Control";
      ret.metaKey = ret.metaKey || key.key === "Meta";
    });
    return ret;
  },
  queuedKeyup, (prev, keyup) => {
    const ret = {...prev};
    let reset = false;
    keyup.forEach((key) => {
      reset = reset || ["Shift", "Control", "Meta"].includes(key.key);
      if (key.key === "Shift") {ret.shiftKey = false;}
      if (key.key === "Control") {ret.ctrlKey = false;}
      if (key.key === "Meta") {ret.metaKey = false;}
    });
    if (reset) {ret.scrollDirection = null;}
    return ret;
  },
  wheeling, (prev, wheeling) => {
    if (prev.scrollDirection === null && wheeling.scrollDirection) {
      const ret = {...prev};
      ret.scrollDirection = wheeling.scrollDirection;
      return ret;
    }
    return prev;
  }
);`],
[`80`, `const padView = Behaviors.select(
  {x: 0, y: 0, scale: 1},
  padViewChange, (prev, view) => {
    let {x, y, scale, force} = view;
    if (!force) {
      if (scale < 0.1) {
        x = prev.x;
        y = prev.y;
        scale = 0.1;
      }
      if (scale > 20) {
        x = prev.x;
        y = prev.y;
        scale = 20;
      }
    }
    return {...prev, ...{x, y, scale}};
  }
);
`],
[`81`, `const padTitle = Behaviors.select(
  "untitled",
  loadRequest, (_prev, data) => {
    return data.padTitle || "untitled"
  },
  titleChange, (_prev, request) => request
);`],
[`82`, `const titleChange = Events.observe((notify) => {
  const change = (evt) => {
    notify(evt.target.value);
  };

  renkon.querySelector("#padTitle").addEventListener("input", change);
  return () => {renkon.querySelector("#padTitle").removeEventListener("change", change);}
});`],
[`83`, `const _padTitleUpdater = ((padTitle) => {
  if (renkon.querySelector("#padTitle").value !== padTitle) {
    renkon.querySelector("#padTitle").value = padTitle;
  }
})(padTitle);`],
[`84`, `const _focus = ((renkon) => {
  renkon.querySelector("#padTitle").focus();
  renkon.querySelector("#padTitle").blur();
})(renkon);`],
[`85`, `const readyMessages = Events.listener(
  window,
  "message",
  evt => {
    if (typeof evt.data.ready === "string" && evt.data.ready.startsWith("renkon-ready")) {
      return evt;
    }
  }, {queued: true});`],
[`86`, `const {h, html, render} = import("./preact.standalone.module.js");`],
[`87`, `const renkon = (() => {
  const renkon = document.createElement("div");
  renkon.id = "renkon";
  renkon.innerHTML = \`
<div id="buttonBox">
   <input class="menuButton" id="padTitle"></input>
   <button class="menuButton" id="addCodeButton">code</button>
   <button class="menuButton" id="addDocButton">doc</button>
   <button class="menuButton" id="addRunnerButton">runner</button>
   <div class="spacer"></div>
   <button class="menuButton" id="searchButton">search</button>
   <button class="menuButton" id="showGraph">show graph</button>
   <button class="menuButton" id="saveButton">save</button>
   <button class="menuButton" id="loadButton">load</button>
</div>
<div id="pad"><div id="mover"></div></div>
<div id="overlay"></div>
<div id="navigationBox">
   <div class="navigationButton"><div id="homeButton" class="navigationButtonImage"></div></div>
   <div class="navigationButton with-border"><div id="zoomInButton" class="navigationButtonImage"></div></div>
   <div class="navigationButton with-border"><div id="zoomOutButton" class="navigationButtonImage"></div></div>
</div>

\`.trim();

  document.body.querySelector("#renkon")?.remove();
  document.body.appendChild(renkon);
  return renkon;
})();`],
[`88`, `const searchPanel = ((renkon) => {
  let search = renkon.querySelector("#search");
  search?.remove();
  const div = document.createElement("div");
  div.innerHTML = \`
<div class="search-panels search-panels-bottom" style="bottom: 0px;">
  <div class="search-search search-panel">
    <input value="" placeholder="Find" aria-label="Find" class="search-textfield" name="search" form="" main-field="true">
    <button class="search-button" name="next" type="button">next</button>
    <!-- <button class="search-button" name="prev" type="button">previous</button>
    <button class="search-button" name="select" type="button">all</button> -->
    <label><input type="checkbox" name="case" form="">match case</label>
    <label><input type="checkbox" name="re" form="">regexp</label>
    <label><input type="checkbox" name="word" form="">by word</label>
    <!-- <input value="" placeholder="Replace" aria-label="Replace" class="search-textfield" name="replace" form="">
    <button class="search-button" name="replace" type="button">replace</button>
    <button class="search-button" name="replaceAll" type="button">replace all</button> -->
    <button name="close" aria-label="close" type="button">×</button>
  </div>
</div>
\`.trim();
  search = div.childNodes[0];
  search.id = "search";
  renkon.appendChild(search);
  return search;
})(renkon);`],
[`89`, `const newEditor = (id, doc) => {
  const mirror = window.CodeMirror;

  const config = {
    // eslint configuration
    languageOptions: {
      globals: mirror.globals,
      parserOptions: {
        ecmaVersion: 2022,
        sourceType: "module",
      },
    },
    rules: {
    },
  };

  const getDecl = (state, pos) => {
    const showDependency = Renkon.resolved.get("showGraph")?.value;
    if (!showDependency || showDependency !== "showDeps") {return;}
    let decls;
    try {
      decls = Renkon.findDecls(state.doc.toString());
    } catch(e) {
      console.log("Dependency analyzer encountered an error in source code:");
      return;
    }
    const head = pos !== undefined ? pos : state.selection.ranges[0]?.head;
    if (typeof head !== "number") {return;}
    const decl = decls.find((d) => d.start <= head && head < d.end);
    if (!decl) {return;}
    const programState = new Renkon.constructor(0);
    programState.setLog(() => {});
    try {
      programState.setupProgram([decl.code]);
    } catch (e) {
      console.log("could not find the declarations as there is a syntax error");
      return;
    }
    const keys = [...programState.nodes.keys()];
    const last = keys[keys.length - 1];
    const deps = [];
    for (const k of keys) {
      const is = programState.nodes.get(k).inputs;
      deps.push(...is.filter((n) => !/_[0-9]/.exec(n)));
    }
    return {deps, name: last}
  }

  const wordHover = mirror.view.hoverTooltip((view, pos, _side) => {
    let node = getDecl(view.state, pos);
    if (!node) return null;
    const {deps, name} = node;
    return {
      pos,
      above: true,
      create() {
        let dom = document.createElement("div");
        dom.textContent = \`\${deps} -> \${name}\`;
        dom.className = "cm-tooltip-dependency cm-tooltip-cursor-wide";
        return {dom};
      }
    };
  });

  const openSearch = ({_state, _dispatch }) => {
    Events.send(toggleSearchPanel, true);
    return true;
  };

  const search = {key: "Mod-f", run: openSearch, shift: openSearch};

  const cursorChange = mirror.view.ViewPlugin.fromClass(class {
    update(update) {
      if (update.selectionSet || update.docChanged) {
        this.reportCursor(update.view);
      }
    }

    reportCursor(view) {
      const pos = view.state.selection.main.head;
      Events.send(cursorChanged, {id: id, position: pos});
    }
  });

  const editor = new mirror.EditorView({
    doc: doc || \`console.log("hello")\`,
    extensions: [
      mirror.view.keymap.of([search]),
      mirror.basicSetup,
      mirror["lang-javascript"].javascript({typescript: true}),
      mirror.EditorView.lineWrapping,
      mirror.EditorView.editorAttributes.of({"class": "editor"}),
      mirror.view.keymap.of([mirror.commands.indentWithTab]),
      mirror.lint.linter(
        mirror["lang-javascript"]
          .esLint(new mirror["eslint-linter-browserify"].Linter(), config)),
      wordHover,
      cursorChange,
    ],
  });
  editor.dom.id = \`\${id}-editor\`;
  return editor;
};`],
[`90`, `const newRunner = (id) => {
  const runnerIframe = document.createElement("iframe");
  runnerIframe.srcdoc = \`
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      .dock {
        position: fixed;
        top: 0px;
        right: 0px;
        width: 35%;
        height: 80%;
        display: flex;
        box-shadow: 10px 10px 5px #4d4d4d, -10px -10px 5px #dddddd;
        transition: left 0.5s;
        background-color: white;
        z-index: 1000000;
        overflow-y: scroll;
      }

      .dock #inspector {
        flex-grow: 1;
        margin: 0px 20px 0px 20px;
        background-color: #ffffff;
        border: 1px solid black;
      }
    </style>
    <script type="module">
      import {ProgramState, CodeMirror, newInspector} from "./renkon-web.js";
      window.thisProgramState = new ProgramState(Date.now());
      window.CodeMirror = CodeMirror;
      window.newInspector = newInspector;

      window.onmessage = (evt) => {
        if (evt.data && Array.isArray(evt.data.code)) {
          window.thisProgramState.updateProgram(evt.data.code, evt.data.path);
        }
        if (evt.data && typeof evt.data.inspector === "boolean") {
          if (window.thisProgramState) {
            if (document.body.querySelector(".dock")) {
              document.body.querySelector(".dock").remove();
              return;
            }
            const dock = document.createElement("div");
            dock.classList.add("dock");
            const dom = document.createElement("div");
            dom.id = "renkonInspector";

            dock.appendChild(dom);
            document.body.appendChild(dock);
            const result = thisProgramState.order.map((id) => {
              return [
                id + " (" + thisProgramState.types.get(id) + ")",
                thisProgramState.resolved.get(id)
              ];
            });
            newInspector(Object.fromEntries(result), dom);
          }
        }
      };
      window.parent.postMessage({ready: "renkon-ready", type: "runner", id: "\${id}"});
    </script>
  </head>
  <body></body>
</html>\`.trim();
  runnerIframe.classList = "runnerIframe";
  runnerIframe.id = \`runner-\${id}\`;
  return {dom: runnerIframe};
};`],
[`91`, `const dblClick = Events.listener(renkon.querySelector("#pad"), "dblclick", (evt) => evt);`],
[`92`, `const rawPadDown = Events.listener(renkon.querySelector("#pad"), "pointerdown", (evt) => {
  const strId = evt.target.id;
  if (strId.endsWith("-title") && (evt.target.getAttribute("contenteditable") === "true")) {
    return evt;
  }
  if (strId) {
    evt.preventDefault();
    evt.stopPropagation();
  }
  return evt;
}, {queued: true});`],
[`93`, `const evCache = new Map();`],
[`94`, `const padDown = Events.collect(undefined, rawPadDown, (old, evts) => {
  let type;
  let id;
  let corner;
  if (evts.length <= 2 && evts[0].isPrimary) {
    let primary = evts[0];
    const strId = primary.target.id;
    if (!strId) {return {...old, type: ""};}
    let x = primary.clientX;
    let y = primary.clientY;
    if (strId === "pad") {
      type = "padDragDown";
      id = strId;
    } else {
      id = \`\${Number.parseInt(strId)}\`;
      if (strId.endsWith("-titleBar")) {
        type = "moveDown";
      } else if (strId.endsWith("-resize")) {
        corner = (/[0-9]+-(.*)-resize/.exec(strId))[1];
        type = "windowResizeDown";
      }
    }
    if (type) {
      primary.target.setPointerCapture(primary.pointerId);
      if (strId === "pad") {
        evCache.set("primary", {x, y});
      }
      if (evts.length === 1) {
        return {
          id, target: primary.target, type, x: primary.clientX, y: primary.clientY, corner
        };
      }
    } else {
      return {...old, type: ""};
    }
  }

  let secondary;
  if (evCache.get("primary")) {
    if (evts.length === 1 && evCache.size === 1 && !evts[0].isPrimary) {
      secondary = evts[0];
    }
    if (evts.length === 2 && evCache.size === 1 && !evts[1].isPrimary) {
      secondary = evts[1];
    }
  }
  if (!secondary) {return old;}

  const strId = secondary.target.id;
  if (strId !== "pad") {return {type: "stuck", secondary: secondary.pointerId};}
  let primary =  evCache.get("primary");
  let x = secondary.clientX;
  let y = secondary.clientY;
  let dx = primary.x - secondary.clientX;
  let dy = primary.y - secondary.clientY;
  let origDiff = Math.sqrt(dx * dx + dy * dy);
  evCache.set(secondary.pointerId, {origDiff, origScale: padView.scale, x, y});
  return {type: "pinch", secondary: secondary.pointerId};
});`],
[`95`, `const padUp = Events.listener(renkon.querySelector("#pad"), "pointerup", (evt) => {
  // console.log("ev1", evCache);
  evt.target.releasePointerCapture(evt.pointerId);
  evCache.clear();
  // console.log("ev2", evCache);
  return {type: "pointerup", x: evt.clientX, y: evt.clientY};
});`],
[`96`, `const downOrUpOrResize = Events.or(padDown, padUp, pointercancel, lostpointercapture, windowResize);`],
[`97`, `const _padMove = Events.listener("#pad", "pointermove", moveCompute);`],
[`98`, `const windowResize = Events.receiver();`],
[`99`, `const moveOrResize = Events.receiver();`],
[`100`, `const moveCompute = ((downOrUpOrResize, positions, padView) => {
  if (downOrUpOrResize.type === "moveDown" || downOrUpOrResize.type === "windowResizeDown") {
    const start = positions.map.get(downOrUpOrResize.id);
    const scale = padView.scale;
    const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
    const type = downOrUpOrResize.type === "moveDown" ? "move" : "resize";
    return (move) => {
      const diffX = (move.clientX - downPoint.x) / scale;
      const diffY = (move.clientY - downPoint.y) / scale;
      const result = {id: downOrUpOrResize.id, type};
      // const position = positions.map.get(downOrUpOrResize.id);
      if (type === "move") {
        if (pinnedPositions.map.get(downOrUpOrResize.id)) {return move;}
        result.x = start.x + diffX;
        result.y = start.y + diffY;
      } else {
        if (downOrUpOrResize.corner === "bottomRight") {
          const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
          const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
          result.width = start.width + realDiffX;
          result.height = start.height + realDiffY;
        } else if (downOrUpOrResize.corner === "topLeft") {
          const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
          const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
          result.width = start.width - realDiffX;
          result.height = start.height - realDiffY;
          result.x = start.x + realDiffX;
          result.y = start.y + realDiffY;
        } else if (downOrUpOrResize.corner === "topRight") {
          const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
          const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
          result.width = start.width + realDiffX;
          result.height = start.height - realDiffY;
          result.y = start.y + realDiffY;
        } else if (downOrUpOrResize.corner === "bottomLeft") {
          const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
          const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
          result.width = start.width - realDiffX;
          result.height = start.height + realDiffY;
          result.x = start.x + realDiffX;
        }
      }
      Events.send(moveOrResize, result);
      return move;
    }
  } else if (downOrUpOrResize.type === "padDragDown") {
    const start = padView;
    const scale = start.scale;
    const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
    const type = "padDrag";
    return (move) => {
      const diffX = move.clientX - downPoint.x;
      const diffY = move.clientY - downPoint.y;
      const result = {id: downOrUpOrResize.id, type, scale};
      result.x = start.x + (diffX / scale);
      result.y = start.y + (diffY / scale);
      Events.send(padViewChange, result);
      return move;
    };
  } else if (downOrUpOrResize.type === "pinch") {
    return (move) => {
      const keys = [...evCache.keys()];
      const primary = evCache.get("primary");
      if (!primary) {
        // the first finger has been lifted
        return move;
      }
      const otherKey = keys.find((k) => k !== "primary");
      const secondary = evCache.get(otherKey);
      const isPrimary = move.isPrimary;

      if (isPrimary) {
        const newRecord = {...primary};
        newRecord.x = move.clientX;
        newRecord.y = move.clientY;
        evCache.set("primary", newRecord);
      } else {
        const newRecord = {...secondary};
        newRecord.x = move.clientX;
        newRecord.y = move.clientY;
        evCache.set(otherKey, newRecord);
      }

      const origDiff = secondary.origDiff;
      const origScale = secondary.origScale;

      const pX = isPrimary ? move.clientX : primary.x;
      const pY = isPrimary ? move.clientY : primary.y;

      const sX = isPrimary ? secondary.x : move.clientX;
      const sY = isPrimary ? secondary.y : move.clientY;

      const newDiff = Math.sqrt((pX - sX) ** 2 + (pY - sY) ** 2);

      const newScale = (newDiff / origDiff) * origScale;

      const newCenterX = (pX - sX) / 2 + sX;
      const newCenterY = (pY - sY) / 2 + sY;

      const xInMover = (newCenterX / padView.scale) - padView.x;
      const newX = newCenterX / newScale - xInMover;

      const yInMover = (newCenterY / padView.scale) - padView.y;
      const newY = newCenterY / newScale - yInMover;

      Events.send(padViewChange, {x: newX, y: newY, scale: newScale});
      return move;
    }
  } else if (["pointerup", "lost", "stuck"].includes(downOrUpOrResize.type)) {
    return (move) => move;
  }
})(downOrUpOrResize, positions, padView);`],
[`101`, `const searchRequest = Events.receiver();`],
[`102`, `const searchUpdate = Events.receiver();`],
[`103`, `const toggleSearchPanel = Events.receiver();`],
[`104`, `const cursorChanged = Events.receiver();`],
[`105`, `const cursorState = Behaviors.select(
  {map: new Map()},
  cursorChanged, (prev, cursorChanged) => {
    const id = cursorChanged.id;
    const entry = prev.map.get(id);
    if (!entry || entry.position !== cursorChanged.position) {
      prev.map.set(id, cursorChanged);
      return {map: prev.map, change: id};
    }
    return prev;
  }
);`],
[`106`, `const searchState = Behaviors.select(
  {id: null, range: null, shown: false}, // id: string, editor: EditorView, range: {from: number, to: number}
  search, (prev, _search) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: !prev.shown}),
  toggleSearchPanel, (prev, panelState) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: panelState}),
  searchUpdate, (prev, searchUpdate) => searchUpdate,
  cursorState, (prev, cursorState) => {
    if (cursorState.change) {
      const cursor = cursorState.map.get(cursorState.change);
      return {
        id: cursorState.change,
        range: {from: cursor.position, to: cursor.position},
        shown: prev.shown}
    }
    return prev;
  }
);`],
[`107`, `const _searchHandler = Events.listener(searchPanel.querySelector(\`input[name="search"]\`), "keydown", searchInputHandler);`],
[`108`, `const _searchNext = Events.listener(searchPanel.querySelector(\`button[name="next"]\`), "click", searchNextHandler);`],
[`109`, `const _searchClose = Events.listener(searchPanel.querySelector(\`button[name="close"]\`), "click", searchCloseHandler);`],
[`110`, `const searchInputHandler = (evt) => {
  if (evt.key === "Enter") {
    evt.preventDefault();
    evt.stopPropagation();
    const searchRequest = getSearchRequest(evt.target.parentNode);
    if (searchRequest) {
      Events.send(searchRequest, searchRequest);
    }
  }
};`],
[`111`, `const searchNextHandler = (evt) => {
  const searchRequest = getSearchRequest(evt.target.parentNode);
  if (searchRequest) {
    Events.send(searchRequest, searchRequest);
  }
};`],
[`112`, `const searchCloseHandler = (_evt) => {
  Events.send(toggleSearchPanel, false);
};`],
[`113`, `const getSearchRequest = (searchPanel) => {
  const field = searchPanel.querySelector(\`input[name="search"]\`);
  const search = field?.value;
  const caseSensitive = searchPanel.querySelector(\`input[name="case"]\`)?.checked;
  const regexp = searchPanel.querySelector(\`input[name="re"]\`)?.checked;
  const wholeWord = searchPanel.querySelector(\`input[name="word"]\`)?.checked;
  if (search) {
    return {search, caseSensitive, regexp, wholeWord};
  }
  return null;
}`],
[`114`, `const _searchFieldUpdate = ((searchState) => {
  const searchField = renkon.querySelector("#search");
  if (!searchField) {return;}
  const oldStyle = searchField.style.display;
  const newStyle = searchState.shown ? "inherit" : "none";
  searchField.style.display = newStyle;
  if (newStyle !== oldStyle && newStyle === "inherit") {
    searchField.querySelector(\`input[name="search"]\`).focus();
  }
})(searchState);`],
[`115`, `renkon.querySelector("#search") && (renkon.querySelector("#search").style.display = searchState.shown ? "inherit" : "none");`],
[`116`, `((searchRequest, windowContents, searchState) => {
  const mirror = window.CodeMirror;
  const editorsPair = [...windowContents.map].filter(([_id, content]) => content.state)
  const query = new mirror.search.SearchQuery(searchRequest);
  const startEditorIndex = editorsPair.findIndex((e) => e[0] === searchState.id);
  let found = null;

  for (let i = startEditorIndex <= 0 ? 0 : startEditorIndex; i < editorsPair.length; i++) {
    const myRangeStart = startEditorIndex >= 0 && i === startEditorIndex ? searchState.range.to : 0;
    const targetPair = editorsPair[i];
    const cursor = query.getCursor(targetPair[1].state, myRangeStart);
    cursor.next();
    if (!cursor.done) {
      found = {id: targetPair[0], range: {from: cursor.value.from, to: cursor.value.to}, shown: true};
      break;
    }
  }
  if (found) {
    Events.send(searchUpdate, found);
  } else {
    Events.send(searchUpdate, {id: null, range: null, shown: true});
  }
})(searchRequest, windowContents, searchState)`],
[`117`, `const updateEditorSelection = ((searchUpdate, windowContents) => {
  if (!searchUpdate.id || !searchUpdate.range) {return;}
  const editor = windowContents.map.get(searchUpdate.id);
  const scrollIntoView = editor.scrollDOM.scrollHeight > editor.scrollDOM.clientHeight;
  editor.dispatch({
    changes: [], // no text change
    selection: {anchor: searchUpdate.range.from, head: searchUpdate.range.to},
    scrollIntoView: scrollIntoView,
  });
  editor.focus();
  return searchUpdate;
})(searchUpdate, windowContents);`],
[`118`, `const _searchGoTo = ((padView, positions, updateEditorSelection, windowContents) => {
  const pad = document.body.querySelector("#pad").getBoundingClientRect();

  const visiblePad = {
    x: -padView.x,
    y: -padView.y,
    width: pad.width / padView.scale,
    height: pad.height / padView.scale
  };
  const position = positions.map.get(\`\${updateEditorSelection.id}\`);

  const allVisible = position.x >= visiblePad.x && position.y >= visiblePad.y &&
        position.width + position.x <= visiblePad.x + visiblePad.width &&
        position.height + position.y <= visiblePad.y + visiblePad.height;

  if (allVisible) {return;}
  const editor = windowContents.map.get(updateEditorSelection.id);

  const textPos = editor.coordsAtPos(updateEditorSelection.range.from);
  const scrollRect = editor.scrollDOM.getBoundingClientRect();
  const top = textPos.top - scrollRect.top + editor.scrollDOM.scrollTop;
  const targetY = position.y + top / padView.scale;
  let x = -position.x + 30;
  let y = padView.y;
  if (targetY < visiblePad.y) {
    y = -targetY + 50 / padView.scale;
  } else if (targetY - 50 > visiblePad.y + visiblePad.height) {
    y = -targetY + visiblePad.height / 2 / padView.scale;
  }

  Events.send(padViewChange, {x: x, y: y, scale: padView.scale})
})(padView, positions, updateEditorSelection, windowContents);`],
[`119`, `const searchCSS = \`
.search-panels {
  position: absolute;
  top: 40px;
  right: 10px;
  background-color: #f5f5f5;
  color: black;
  display: none;
  max-height: 30px;
}
    
.search-panels[open="true"] {
  display: inherit;
}
    
.search-panels-bottom {
  border-top: 1px solid #ddd;
}
    
.search-search {
  padding: 2px 6px 4px;
}
    
.search-search input, .search-search button, .search-search label {
  margin: .2em .6em .2em 0;
}

.search-textfield {
  background-color: white;
}

.search-textfield {
  vertical-align: middle;
  color: inherit;
  font-size: 70%;
  border: 1px solid silver;
  padding: .2em .5em;
}
    
.search-button {
  background-image: linear-gradient(#eff1f5, #d9d9df);
  border: 1px solid #888;
}

.search-button {
  vertical-align: middle;
  color: inherit;
  font-size: 70%;
  padding: .2em 1em;
  border-radius: 1px;
}
    
.search-search label {
  font-size: 80%;
  white-space: pre;
}
    
.search-search button[name="close"] {
  background-color: inherit;
  border: none;
  font: inherit;
  padding: 0;
  margin: 0;
}
    
.search-search button[name="close"]:hover {
  background-color: #eee;
}
\`.trim();`],
[`120`, `((css, renkon) => {
  const style = document.createElement("style");
  style.id = "search-css";
  style.textContent = css;
  renkon.querySelector("#search-css")?.remove();
  renkon.appendChild(style);
})(searchCSS, renkon);`],
[`121`, `function doc(id) {
  const init = (() => {
    const script = document.createElement("script");
    script.id = "markdownit";
    script.src = "./markdown-it.min.js";
    const promise = new Promise((resolve) => {
      script.onload = () => {
         resolve(window.markdownit);
      };
    });

    document.head.querySelector("#markdownit")?.remove();
    document.head.appendChild(script);

    const container = document.createElement("div");
    container.id = "container";
    document.body.querySelector("#container")?.remove();
    document.body.appendChild(container);
    container.innerHTML = \`
   <div id="result"></div>
   <div id="separator"></div>
   <div id="editorContainer"></div>
\`.trim();
    return {markdownit: promise, container};
  })();

  const resolved = Behaviors.resolvePart(init);
  const md = resolved.markdownit({html: true});
  const container = resolved.container;
  const separator = container.querySelector("#separator");

  const docString = Events.receiver();

  const _update = ((docString, container) => {
    const result = md.render(docString);
    const div = document.createElement("div");
    div.id = "renkon";
    container.querySelector("#renkon")?.remove();
    container.querySelector("#result").appendChild(div);
    div.innerHTML = result;
    return div;
  })(docString, container);

  const docEditor = ((id, doc) => {
    const mirror = window.CodeMirror;
    const callback = (id, viewUpdate) => {
      if (viewUpdate.docChanged) {
        const  str = viewUpdate.state.doc.toString();
        Events.send(docString, str);
        window.parent.postMessage({type: "renkon-doc-updated", id, code: str});
      }
    };
    const editor = new mirror.EditorView({
        doc: doc || "",
        extensions: [
            mirror.basicSetup,
            mirror.EditorView.lineWrapping,
            mirror.EditorView.updateListener.of((viewUpdate) => callback(id, viewUpdate)),
            mirror.EditorView.editorAttributes.of({"class": "editor"}),
            mirror.view.keymap.of([mirror.commands.indentWithTab])
        ],
    });
    editor.dom.id = \`\${id}-docEditor\`;
    return editor;
  })(id);

  const contentsEvent = Events.listener(window, "message", evt => {
    if (evt.data.type === "renkon-doc" && typeof evt.data.doc === "string") {
      const isEmpty = evt.data.doc === "";
      const doc = isEmpty ? "# Hello, Renkon-pad" : evt.data.doc;
      docEditor.dispatch({
        changes: {
          from: 0,
          to: docEditor.state.doc.length,
          insert: doc
        }
      });
      if (!isEmpty) {
        return {type: "resize"};
      }
    }
  });

  const _init = ((container, docEditor) => {
    container.querySelector("#editorContainer").appendChild(docEditor.dom);
    window.parent.postMessage({ready: "renkon-ready", type: "doc", id});
  })(container, docEditor);

  const sepDown = Events.listener(
     separator,
     "pointerdown",
     evt => evt);

  const down = Events.collect(undefined, sepDown, (old, evt) => {
    if (evt.isPrimary) {
      evt.target.setPointerCapture(evt.pointerId);
    }
    return {type: "sepDown", x: evt.clientX};
  });

  const up = Events.listener(
    separator,
    "pointerup",
    (evt) => {
      if (evt.isPrimary) {
        evt.target.releasePointerCapture(evt.pointerId);
      }
      return {type: "sepUp"}
    }
  );

  const _sepMove = Events.listener(separator, "pointermove", moveCompute);

  const moveCompute = Behaviors.select(
    evt => evt,
    down, (_old, down) => {
      return (move) => {
        const newX = move.clientX;
        const newRenkonWidth = Math.min(window.innerWidth - 8, Math.max(newX - 8, 0));
        const newEditorWidth = Math.max(window.innerWidth - 22 - newRenkonWidth, 60);
        const right = newEditorWidth === 60 ? -60 - 16 + (window.innerWidth - newX) : 0;

        document.head.querySelector("#separator-style").textContent = \`
  #result {
    width: \${newRenkonWidth}px;
  }
  #editorContainer {
    width: \${newEditorWidth}px;
    right: \${right}px;
  }
  \`.trim();
        return move;
      }
    },
    up, (_old, _up) => (move) => move,
    Events.or(resize, contentsEvent), (old, resize) => {
      const newX = window.innerWidth - 22;
      const newEditorWidth = 60;
      const right = -60;
        document.head.querySelector("#separator-style").textContent = \`
  #result {
    width: \${newX}px;
  }
  #editorContainer {
    width: \${newEditorWidth}px;
    right: \${right}px;
  }
  \`.trim();
      return old;
    }
  );

  const resize = Events.listener(window, "resize", (evt) => ({type: "resize"}));

  Events.listener(document.body, "gesturestart", preventDefaultSafari);
  Events.listener(document.body, "gesturechange", preventDefaultSafari);
  Events.listener(document.body, "gestureend", preventDefaultSafari);

  const isSafari = window.navigator.userAgent.includes("Safari") && !window.navigator.userAgent.includes("Chrome");
  const isMobile = !!("ontouchstart" in window);

  const preventDefault = (evt) => {
    evt.preventDefault();
    return evt;
  };

  const preventDefaultSafari = (evt) => {
    if (!isSafari || isMobile) {
      evt.preventDefault();
    }
    return evt;
  };

  const wheel = Events.listener(container, "wheel", (evt) => {
    let pinch;
    if (isSafari) {
      pinch = (Number.isInteger(evt.deltaX) && !Number.isInteger(evt.deltaY)) || evt.metaKey;
    } else {
      pinch = evt.ctrlKey || evt.metaKey;
    }
    if (pinch) {
      evt.preventDefault();
      evt.stopPropagation();
    }
    return evt;
  });

  const css = \`
#container, html, body {
  width: 100%;
  height: 100%;
  margin: 0px;
}

#container {
  display: flex;
}

#result {
  height: 100%;
  width: calc(100% - 220px);
  overflow: scroll;
  scroll-behavior: smooth;
  font-size: 13px;
}

#renkon {
  height: 100%;
}

#separator {
   width: 8px;
   min-width: 8px;
   height: 100%;
   background-color: #f8f8f8;
}

#separator:hover {
   background-color: #e8e8e8;
   cursor: ew-resize;
}

#editorContainer {
  position: fixed;
  right: 0px;
  min-height: 100%;
  height: 100%;
  width: 200px;
  border: 1px solid black;
  padding: 6px;
  min-width: 0px;
  background-color: white;
  white-space: pre-wrap;
  overflow: scroll;
}

\`;

  ((css) => {
    document.head.querySelector("#presenter-style")?.remove();
    const style = document.createElement("style");
    style.id = "presenter-style";
    style.textContent = css;
    document.head.appendChild(style);

    document.head.querySelector("#separator-style")?.remove();
    const sepStyle = document.createElement("style");
    sepStyle.id = "separator-style";
    document.head.appendChild(sepStyle);
  })(css, container);

  return [];
}`],
[`122`, `const newDocPane = (id, doc) => {
  const runner = newRunner(id);
  return {dom: runner.dom, doc: doc};
}`],
[`123`, `const _handleDocReady = ((readyMessages, windowContents, windowTypes) => {
  for (const ready of readyMessages) {
    const id = ready.data.id;
    const type = windowTypes.map.get(id);
    const content = windowContents.map.get(id);
    if (ready.data.type === "runner" && type === "doc") {
      if (content) {
        if (type) {
          const code = Renkon.getFunctionBody(Renkon.findDecl(type));
          content.dom.contentWindow.postMessage({code: [code, \`const id = "\${id}"\`]});
        }
      }
    } else if (ready.data.type === "doc") {
      content.dom.contentWindow.postMessage({type: "renkon-doc", doc: content.doc});
    }
  }
})(readyMessages, windowContents, windowTypes);`],
[`124`, `const docUpdate = Events.listener(window, "message", evt => {
  if (evt.data.type === "renkon-doc-updated") {return evt.data;}
});`]]}