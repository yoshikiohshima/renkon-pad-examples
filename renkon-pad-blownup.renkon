{"padTitle":"Blown up",
"positions":{"map":{"__map":true,
"values":[["0",{"height":70,
"id":"0",
"type":"move",
"width":660.0142977146608,
"x":-2688.151486497243,
"y":705.3432285015172}],["1",{"height":70,
"id":"1",
"type":"move",
"width":699.27146317554,
"x":-2685.749131304903,
"y":610.2455065205498}],["2",{"height":70,
"id":"2",
"type":"move",
"width":640.7620518382223,
"x":-2689.5730957022074,
"y":404.2370398940833}],["3",{"height":70,
"id":"3",
"type":"move",
"width":625.0470348675532,
"x":-2687.3008324057755,
"y":508.2548346317806}],["4",{"height":70,
"id":"4",
"type":"move",
"width":651.1509741397085,
"x":-2688.265505963807,
"y":306.02612203580316}],["5",{"height":70,
"id":"5",
"type":"move",
"width":622.5021201777154,
"x":-2686.242260914022,
"y":-61.31088381557759}],["6",{"height":70,
"id":"6",
"type":"move",
"width":660.6420883410664,
"x":-2687.0498326929073,
"y":123.38051440794537}],["7",{"height":70,
"id":"7",
"type":"move",
"width":673.1303965007477,
"x":-2689.2018042353143,
"y":31.114264291347666}],["8",{"height":70,
"id":"8",
"type":"move",
"width":588.4724982332009,
"x":-2682.540459363493,
"y":-158.75724082783248}],["9",{"height":70,
"id":"9",
"type":"move",
"width":509.14878470886777,
"x":-2688.524947003421,
"y":210.11954707796502}],["10",{"height":70,
"id":"10",
"type":"move",
"width":316.54532070236695,
"x":-2677.0054675101487,
"y":936.7053886706115}],["11",{"height":176.44097541768232,
"id":"11",
"type":"move",
"width":818.0251481188444,
"x":-2853.1292607345135,
"y":1115.6370758380006}],["12",{"height":331.779873220119,
"id":"12",
"type":"move",
"width":665.5004032391607,
"x":-2844.1677742492507,
"y":1342.4820139006567}],["13",{"height":622.9653126826258,
"id":"13",
"type":"move",
"width":966.5853869427286,
"x":-2657.085538907945,
"y":3292.6881068357393}],["14",{"height":70,
"id":"14",
"type":"move",
"width":551.5330893141547,
"x":-1874.928243733462,
"y":-305.45942563621765}],["15",{"height":70,
"id":"15",
"type":"resize",
"width":568.3411594624404,
"x":-1883.045528033966,
"y":-208.80907342054104}],["16",{"height":70,
"id":"16",
"type":"resize",
"width":497.55408543541074,
"x":-60.94899057344958,
"y":-23.663400463349845}],["17",{"height":70,
"id":"17",
"type":"move",
"width":506.83832179246815,
"x":-1879.8061897993923,
"y":-9.6055480589601}],["18",{"height":70,
"id":"18",
"type":"resize",
"width":486.8987100576198,
"x":-1881.872356029826,
"y":-106.73381698535923}],["19",{"height":70,
"id":"19",
"type":"move",
"width":775.1251585947335,
"x":-1880.6561260981202,
"y":103.03112109439348}],["20",{"height":70,
"id":"20",
"type":"resize",
"width":343.6071970538052,
"x":-1887.1397855558448,
"y":214.70335486014255}],["21",{"height":74.94583651450986,
"id":"21",
"type":"move",
"width":690.8188159823792,
"x":-1894.2452884049267,
"y":379.3837004433665}],["22",{"height":70,
"id":"22",
"type":"resize",
"width":759.8301830759314,
"x":-1870.2316318061437,
"y":-399.1117951217988}],["23",{"height":107.04114663806499,
"id":"23",
"type":"move",
"width":277.2835416950261,
"x":-1302.0344417344934,
"y":-312.5568290901547}],["24",{"height":141.3954360228975,
"id":"24",
"type":"move",
"width":312.9990930348339,
"x":-1390.097382646834,
"y":207.50841014332744}],["25",{"height":126.4758771783451,
"id":"25",
"type":"move",
"width":245.5367399985968,
"x":-1291.2551537354145,
"y":-166.22780516100363}],["26",{"height":786.2519951737227,
"id":"26",
"type":"resize",
"width":709.5598083275485,
"x":-1923.244790848176,
"y":847.3350183839285}],["27",{"height":218.086250387699,
"id":"27",
"type":"move",
"width":570.1785435565972,
"x":-256.141222445558,
"y":311.1734659664331}],["28",{"height":161.95849548362284,
"id":"28",
"type":"move",
"width":446.8573931052408,
"x":-1172.9270293719114,
"y":1029.0963633247486}],["29",{"height":185.99305855642982,
"id":"29",
"type":"move",
"width":629.2421604317556,
"x":-973.366451806739,
"y":483.5282424593076}],["30",{"height":141.86946129045688,
"id":"30",
"type":"resize",
"width":546.4408172803503,
"x":-962.9145000224216,
"y":307.4877804193871}],["31",{"height":70,
"id":"31",
"type":"move",
"width":254.1868247688267,
"x":-953.6489678782095,
"y":-6.78018895318446}],["32",{"height":70,
"id":"32",
"type":"move",
"width":329.98438285987237,
"x":1508.2290710930552,
"y":-1391.7275832501834}],["33",{"height":70,
"id":"33",
"type":"move",
"width":305.4258794943501,
"x":1857.4247985159334,
"y":420.313129995342}],["34",{"height":70,
"id":"34",
"type":"resize",
"width":286.9237138257732,
"x":380.17919392653585,
"y":395.0083870626348}],["35",{"height":70,
"id":"35",
"type":"move",
"width":316.8642621573902,
"x":-791.5000044113865,
"y":1202.935240686303}],["36",{"height":406.6278835512924,
"id":"36",
"type":"move",
"width":552.6317179213934,
"x":3554.929500570861,
"y":-306.6120685054973}],["37",{"height":241.8287823425723,
"id":"37",
"type":"move",
"width":398.03382821937646,
"x":2665.858531403501,
"y":795.0916086236939}],["38",{"height":352.61506998986346,
"id":"38",
"type":"move",
"width":464.5834096305224,
"x":2650.3318714737225,
"y":1181.6831853478461}],["39",{"height":1858.8161632037727,
"id":"39",
"type":"resize",
"width":795.2229676458852,
"x":3326.8743167183193,
"y":451.7623716360962}],["40",{"height":183.34353963985754,
"id":"40",
"type":"move",
"width":639.315349064859,
"x":3319.359513280562,
"y":201.55355647951643}],["41",{"height":70,
"id":"41",
"type":"move",
"width":563.1438209654355,
"x":2537.2659829755407,
"y":461.24391394044477}],["42",{"height":70,
"id":"42",
"type":"move",
"width":287.76030914256046,
"x":1192.8350792863016,
"y":-1394.3823939248282}],["43",{"height":365.8030085115849,
"id":"43",
"type":"move",
"width":1025.335137876506,
"x":2854.3179384035407,
"y":-1424.7417423507766}],["44",{"height":201.57285746999804,
"id":"44",
"type":"move",
"width":813.1757301127959,
"x":2856.3842550796226,
"y":-1027.2366160170034}],["45",{"height":444.298128734004,
"id":"45",
"type":"move",
"width":591.3599307302494,
"x":2839.750282784874,
"y":-790.1804917295705}],["46",{"height":200,
"id":"46",
"type":"move",
"width":300,
"x":2626.1021854615888,
"y":195.49026636394152}],["47",{"height":567.0048425676417,
"id":"47",
"type":"resize",
"width":449.2498751985446,
"x":2072.448650687376,
"y":-406.0356148829633}],["48",{"height":94.06289259933024,
"id":"48",
"type":"move",
"width":613.7513717061731,
"x":1350.08204620488,
"y":-486.7237864836825}],["49",{"height":858.3934205375265,
"id":"49",
"type":"move",
"width":603.8753079688616,
"x":2045.098423121424,
"y":-1396.857728455964}],["50",{"height":108.93631872186904,
"id":"50",
"type":"move",
"width":314.76579527895166,
"x":2192.921057666793,
"y":307.6586092762259}],["51",{"height":217.97347127079618,
"id":"51",
"type":"move",
"width":578.8533307263859,
"x":1359.7932240694458,
"y":-368.056322417158}],["52",{"height":203.06468894911745,
"id":"52",
"type":"move",
"width":653.1446318926285,
"x":2776.0120536480144,
"y":-310.43792521910177}],["53",{"height":113.91315055620757,
"id":"53",
"type":"move",
"width":355.21964471428555,
"x":1579.2735875704147,
"y":-653.884335507469}],["54",{"height":7251.2576365607565,
"id":"54",
"type":"move",
"width":804.1529989808868,
"x":4256.672876670895,
"y":-1436.833387260423}],["55",{"height":179.18491225632752,
"id":"55",
"type":"move",
"width":395.6728939220996,
"x":3788.3092854029683,
"y":5601.877682820314}],["56",{"height":1140.4310206168873,
"id":"56",
"type":"resize",
"width":848.4968868115424,
"x":1121.195778295936,
"y":2087.788980990129}],["57",{"height":344.47154884228047,
"id":"57",
"type":"move",
"width":803.7982216038499,
"x":578.3507245660114,
"y":1655.3723248970482}],["58",{"height":70,
"id":"58",
"type":"move",
"width":264.4454491475452,
"x":-789.1152189833952,
"y":1302.13859928447}],["59",{"height":70,
"id":"59",
"type":"move",
"width":322.43507684794633,
"x":-788.5417085563801,
"y":1421.2786651951958}],["60",{"height":956.386864042798,
"id":"60",
"type":"move",
"width":664.7695714282854,
"x":404.3830258287078,
"y":2084.2467789564066}],["61",{"height":70,
"id":"61",
"type":"resize",
"width":497.2363267377586,
"x":770.3182067790605,
"y":1131.8760330556506}],["62",{"height":179.88467961908628,
"id":"62",
"type":"move",
"width":563.2115626590613,
"x":-2129.4071856771434,
"y":-1245.2578024388745}],["63",{"height":379.37680403423064,
"id":"63",
"type":"move",
"width":463.8715325682251,
"x":-1547.5845914754318,
"y":-1247.720162872986}],["64",{"height":634.8109043638112,
"id":"64",
"type":"resize",
"width":615.5365034483116,
"x":-1052.173726358055,
"y":-1250.1692497990953}],["65",{"height":238.44313964673995,
"id":"65",
"type":"move",
"width":278.1898341758136,
"x":757.4791977885741,
"y":-1552.7079084180361}],["66",{"height":599.3486613267169,
"id":"66",
"type":"move",
"width":527.8113011775381,
"x":759.2358097370482,
"y":-1250.8777855924727}],["67",{"height":423.5030464867264,
"id":"67",
"type":"resize",
"width":619.9811704494567,
"x":1314.7371002052328,
"y":-1248.2347067392743}],["68",{"height":419.76707908765235,
"id":"68",
"type":"move",
"width":491.7925956273083,
"x":-404.87297824294683,
"y":-1249.1838391339986}],["69",{"height":693.5332804499664,
"id":"69",
"type":"move",
"width":570.4986534851828,
"x":133.47711629046017,
"y":-1250.222203313545}],["70",{"height":70,
"id":"70",
"type":"move",
"width":265.4370837983547,
"x":-860.865216647616,
"y":814.4035542528053}],["71",{"height":181.69806984709368,
"id":"71",
"type":"move",
"width":588.4442875641611,
"x":-158.72248318365226,
"y":1630.7556910825012}],["72",{"height":70,
"id":"72",
"type":"move",
"width":637.0636034172525,
"x":-92.64426919713148,
"y":1397.4860186309222}],["73",{"height":363.65638552191535,
"id":"73",
"type":"resize",
"width":343.0474091051238,
"x":-399.8303284468433,
"y":-655.3835117766176}],["74",{"height":162.5237310569581,
"id":"74",
"type":"move",
"width":352.3415939893178,
"x":929.4526419530279,
"y":-551.8664809500335}],["75",{"height":177.06101298287857,
"id":"75",
"type":"move",
"width":641.5915564883813,
"x":868.7923181689055,
"y":-111.89852001516579}],["76",{"height":128.60663259054397,
"id":"76",
"type":"resize",
"width":469.519560165661,
"x":1136.5425886321127,
"y":234.10924315442594}],["77",{"height":70,
"id":"77",
"type":"move",
"width":493.45173203039565,
"x":-2667.9185436532716,
"y":-888.6881238613822}],["78",{"height":560.5546578466893,
"id":"78",
"type":"move",
"width":771.514344910433,
"x":-2681.1593182045453,
"y":-755.5084906123002}],["79",{"height":573.7217460873577,
"id":"79",
"type":"resize",
"width":741.3012683144232,
"x":1759.6910153186375,
"y":548.2182956311469}],["80",{"height":1910.225435293678,
"id":"80",
"type":"move",
"width":634.9805732460421,
"x":-1040.9219241749574,
"y":1756.5589688298862}],["81",{"height":1332.9310855738636,
"id":"81",
"type":"move",
"width":646.9681485637143,
"x":-1765.831088332771,
"y":1758.5494915655884}],["82",{"height":70,
"id":"82",
"type":"resize",
"width":626.5560477240854,
"x":988.34904246939,
"y":698.552674624496}],["83",{"height":238.86410415718066,
"id":"83",
"type":"move",
"width":664.1245396638233,
"x":-2635.710718349999,
"y":2967.370309001003}],["84",{"height":70,
"id":"84",
"type":"move",
"width":244.4842296154995,
"x":-1894.8593988205753,
"y":490.3700579959363}],["85",{"height":1113.54965400131,
"id":"85",
"type":"resize",
"width":709.3948116329368,
"x":-2626.5677534262795,
"y":1768.785323147132}],["86",{"height":160.8056575973962,
"id":"86",
"type":"resize",
"width":587.7091520181541,
"x":-975.912334930832,
"y":112.70524506582836}],["87",{"height":70,
"id":"87",
"type":"move",
"width":743.8429225643897,
"x":-507.8606350918516,
"y":813.4821104624839}],["88",{"height":70,
"id":"88",
"type":"resize",
"width":495.2748918200152,
"x":-332.0795045105021,
"y":176.2430281677237}],["89",{"height":70,
"id":"89",
"type":"move",
"width":305.3336554906464,
"x":-871.037624112681,
"y":933.695142080161}],["90",{"height":70,
"id":"90",
"type":"move",
"width":300.5065307516834,
"x":470.82853372834643,
"y":165.1547000130874}],["91",{"height":2067.289047499184,
"id":"91",
"type":"move",
"width":678.4627966553155,
"x":-360.05188795627464,
"y":2095.7572827579284}],["92",{"height":70,
"id":"92",
"type":"resize",
"width":303.08594119487117,
"x":759.6561905312662,
"y":398.6225684776954}],["93",{"height":70,
"id":"93",
"type":"move",
"width":312.8515083219549,
"x":2189.776600134711,
"y":2379.9634394821346}],["94",{"height":75.3551346313903,
"id":"94",
"type":"move",
"width":348.1370060029335,
"x":1214.5979958517787,
"y":985.8290305740745}],["95",{"height":70,
"id":"95",
"type":"resize",
"width":304.0013863437635,
"x":221.51347456575786,
"y":1091.658189634934}],["96",{"height":252.83777032450772,
"id":"96",
"type":"resize",
"width":479.8203717331306,
"x":-424.40321986802667,
"y":983.2591281106721}],["97",{"height":332.77339918741154,
"id":"97",
"type":"resize",
"width":829.0596809621173,
"x":1430.9827031456653,
"y":1183.2636892810892}],["98",{"height":70,
"id":"98",
"type":"move",
"width":834.7211786322154,
"x":2047.3426533771758,
"y":2074.274926063817}],["99",{"height":70,
"id":"99",
"type":"move",
"width":782.7925817395167,
"x":2044.9168753044612,
"y":2292.227519789915}],["100",{"height":70,
"id":"100",
"type":"move",
"width":801.548436717553,
"x":2046.5564262145224,
"y":2194.000188624284}],["101",{"height":214.01719945388234,
"id":"101",
"type":"move",
"width":519.1467952052383,
"x":2640.515393751387,
"y":1637.579692021088}],["102",{"height":146.64219352269916,
"id":"102",
"type":"move",
"width":477.61365832071783,
"x":2052.627478208354,
"y":1886.2439358445845}],["103",{"height":94.34907473317092,
"id":"103",
"type":"move",
"width":334.40281282313384,
"x":2188.109350421804,
"y":2473.0696093637766}],["104",{"height":234.18722487125586,
"id":"104",
"type":"move",
"width":610.0961820361326,
"x":1925.8597229932493,
"y":1596.8357616606331}],["105",{"height":219.59114166436973,
"id":"105",
"type":"move",
"width":483.0939942822693,
"x":2181.4375101708383,
"y":2841.7904667126904}],["106",{"height":70,
"id":"106",
"type":"move",
"width":865.1229481264966,
"x":273.48398209370663,
"y":845.877747353996}],["107",{"height":457.38827259373886,
"id":"107",
"type":"move",
"width":769.6570247320453,
"x":2024.0698199856674,
"y":3684.213053857978}],["108",{"height":294.7956430933082,
"id":"108",
"type":"move",
"width":480.5831024948092,
"x":2177.756988280156,
"y":3119.4612241997497}],["109",{"height":647.003170868977,
"id":"109",
"type":"move",
"width":608.8088220096521,
"x":2884.2899172485663,
"y":3690.5114319969166}],["110",{"height":1240.8651032181697,
"id":"110",
"type":"move",
"width":510.01689382990367,
"x":2892.4041698438377,
"y":2399.7072680143583}],["111",{"height":190.64029488093024,
"id":"111",
"type":"move",
"width":402.419949692644,
"x":2186.2286064461223,
"y":2606.6265388438037}]]}},
"titles":{"map":{"__map":true,
"values":[["0",{"id":"0",
"state":false,
"title":"addCode"}],["1",{"id":"1",
"state":false,
"title":"addRunner"}],["2",{"id":"2",
"state":false,
"title":"save"}],["3",{"id":"3",
"state":false,
"title":"load"}],["4",{"id":"4",
"state":false,
"title":"search"}],["5",{"id":"5",
"state":false,
"title":"home"}],["6",{"id":"6",
"state":false,
"title":"zoomIn"}],["7",{"id":"7",
"state":false,
"title":"zoomOut"}],["8",{"id":"8",
"state":false,
"title":"homeUponLoad"}],["9",{"id":"9",
"state":false,
"title":"navigationAction"}],["10",{"id":"10",
"state":false,
"title":"padViewChange"}],["11",{"id":"11",
"state":false,
"title":"_padViewUpdate"}],["12",{"id":"12",
"state":false,
"title":"wheel"}],["13",{"id":"13",
"state":false,
"title":"_handleWheel"}],["14",{"id":"14",
"state":false,
"title":"_1_0"}],["15",{"id":"15",
"state":false,
"title":"_1_0"}],["16",{"id":"16",
"state":false,
"title":"_1_0"}],["17",{"id":"17",
"state":false,
"title":"_1_0"}],["18",{"id":"18",
"state":false,
"title":"_1_0"}],["19",{"id":"19",
"state":false,
"title":"isSafari"}],["20",{"id":"20",
"state":false,
"title":"isMobile"}],["21",{"id":"21",
"state":false,
"title":"pointercancel"}],["22",{"id":"22",
"state":false,
"title":"lostpointercapture"}],["23",{"id":"23",
"state":false,
"title":"preventDefault"}],["24",{"id":"24",
"state":false,
"title":"preventDefaultSafari"}],["25",{"id":"25",
"state":false,
"title":"pointerLost"}],["26",{"id":"26",
"state":false,
"title":"_handleNavigationAction"}],["27",{"id":"27",
"state":false,
"title":"showGraph"}],["28",{"id":"28",
"state":false,
"title":"1"}],["29",{"id":"29",
"state":false,
"title":"_onRun"}],["30",{"id":"30",
"state":false,
"title":"_onInspect"}],["31",{"id":"31",
"state":false,
"title":"remove"}],["32",{"id":"32",
"state":false,
"title":"titleEditChange"}],["33",{"id":"33",
"state":false,
"title":"enabledChange"}],["34",{"id":"34",
"state":false,
"title":"runRequest"}],["35",{"id":"35",
"state":false,
"title":"inspectRequest"}],["36",{"id":"36",
"state":false,
"title":"_goTo"}],["37",{"id":"37",
"state":false,
"title":"inputHandler"}],["38",{"id":"38",
"state":false,
"title":"_positionsCss"}],["39",{"id":"39",
"state":false,
"title":"windowDOM"}],["40",{"id":"40",
"state":false,
"title":"windowElements"}],["41",{"id":"41",
"state":false,
"title":"_windowRender"}],["42",{"id":"42",
"state":false,
"title":"loadRequest"}],["43",{"id":"43",
"state":false,
"title":"saveData"}],["44",{"id":"44",
"state":false,
"title":"_saver2"}],["45",{"id":"45",
"state":false,
"title":"_loader"}],["46",{"id":"46",
"state":false,
"title":"nameFromUrl"}],["47",{"id":"47",
"state":false,
"title":"loadData"}],["48",{"id":"48",
"state":false,
"title":"_loadFromUrl"}],["49",{"id":"49",
"state":false,
"title":"stringifyInner"}],["50",{"id":"50",
"state":false,
"title":"stringify"}],["51",{"id":"51",
"state":false,
"title":"parse"}],["52",{"id":"52",
"state":false,
"title":"stringifyCodeMap"}],["53",{"id":"53",
"state":false,
"title":"parseCodeMap"}],["54",{"id":"54",
"state":false,
"title":"css"}],["55",{"id":"55",
"state":false,
"title":"1"}],["56",{"id":"56",
"state":false,
"title":"analyzed"}],["57",{"id":"57",
"state":false,
"title":"line"}],["58",{"id":"58",
"state":false,
"title":"hovered"}],["59",{"id":"59",
"state":false,
"title":"hoveredB"}],["60",{"id":"60",
"state":false,
"title":"graph"}],["61",{"id":"61",
"state":false,
"title":"_graphRender"}],["62",{"id":"62",
"state":false,
"title":"windows"}],["63",{"id":"63",
"state":false,
"title":"windowTypes"}],["64",{"id":"64",
"state":false,
"title":"positions"}],["65",{"id":"65",
"state":false,
"title":"findMax"}],["66",{"id":"66",
"state":false,
"title":"zIndex"}],["67",{"id":"67",
"state":false,
"title":"titles"}],["68",{"id":"68",
"state":false,
"title":"windowEnabled"}],["69",{"id":"69",
"state":false,
"title":"windowContents"}],["70",{"id":"70",
"state":false,
"title":"init"}],["71",{"id":"71",
"state":false,
"title":"newId"}],["72",{"id":"72",
"state":false,
"title":"newWindowRequest"}],["73",{"id":"73",
"state":false,
"title":"padView"}],["74",{"id":"74",
"state":false,
"title":"padTitle"}],["75",{"id":"75",
"state":false,
"title":"titleChange"}],["76",{"id":"76",
"state":false,
"title":"_padTitleUpdater"}],["77",{"id":"77",
"state":false,
"title":"render"}],["78",{"id":"78",
"state":false,
"title":"renkon"}],["79",{"id":"79",
"state":false,
"title":"searchPanel"}],["80",{"id":"80",
"state":false,
"title":"newEditor"}],["81",{"id":"81",
"state":false,
"title":"newRunner"}],["82",{"id":"82",
"state":false,
"title":"dblClick"}],["83",{"id":"83",
"state":false,
"title":"rawPadDown"}],["84",{"id":"84",
"state":false,
"title":"evCache"}],["85",{"id":"85",
"state":false,
"title":"padDown"}],["86",{"id":"86",
"state":false,
"title":"padUp"}],["87",{"id":"87",
"state":false,
"title":"downOrUpOrResize"}],["88",{"id":"88",
"state":false,
"title":"_padMove"}],["89",{"id":"89",
"state":false,
"title":"windowResize"}],["90",{"id":"90",
"state":false,
"title":"moveOrResize"}],["91",{"id":"91",
"state":false,
"title":"moveCompute"}],["92",{"id":"92",
"state":false,
"title":"searchRequest"}],["93",{"id":"93",
"state":false,
"title":"searchUpdate"}],["94",{"id":"94",
"state":false,
"title":"toggleSearchPanel"}],["95",{"id":"95",
"state":false,
"title":"cursorChanged"}],["96",{"id":"96",
"state":false,
"title":"cursorState"}],["97",{"id":"97",
"state":false,
"title":"searchState"}],["98",{"id":"98",
"state":false,
"title":"_searchHandler"}],["99",{"id":"99",
"state":false,
"title":"_searchNext"}],["100",{"id":"100",
"state":false,
"title":"_searchClose"}],["101",{"id":"101",
"state":false,
"title":"searchInputHandler"}],["102",{"id":"102",
"state":false,
"title":"searchNextHandler"}],["103",{"id":"103",
"state":false,
"title":"searchCloseHandler"}],["104",{"id":"104",
"state":false,
"title":"getSearchRequest"}],["105",{"id":"105",
"state":false,
"title":"_searchFieldUpdate"}],["106",{"id":"106",
"state":false,
"title":"1"}],["107",{"id":"107",
"state":false,
"title":"1"}],["108",{"id":"108",
"state":false,
"title":"updateEditorSelection"}],["109",{"id":"109",
"state":false,
"title":"_searchGoTo"}],["110",{"id":"110",
"state":false,
"title":"searchCSS"}],["111",{"id":"111",
"state":false,
"title":"1"}]]}},
"version":2,
"windowEnabled":{"map":{"__map":true,
"values":[["0",{"enabled":true,
"id":"0"}],["1",{"enabled":true,
"id":"1"}],["2",{"enabled":true,
"id":"2"}],["3",{"enabled":true,
"id":"3"}],["4",{"enabled":true,
"id":"4"}],["5",{"enabled":true,
"id":"5"}],["6",{"enabled":true,
"id":"6"}],["7",{"enabled":true,
"id":"7"}],["8",{"enabled":true,
"id":"8"}],["9",{"enabled":true,
"id":"9"}],["10",{"enabled":true,
"id":"10"}],["11",{"enabled":true,
"id":"11"}],["12",{"enabled":true,
"id":"12"}],["13",{"enabled":true,
"id":"13"}],["14",{"enabled":true,
"id":"14"}],["15",{"enabled":true,
"id":"15"}],["16",{"enabled":true,
"id":"16"}],["17",{"enabled":true,
"id":"17"}],["18",{"enabled":true,
"id":"18"}],["19",{"enabled":true,
"id":"19"}],["20",{"enabled":true,
"id":"20"}],["21",{"enabled":true,
"id":"21"}],["22",{"enabled":true,
"id":"22"}],["23",{"enabled":true,
"id":"23"}],["24",{"enabled":true,
"id":"24"}],["25",{"enabled":true,
"id":"25"}],["26",{"enabled":true,
"id":"26"}],["27",{"enabled":true,
"id":"27"}],["28",{"enabled":true,
"id":"28"}],["29",{"enabled":true,
"id":"29"}],["30",{"enabled":true,
"id":"30"}],["31",{"enabled":true,
"id":"31"}],["32",{"enabled":true,
"id":"32"}],["33",{"enabled":true,
"id":"33"}],["34",{"enabled":true,
"id":"34"}],["35",{"enabled":true,
"id":"35"}],["36",{"enabled":true,
"id":"36"}],["37",{"enabled":true,
"id":"37"}],["38",{"enabled":true,
"id":"38"}],["39",{"enabled":true,
"id":"39"}],["40",{"enabled":true,
"id":"40"}],["41",{"enabled":true,
"id":"41"}],["42",{"enabled":true,
"id":"42"}],["43",{"enabled":true,
"id":"43"}],["44",{"enabled":true,
"id":"44"}],["45",{"enabled":true,
"id":"45"}],["46",{"enabled":true,
"id":"46"}],["47",{"enabled":true,
"id":"47"}],["48",{"enabled":true,
"id":"48"}],["49",{"enabled":true,
"id":"49"}],["50",{"enabled":true,
"id":"50"}],["51",{"enabled":true,
"id":"51"}],["52",{"enabled":true,
"id":"52"}],["53",{"enabled":true,
"id":"53"}],["54",{"enabled":true,
"id":"54"}],["55",{"enabled":true,
"id":"55"}],["56",{"enabled":true,
"id":"56"}],["57",{"enabled":true,
"id":"57"}],["58",{"enabled":true,
"id":"58"}],["59",{"enabled":true,
"id":"59"}],["60",{"enabled":true,
"id":"60"}],["61",{"enabled":true,
"id":"61"}],["62",{"enabled":true,
"id":"62"}],["63",{"enabled":true,
"id":"63"}],["64",{"enabled":true,
"id":"64"}],["65",{"enabled":true,
"id":"65"}],["66",{"enabled":true,
"id":"66"}],["67",{"enabled":true,
"id":"67"}],["68",{"enabled":true,
"id":"68"}],["69",{"enabled":true,
"id":"69"}],["70",{"enabled":true,
"id":"70"}],["71",{"enabled":true,
"id":"71"}],["72",{"enabled":true,
"id":"72"}],["73",{"enabled":true,
"id":"73"}],["74",{"enabled":true,
"id":"74"}],["75",{"enabled":true,
"id":"75"}],["76",{"enabled":true,
"id":"76"}],["77",{"enabled":true,
"id":"77"}],["78",{"enabled":true,
"id":"78"}],["79",{"enabled":true,
"id":"79"}],["80",{"enabled":true,
"id":"80"}],["81",{"enabled":true,
"id":"81"}],["82",{"enabled":true,
"id":"82"}],["83",{"enabled":true,
"id":"83"}],["84",{"enabled":true,
"id":"84"}],["85",{"enabled":true,
"id":"85"}],["86",{"enabled":true,
"id":"86"}],["87",{"enabled":true,
"id":"87"}],["88",{"enabled":true,
"id":"88"}],["89",{"enabled":true,
"id":"89"}],["90",{"enabled":true,
"id":"90"}],["91",{"enabled":true,
"id":"91"}],["92",{"enabled":true,
"id":"92"}],["93",{"enabled":true,
"id":"93"}],["94",{"enabled":true,
"id":"94"}],["95",{"enabled":true,
"id":"95"}],["96",{"enabled":true,
"id":"96"}],["97",{"enabled":true,
"id":"97"}],["98",{"enabled":true,
"id":"98"}],["99",{"enabled":true,
"id":"99"}],["100",{"enabled":true,
"id":"100"}],["101",{"enabled":true,
"id":"101"}],["102",{"enabled":true,
"id":"102"}],["103",{"enabled":true,
"id":"103"}],["104",{"enabled":true,
"id":"104"}],["105",{"enabled":true,
"id":"105"}],["106",{"enabled":true,
"id":"106"}],["107",{"enabled":true,
"id":"107"}],["108",{"enabled":true,
"id":"108"}],["109",{"enabled":true,
"id":"109"}],["110",{"enabled":true,
"id":"110"}],["111",{"enabled":true,
"id":"111"}]]}},
"windowTypes":{"map":{"__map":true,
"values":[["0","code"],["1","code"],["2","code"],["3","code"],["4","code"],["5","code"],["6","code"],["7","code"],["8","code"],["9","code"],["10","code"],["11","code"],["12","code"],["13","code"],["14","code"],["15","code"],["16","code"],["17","code"],["18","code"],["19","code"],["20","code"],["21","code"],["22","code"],["23","code"],["24","code"],["25","code"],["26","code"],["27","code"],["28","code"],["29","code"],["30","code"],["31","code"],["32","code"],["33","code"],["34","code"],["35","code"],["36","code"],["37","code"],["38","code"],["39","code"],["40","code"],["41","code"],["42","code"],["43","code"],["44","code"],["45","code"],["46","code"],["47","code"],["48","code"],["49","code"],["50","code"],["51","code"],["52","code"],["53","code"],["54","code"],["55","code"],["56","code"],["57","code"],["58","code"],["59","code"],["60","code"],["61","code"],["62","code"],["63","code"],["64","code"],["65","code"],["66","code"],["67","code"],["68","code"],["69","code"],["70","code"],["71","code"],["72","code"],["73","code"],["74","code"],["75","code"],["76","code"],["77","code"],["78","code"],["79","code"],["80","code"],["81","code"],["82","code"],["83","code"],["84","code"],["85","code"],["86","code"],["87","code"],["88","code"],["89","code"],["90","code"],["91","code"],["92","code"],["93","code"],["94","code"],["95","code"],["96","code"],["97","code"],["98","code"],["99","code"],["100","code"],["101","code"],["102","code"],["103","code"],["104","code"],["105","code"],["106","code"],["107","code"],["108","code"],["109","code"],["110","code"],["111","code"]]}},
"windows":["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111"],
"zIndex":{"map":{"__map":true,
"values":[["0",120],["1",107],["2",110],["3",108],["4",103],["5",105],["6",111],["7",100],["8",113],["9",102],["10",104],["11",109],["12",121],["13",130],["14",122],["15",124],["16",190],["17",127],["18",128],["19",125],["20",119],["21",129],["22",114],["23",123],["24",117],["25",118],["26",115],["27",158],["28",202],["29",154],["30",126],["31",159],["32",148],["33",197],["34",133],["35",157],["36",143],["37",161],["38",139],["39",142],["40",177],["41",137],["42",141],["43",144],["44",151],["45",149],["46",145],["47",146],["48",166],["49",160],["50",196],["51",175],["52",206],["53",150],["54",138],["55",203],["56",211],["57",178],["58",152],["59",172],["60",155],["61",164],["62",162],["63",163],["64",167],["65",112],["66",147],["67",140],["68",168],["69",165],["70",116],["71",179],["72",156],["73",131],["74",201],["75",173],["76",181],["77",101],["78",106],["79",153],["80",185],["81",209],["82",169],["83",170],["84",189],["85",187],["86",186],["87",193],["88",204],["89",195],["90",183],["91",176],["92",191],["93",188],["94",182],["95",171],["96",205],["97",132],["98",199],["99",200],["100",198],["101",135],["102",194],["103",210],["104",207],["105",134],["106",184],["107",180],["108",174],["109",192],["110",208],["111",136]]}}}
{__codeMap: true, value: [[`0`, `const addCode = Events.listener(renkon.querySelector("#addCodeButton"), "click", () => "code");`],
[`1`, `const addRunner = Events.listener(renkon.querySelector("#addRunnerButton"), "click", () => "runner");`],
[`2`, `const save = Events.listener(renkon.querySelector("#saveButton"), "click", (evt) => evt);`],
[`3`, `const load = Events.listener(renkon.querySelector("#loadButton"), "click", (evt) => evt);`],
[`4`, `const search = Events.listener(renkon.querySelector("#searchButton"), "click", (evt) => evt);`],
[`5`, `const home = Events.listener(renkon.querySelector("#homeButton"), "click", () => "home");`],
[`6`, `const zoomIn = Events.listener(renkon.querySelector("#zoomInButton"), "click", () => "zoomIn");`],
[`7`, `const zoomOut = Events.listener(renkon.querySelector("#zoomOutButton"), "click", () => "zoomOut");`],
[`8`, `const homeUponLoad = ((_positions, _loadRequest) => "home")(positions, loadRequest);`],
[`9`, `const navigationAction = Events.or(home, zoomIn, zoomOut, homeUponLoad);`],
[`10`, `const padViewChange = Events.receiver();`],
[`11`, `const _padViewUpdate = ((padView) => {
    const mover = document.querySelector("#mover");
    const pad = document.querySelector("#pad");
    mover.style.setProperty("transform", \`scale(\${padView.scale}) translate(\${padView.x}px, \${padView.y}px)\`);

    pad.style.setProperty("background-position", \`\${padView.x * padView.scale}px \${padView.y * padView.scale}px\`);
    pad.style.setProperty("background-size", \`\${64 * padView.scale}px \${64 * padView.scale}px\`);
})(padView);`],
[`12`, `const wheel = Events.listener(renkon.querySelector("#pad"), "wheel", (evt) => {
    let pinch;
    if (isSafari) {
        pinch = (Number.isInteger(evt.deltaX) && !Number.isInteger(evt.deltaY)) || evt.metaKey;
    } else {
        pinch = evt.ctrlKey || evt.metaKey;
    }
    const strId = evt.target.id;
    if (pinch) {
        evt.preventDefault();
        if (strId === "pad") {
            evt.stopPropagation();
        }
    }
    return evt;
});`],
[`13`, `const _handleWheel = ((wheel, padView) => {
    let pinch;
    if (isSafari) {
        pinch = (Number.isInteger(wheel.deltaX) && !Number.isInteger(wheel.deltaY)) || wheel.metaKey;
    } else {
        pinch = wheel.ctrlKey || wheel.metaKey;
    }
    const strId = wheel.target.id;

    let deltaX = wheel.deltaX;
    let deltaY = wheel.deltaY;
    let zoom = padView.scale;

    let absDeltaY = Math.min(30, Math.abs(deltaY));
    let diff = Math.sign(deltaY) * absDeltaY;

    let desiredZoom = zoom * (1 - diff / 50);

    const xInMover = (wheel.clientX / padView.scale) - padView.x;
    const newX = wheel.clientX / desiredZoom - xInMover;

    const yInMover = (wheel.clientY / padView.scale) - padView.y;
    const newY = wheel.clientY / desiredZoom - yInMover;

    if (strId === "pad") {
        if (pinch) {
            Events.send(padViewChange, {x: newX, y: newY, scale: desiredZoom});
        } else {
            Events.send(padViewChange, {x: padView.x - deltaX / padView.scale, y: padView.y - deltaY / padView.scale, scale: padView.scale});
        }
    }
})(wheel, padView);`],
[`14`, `Events.listener(renkon.querySelector("#buttonBox"), "wheel", preventDefault);`],
[`15`, `Events.listener(renkon.querySelector("#navigationBox"), "wheel", preventDefault);`],
[`16`, `Events.listener(document.body, "gesturestart", preventDefaultSafari);`],
[`17`, `Events.listener(document.body, "gesturechange", preventDefaultSafari);`],
[`18`, `Events.listener(document.body, "gestureend", preventDefaultSafari);`],
[`19`, `const isSafari = window.navigator.userAgent.includes("Safari") && !window.navigator.userAgent.includes("Chrome");`],
[`20`, `const isMobile = !!("ontouchstart" in window);`],
[`21`, `const pointercancel = Events.listener(renkon.querySelector("#pad"), "pointercancel", pointerLost);`],
[`22`, `const lostpointercapture = Events.listener(renkon.querySelector("#pad"), "lostpointercapture", pointerLost);`],
[`23`, `const preventDefault = (evt) => {
    evt.preventDefault();
    return evt;
};`],
[`24`, `const preventDefaultSafari = (evt) => {
    if (!isSafari || isMobile) {
        evt.preventDefault();
    }
    return evt;
};`],
[`25`, `const pointerLost = (evt) => {
    evCache.clear();
    evt.preventDefault();
    return {type: "lost"};
};`],
[`26`, `const _handleNavigationAction = ((navigationAction, positions, padView) => {
    if (navigationAction === "zoomIn" || navigationAction === "zoomOut") {
        const pad = document.body.querySelector("#pad").getBoundingClientRect();
        const newScale = padView.scale * ( navigationAction === "zoomIn" ? 1.1 : 0.9);
        const centerX = pad.width / 2 / padView.scale - padView.x;
        const centerY = pad.height / 2 / padView.scale - padView.y;
        const newX = pad.width / 2 / newScale - centerX;
        const newY = pad.height / 2 / newScale - centerY;
        // const newX = (padView.x - (pad.width / 2)) * (newScale / padView.scale) + pad.width / 2;
        // const newY = (padView.y - (pad.height / 2)) * (newScale / padView.scale) + pad.height / 2;
        Events.send(padViewChange, {x: newX, y: newY, scale: newScale});
    } else if (navigationAction === "home") {
        let minLeft = Number.MAX_VALUE;
        let minTop = Number.MAX_VALUE;
        let maxRight = Number.MIN_VALUE;
        let maxBottom = Number.MIN_VALUE;

        if (positions.map.size === 0) {
            Events.send(padViewChange, {x: 0, y: 0, scale: 1});
            return;
        }
        for (let [_, position] of positions.map) {
            minLeft = Math.min(position.x, minLeft);
            minTop = Math.min(position.y, minTop);
            maxRight = Math.max(position.x + position.width, maxRight);
            maxBottom = Math.max(position.y + position.height, maxBottom);
        }

        const pad = document.body.querySelector("#pad").getBoundingClientRect();

        const scaleX = pad.width / (maxRight - minLeft);
        const scaleY = pad.height / (maxBottom - minTop);
        const scale = Math.min(1, scaleX, scaleY) * 0.9;

        const centerX = (maxRight + minLeft) / 2;
        const centerY = (maxBottom + minTop) / 2;
        let x = (pad.width / 2 / scale - centerX);
        let y = (pad.height / 2 / scale - centerY);
        Events.send(padViewChange, {x, y, scale});
    }
})(navigationAction, positions, padView);`],
[`27`, `const showGraph = Behaviors.collect(
    "showGraph",
    Events.listener(renkon.querySelector("#showGraph"), "click", (evt) => evt),
    (now, _click) => {
        if (now === "showGraph") {return "showDeps";}
        if (now === "showDeps") {return "hide";}
        if (now === "hide") {return "showGraph"}
        return now;
    }
);`],
[`28`, `((showGraph) => {
    let str;
    if (showGraph === "showGraph") {str = "show graph";}
    if (showGraph === "showDeps") {str = "show deps";}
    if (showGraph === "hide") {str = "hide graph"}
    document.querySelector("#showGraph").textContent = str;
})(showGraph);`],
[`29`, `const _onRun = ((runRequest, windowContents, windowEnabled) => {
    const id = runRequest.id;
    const iframe = windowContents.map.get(id);
    const code = [...windowContents.map]
        .filter(([id, obj]) => obj.state && windowEnabled.map.get(id).enabled)
        .map(([_id, editor]) => editor.state.doc.toString());
    iframe.dom.contentWindow.postMessage({code: code, path: id});
})(runRequest, windowContents, windowEnabled);`],
[`30`, `const _onInspect = ((inspectRequest) => {
    const id = inspectRequest.id;
    const iframe = windowContents.map.get(id);
    iframe.dom.contentWindow.postMessage({inspector: true, path: id});
})(inspectRequest);`],
[`31`, `const remove = Events.receiver();`],
[`32`, `const titleEditChange = Events.receiver();`],
[`33`, `const enabledChange = Events.receiver();`],
[`34`, `const runRequest = Events.receiver();`],
[`35`, `const inspectRequest = Events.receiver();`],
[`36`, `const _goTo = ((padView, positions, dblClick) => {
    const strId = dblClick.target.id;
    if (!strId.endsWith("-titleBar")) {return;}
    const id = Number.parseInt(strId);
    const position = positions.map.get(\`\${id}\`);

    const pad = document.body.querySelector("#pad").getBoundingClientRect();

    const scaleX = pad.width / position.width;
    const scaleY = pad.height / position.height;
    const scale = Math.min(scaleX, scaleY) * 0.95;

    const centerX = position.x + position.width / 2;
    const centerY = position.y + position.height / 2;

    const x = pad.width / 2 / scale - centerX;
    const y = pad.height / 2 / scale - centerY;

    Events.send(padViewChange, {x, y, scale});
})(padView, positions, dblClick);`],
[`37`, `const inputHandler = (evt) => {
    if (evt.key === "Enter") {
        evt.preventDefault();
        evt.stopPropagation();
        Events.send(titleEditChange, {
            id: \`\${Number.parseInt(evt.target.id)}\`,
            title: evt.target.textContent,
            state: false
        });
    }
};`],
[`38`, `const _positionsCss = ((positions, zIndex) => {
    let style = document.head.querySelector("#positions-css");
    if (!style) {
        style = document.createElement("style");
        style.id = "positions-css";
        document.head.appendChild(style);
    }

    const css = [...positions.map].map(([id, rect]) => \`
[id="\${id}-win"] {
transform: translate(\${rect.x}px, \${rect.y}px);
width: \${rect.width}px;
height: \${rect.height}px;
z-index: \${zIndex.map.get(id)};
}\`.trim()).join("\\n");
    style.textContent = css;
})(positions, zIndex);`],
[`39`, `const windowDOM = (id, title, windowContent, type, windowEnabled) => {
    return h("div", {
        key: \`\${id}\`,
        id: \`\${id}-win\`,
        "class": "window",
        ref: (ref) => {
            if (ref) {
                if (ref.querySelector(".windowHolder") !== windowContent.dom.parentNode) {
                    ref.querySelector(".windowHolder").appendChild(windowContent.dom);
                }
            }
        },
        onPointerEnter: (evt) => Events.send(hovered, \`\${Number.parseInt(evt.target.id)}\`),
        onPointerLeave: (_evt) => Events.send(hovered, null)
    }, [
        h("div", {
            id: \`\${id}-titleBar\`,
            "class": "titleBar",
        }, [
            h("div", {
                id: \`\${id}-enabledButton\`,
                disabled: !!(windowEnabled && !windowEnabled.enabled),
                style: {
                    display: \`\${type !== "code" ? "none" : "inheirt"}\`
                },
                "class": "titlebarButton enabledButton",
                onClick: (evt) => {
                    //console.log(evt);
                    Events.send(enabledChange, {
                        id: \`\${Number.parseInt(evt.target.id)}\`,
                        enabled: !windowEnabled || !windowEnabled.enabled});
                },
            }),
            h("div", {
                id: \`\${id}-runButton\`,
                "class": "titlebarButton runButton",
                type,
                onClick: (evt) => {
                    //console.log(evt);
                    Events.send(runRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
                },
            }),
            h("div", {
                id: \`\${id}-inspectorButton\`,
                "class": "titlebarButton inspectorButton",
                type,
                onClick: (evt) => {
                    //console.log(evt);
                    Events.send(inspectRequest, {id: \`\${Number.parseInt(evt.target.id)}\`});
                },
            }),
            h("div", {
                id: \`\${id}-title\`,
                "class": "title",
                contentEditable: \`\${title.state}\`,
                onKeydown: inputHandler,
            }, title.title),
            h("div", {
                id: \`\${id}-edit\`,
                "class": \`titlebarButton editButton\`,
                onClick: (evt) => {
                    // console.log(evt);
                    Events.send(titleEditChange, {id: \`\${Number.parseInt(evt.target.id)}\`, state: !title.state});
                },
            }, []),
            h("div", {
                id: \`\${id}-close\`,
                "class": "titlebarButton closeButton",
                onClick: (evt) => {
                    Events.send(remove, {id: \`\${Number.parseInt(evt.target.id)}\`, type: "remove"})
                }
            }),
        ]),
        h("div", {
            id: \`\${id}-bottomRight-resize\`,
            corner: "bottomRight",
            "class": "resizeHandler",
        }, []),
        h("div", {
            id: \`\${id}-topLeft-resize\`,
            corner: "topLeft",
            "class": "resizeHandler",
        }, []),
        h("div", {
            id: \`\${id}-bottomLeft-resize\`,
            corner: "bottomLeft",
            "class": "resizeHandler",
        }, []),
        h("div", {
            id: \`\${id}-topRight-resize\`,
            corner: "topRight",
            "class": "resizeHandler",
        }, []),
        h("div", {
            id: \`\${id}-windowHolder\`,
            blurred: \`\${type !== "code" ? false : (windowEnabled ? !windowEnabled.enabled : false)}\`,
            "class": "windowHolder",
        }, [])
    ])
};`],
[`40`, `const windowElements = ((windows, titles, windowContents, windowTypes, windowEnabled) => {
    return h("div", {id: "owner", "class": "owner"}, windows.map((id) => {
        return windowDOM(
            id,
            titles.map.get(id), windowContents.map.get(id),
            windowTypes.map.get(id), windowEnabled.map.get(id));
    }));
})(windows, titles, windowContents, windowTypes, windowEnabled);`],
[`41`, `const _windowRender = render(windowElements, document.querySelector("#mover"));`],
[`42`, `const loadRequest = Events.receiver();`],
[`43`, `const saveData = (windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
    const code = new Map([...windowContents.map].filter(([_id, editor]) => editor.state).map(([id, editor]) => ([id, editor.state.doc.toString()])));
    const myTitles = new Map([...titles.map].map(([id, obj]) => ([id, {...obj, state: false}])));
    const data1 = stringify({
        version: 2,
        windows,
        positions,
        zIndex,
        titles: {map: myTitles},
        windowTypes,
        padTitle,
        windowEnabled
    });

    const data2 = stringifyCodeMap(code);

    return encodeURIComponent(data1) + encodeURIComponent(data2);
};`],
[`44`, `const _saver2 = ((windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled) => {
    const data = saveData(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled);

    const dataStr = "data:text/plain;charset=utf-8," + data;
    const div = document.createElement("a");
    div.setAttribute("href", dataStr);
    div.setAttribute("download", \`\${padTitle}.renkon\`);
    div.click();
})(windows, positions, zIndex, titles, windowContents, windowTypes, padTitle, windowEnabled, save);`],
[`45`, `const _loader = (() => {
    const input = document.createElement("div");
    input.innerHTML = \`<input id="imageinput" type="file" accept=".json,.renkon">\`;
    const imageInput = input.firstChild;

    imageInput.onchange = () => {
        const file = imageInput.files[0];
        if (!file) {imageInput.remove(); return;}
        new Promise(resolve => {
            let reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsArrayBuffer(file);
        }).then((data) => {
            const result = new TextDecoder("utf-8").decode(data);
            loadData(result, imageInput);
        });
        imageInput.value = "";
    };
    imageInput.oncancel = () => imageInput.remove();
    document.body.appendChild(imageInput);
    imageInput.click();
})(load);`],
[`46`, `const nameFromUrl = (() => {
        const maybeUrl = new URL(window.location).searchParams.get("file");
        if (maybeUrl) {
            return maybeUrl;
        }
        return undefined;
    })();`],
[`47`, `const loadData = (result, maybeImageInput) => {
    const index = result.indexOf("{__codeMap: true, value:");
    if (index < 0) {
        const loaded = parse(result);
        if (loaded.version === 1) {
            Events.send(loadRequest, loaded);
            maybeImageInput?.remove();
            return;
        }
        console.log("unknown type of data");
        maybeImageInput?.remove();
        return;
    }

    const data1 = result.slice(0, index);
    const data2 = result.slice(index);

    const loaded = parse(data1);

    if (loaded.version === 2) {
        const code = parseCodeMap(data2);
        loaded.code = code;
        Events.send(loadRequest, loaded);
        maybeImageInput?.remove();
        return;
    }
    console.log("unknown type of data");
    maybeImageInput.remove();
}`],
[`48`, `const _loadFromUrl = fetch(nameFromUrl).then((resp) => resp.text()).then((result) => {
    loadData(result, null);
});`],
[`49`, `function stringifyInner(node, seen) {
    if (node === undefined) return undefined;
    if (typeof node === 'number') return Number.isFinite(node) ? \`\${node}\` : 'null';
    if (typeof node !== 'object') return JSON.stringify(node, null, 4);

    let out;
    if (Array.isArray(node)) {
        out = '[';
        for (let i = 0; i < node.length; i++) {
            if (i > 0) out += ',';
            out += stringifyInner(node[i], seen) || 'null';
        }
        return out + ']';
    }

    if (node === null) return 'null';

    if (seen.has(node)) {
        throw new TypeError('Converting circular structure to JSON');
    }

    seen.add(node);

    if (node.constructor === window.Map) {
        let replacement = {__map: true, values: [...node]};
        return stringifyInner(replacement, seen);
    }

    if (node.constructor === window.Set) {
        let replacement = {__set: true, values: [...node]};
        return stringifyInner(replacement, seen);
    }

    let keys = Object.keys(node).sort();
    out = '';
    for (let i = 0; i < keys.length; i++) {
        let key = keys[i];
        let value = stringifyInner(node[key], seen, out);
        if (!value) continue;
        if (out !== '') out += ',\\n';
        out += JSON.stringify(key) + ':' + value;
    }
    seen.delete(node);
    return '{' + out + '}';
}`],
[`50`, `function stringify(obj) {
    let seen = new Set();
    return stringifyInner(obj, seen);
}`],
[`51`, `function parse(string) {
    return JSON.parse(string, (_key, value) => {
        if (typeof value === "object" && value !== null && value.__map) {
            return new Map(value.values);
        } else if (typeof value === "object" && value !== null && value.__set) {
            return new Set(value.values);
        }
        return value;
    });
}`],
[`52`, `function stringifyCodeMap(map) {
    function replace(str) {
        return str.replaceAll("\\\\", "\\\\\\\\").replaceAll("\`", "\\\\\`").replaceAll("\$", "\\\\\$");
    }

    return "\\n{__codeMap: true, value: " + "[" +
        [...map].map(([key, value]) => ("[" + "\`" + replace(key) + "\`" + ", " + "\`" +
                                        replace(value) + "\`" + "]")).join(",\\n") + "]" + "}"
}`],
[`53`, `function parseCodeMap(string) {
    const array = eval("(" + string + ")");
    return new Map(array.value);
}`],
[`54`, `const css = \`
@font-face {
    font-family: "OpenSans-Regular";
    src: url("./assets/fonts/open-sans-v17-latin-ext_latin-regular.woff2") format("woff2");
}

@font-face {
  font-family: 'OpenSans-SemiBold';
  src: url("./assets/fonts/open-sans-v17-latin-ext_latin-600.woff2") format('woff2');
}

html, body, #renkon {
    overflow: hidden;
    height: 100%;
    margin: 0px;
}

html, body {
  overscroll-behavior-x: none;
  touch-action: none;
}

#pad {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0px;
    left: 0px;
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAjElEQVR4XuXQAQ0AAAgCQfoHpYbOGt5vEODSdgovd3I+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+gA/gA/gAPoAP4AP4AD6AD+AD+AA+wIcWxEeefYmM2dAAAAAASUVORK5CYII=);
}

#mover {
    pointer-events: none;
    position:absolute;
    transform-origin: 0px 0px;
}

#owner {
    position: absolute;
    pointer-events: initial;
}

.editor {
    height: 100%;
    border-radius: 0px 0px 6px 6px;
}

#overlay {
    pointer-events: none;
    height: 100%;
    width: 100%;
    position: absolute;
    top: 0px;
    left: 0px;
    z-index: 10000;
}

.window {
    position: absolute;
    background-color: #eee;
    border-radius: 6px;
    box-shadow: inset 0 2px 2px 0 rgba(255, 255, 255, 0.8), 1px 1px 8px 0 rgba(0, 35, 46, 0.2);
}

#buttonBox {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-end;
    row-gap: 8px;
    left: 0px;
    top: 0px;
    width: 100%;
    padding-bottom: 8px;
    padding-top: 8px;
    border-bottom: 1px solid black;
    background-color: white;
    position: absolute;
    z-index: 200000;
}

#padTitle {
    margin-left: 24px;
}

.spacer {
    flex-grow: 1;
}

.menuButton {
    font-family: 'OpenSans-SemiBold';
    color: black;
    margin-left: 4px;
    margin-right: 4px;
    border-radius: 4px;
    cursor: pointer;
    border: 2px solid #555;
}
                   

.runnerIframe {
    width: 100%;
    height: 100%;
    border: 2px solid black;
    box-sizing: border-box;
    border-radius: 0px 0px 6px 6px;
    background-color: #fff;
    user-select: none;
}

.titleBar {
    background-color: #bbb;
    width: 100%;
    height: 28px;
    display: flex;
    /* border: 2px ridge #ccc;*/
    /* box-sizing: border-box; */
    border-radius: 6px 6px 0px 0px;
    cursor: -webkit-grab;
    cursor: grab;
}

.title {
    font-family: OpenSans-Regular;
    pointer-events: none;
    margin-left: 10px;
    flex-grow: 1;
    margin-right: 20px;
    padding-left: 10px;
}

.title[contentEditable="true"] {
    background-color: #eee;
    pointer-events: all;
    user-select: all;
}

.titlebarButton {
    height: 19px;
    width: 19px;
    margin: 2px;
    margin-top: 2px;
    pointer-events: all;
    border-radius: 4px;
    background-position: center;
    cursor: pointer;
}

.titlebarButton:hover {
    background-color: #eee;
}

.closeButton {
    background-image: url("data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20data-name%3D%22Layer%201%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M8.48%2C12.25C6.4%2C10.17%2C4.37%2C8.16%2C2.35%2C6.15c-.34-.34-.68-.69-1-1.05a2.34%2C2.34%2C0%2C0%2C1%2C.17-3.26%2C2.3%2C2.3%2C0%2C0%2C1%2C3.25-.09C7%2C3.93%2C9.23%2C6.14%2C11.45%2C8.34a5.83%2C5.83%2C0%2C0%2C1%2C.43.58c.36-.4.62-.71.9-1%2C2-2%2C4.12-4%2C6.12-6.08a2.51%2C2.51%2C0%2C0%2C1%2C3.41%2C0%2C2.37%2C2.37%2C0%2C0%2C1%2C0%2C3.43c-2.18%2C2.22-4.39%2C4.41-6.58%2C6.62-.11.1-.21.22-.34.35l.44.48L22.09%2C19A2.7%2C2.7%2C0%2C0%2C1%2C23%2C20.56a2.49%2C2.49%2C0%2C0%2C1-1.29%2C2.54A2.36%2C2.36%2C0%2C0%2C1%2C19%2C22.69c-2-2-4-4-6.06-6-.33-.33-.62-.68-1-1.12-1.63%2C1.66-3.17%2C3.25-4.73%2C4.82-.79.8-1.6%2C1.59-2.42%2C2.36a2.32%2C2.32%2C0%2C0%2C1-3.21-.1%2C2.3%2C2.3%2C0%2C0%2C1-.19-3.25c2.14-2.2%2C4.31-4.36%2C6.48-6.54Z%22%20fill%3D%22%234D4D4D%22%2F%3E%3C%2Fsvg%3E");
}

.editButton {
    background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3C!--%20Generator%3A%20Sketch%2064%20(93537)%20-%20https%3A%2F%2Fsketch.com%20--%3E%3Ctitle%3Eicon%2Fmaterial%2Fedit%3C%2Ftitle%3E%3Cdesc%3ECreated%20with%20Sketch.%3C%2Fdesc%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fedit%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-round-edit%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M3%2C17.46%20L3%2C20.5%20C3%2C20.78%203.22%2C21%203.5%2C21%20L6.54%2C21%20C6.67%2C21%206.8%2C20.95%206.89%2C20.85%20L17.81%2C9.94%20L14.06%2C6.19%20L3.15%2C17.1%20C3.05%2C17.2%203%2C17.32%203%2C17.46%20Z%20M20.71%2C7.04%20C20.8972281%2C6.85315541%2021.002444%2C6.59950947%2021.002444%2C6.335%20C21.002444%2C6.07049053%2020.8972281%2C5.81684459%2020.71%2C5.63%20L18.37%2C3.29%20C18.1831554%2C3.10277191%2017.9295095%2C2.99755597%2017.665%2C2.99755597%20C17.4004905%2C2.99755597%2017.1468446%2C3.10277191%2016.96%2C3.29%20L15.13%2C5.12%20L18.88%2C8.87%20L20.71%2C7.04%20Z%22%20id%3D%22Icon-Shape%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.runButton {
    background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%2F%3E%3C!--%20Right-pointing%20triangle%20(play%20icon)%20--%3E%3Cpath%20d%3D%22M9%207L17%2012L9%2017Z%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
    display: none;
    pointer-events: none;
}

.runButton[type="runner"] {
    display: inherit;
    pointer-events: all;
}

.resizeHandler {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 6px;
    z-index: 10000;
    background-color: rgba(0.1, 0.1, 0.1, 0.03);
}

.resizeHandler[corner="bottomRight"] {
    cursor: se-resize;
    bottom: -15px;
    right: -15px;
}

.resizeHandler[corner="topLeft"] {
    cursor: nw-resize;
    top: -15px;
    left: -15px;
}

.resizeHandler[corner="bottomLeft"] {
    cursor: sw-resize;
    bottom: -15px;
    left: -15px;
}

.resizeHandler[corner="topRight"] {
    cursor: ne-resize;
    top: -15px;
    right: -15px;
}

.resizeHandler:hover {
    background-color: rgba(0.1, 0.4, 0.1, 0.3);
}

.windowHolder {
    height: calc(100% - 24px);
    box-sizing: border
}

.windowHolder[blurred="true"] {
    filter: blur(4px)
}

#navigationBox {
    display: flex;
    flex-direction: column;
    right: 20px;
    gap: 10px;
    bottom: 80px;
    align-items: center;
    width: 40px;
    border: 1px solid black;
    background-color: #d2d2d2;
    position: absolute;
    z-index: 200000;
    border-radius: 8px;
    box-shadow: 4px 5px 8px -2px rgba(0,0,0,.15);
}

.navigationButton {
    width: 30px;
    height: 30px;
    display: flex;
    cursor: pointer;
}

.with-border {
    border: 1px solid #4D4D4D;
    border-radius: 15px;
    background-color: white;
}

.navigationButton:hover {
    background-color: #eaeaea;
}

.navigationButton:first-child {
    margin-top: 10px;
}

.navigationButton:last-child {
    margin-bottom: 10px;
}

.navigationButtonImage {
    width: 100%;
    height: 100%;
    background-position: center;
    background-repeat: no-repeat;
}

#zoomInButton {
    background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-in%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-in%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-add%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2013%2013%2013%2013%2019%2011%2019%2011%2013%205%2013%205%2011%2011%2011%2011%205%2013%205%2013%2011%2019%2011%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#zoomOutButton {
    background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fmaterial%2Fview_zoom-out%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fmaterial%2Fview_zoom-out%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22ic-baseline-minus%22%3E%3Cg%20id%3D%22Icon%22%20fill%3D%22%234D4D4D%22%3E%3Cpolygon%20id%3D%22Icon-Path%22%20points%3D%2219%2012.998%205%2012.998%205%2010.998%2019%2010.998%22%3E%3C%2Fpolygon%3E%3C%2Fg%3E%3Crect%20id%3D%22ViewBox%22%20fill-rule%3D%22nonzero%22%20x%3D%220%22%20y%3D%220%22%20width%3D%2224%22%20height%3D%2224%22%3E%3C%2Frect%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

#homeButton {
    background-image: url("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Ctitle%3Eicon%2Fview-centered%3C%2Ftitle%3E%3Cg%20id%3D%22icon%2Fview-centered%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20id%3D%22Group-3%22%20transform%3D%22translate(2.000000%2C%204.000000)%22%20fill%3D%22%234D4D4D%22%3E%3Cpath%20d%3D%22M0%2C9%20L3%2C9%20L3%2C7%20L0%2C7%20L0%2C9%20Z%20M17%2C9%20L20.001%2C9%20L20.001%2C7%20L17%2C7%20L17%2C9%20Z%20M9%2C3%20L11%2C3%20L11%2C0%20L9%2C0%20L9%2C3%20Z%20M13%2C9%20L11%2C9%20L11%2C11%20L9%2C11%20L9%2C9%20L7%2C9%20L7%2C7%20L9%2C7%20L9%2C5%20L11%2C5%20L11%2C7%20L13%2C7%20L13%2C9%20Z%20M9%2C16%20L11%2C16%20L11%2C13%20L9%2C13%20L9%2C16%20Z%20M13%2C0%20L13%2C2%20L18%2C2%20L18%2C5%20L20%2C5%20L20%2C0%20L13%2C0%20Z%20M18%2C14%20L13%2C14%20L13%2C16%20L20%2C16%20L20%2C11%20L18%2C11%20L18%2C14%20Z%20M0%2C5%20L2%2C5%20L2%2C2%20L7%2C2%20L7%2C0%20L0%2C0%20L0%2C5%20Z%20M2%2C11%20L0%2C11%20L0%2C16%20L7%2C16%20L7%2C14%20L2%2C14%20L2%2C11%20Z%22%20id%3D%22Fill-1%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton {
    background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Box%20outline%20--%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20stroke-width%3D%222%22%2F%3E%3C!--%20Thicker%20checkmark%20--%3E%3Cpath%20d%3D%22M5.5%2012.5L10.5%2017.5L18.5%207.5%22%20stroke-width%3D%223%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
}

.enabledButton[disabled="true"] {
    background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20x%3D%223%22%20y%3D%223%22%20width%3D%2218%22%20height%3D%2218%22%20rx%3D%222%22%20ry%3D%222%22%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%3C%2Fsvg%3E");
}

.inspectorButton {
    background-image: url("data:image/svg+xml,%3Csvg%20width%3D%2224px%22%20height%3D%2224px%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20stroke%3D%22%234D4D4D%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C!--%20Line%201%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%227%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%227%22%20x2%3D%2219%22%20y2%3D%227%22%2F%3E%3C!--%20Line%202%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2212%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2212%22%20x2%3D%2219%22%20y2%3D%2212%22%2F%3E%3C!--%20Line%203%20--%3E%3Ccircle%20cx%3D%225%22%20cy%3D%2217%22%20r%3D%221.5%22%20fill%3D%22%234D4D4D%22%20stroke%3D%22none%22%2F%3E%3Cline%20x1%3D%228%22%20y1%3D%2217%22%20x2%3D%2219%22%20y2%3D%2217%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
    display: none;
    pointer-events: none;
}

.inspectorButton[type="runner"] {
    display: inherit;
    pointer-events: all;
}

.cm-tooltip-lint {
   font-size: 12px;
}

.cm-tooltip-dependency {
    background-color: #66b;
    color: white;
    border: none;
    padding: 2px 7px;
    border-radius: 4px;
}

.cm-tooltip-cursor-wide {
   text-wrap: nowrap;
}
\`;`],
[`55`, `((css) => {
    const renkon = document.querySelector("#renkon");
    const style = document.createElement("style");
    style.id = "pad-css";
    style.textContent = css;
    renkon.querySelector("#pad-css")?.remove();
    renkon.appendChild(style);
})(css);`],
[`56`, `    const analyzed = ((windowContents, windowEnabled, trigger, showGraph) => {
        if (!showGraph) {return new Map()}
        if (trigger === null) {return new Map()}
        if (typeof trigger === "object" && trigger.id) {return new Map();}
        const programState = new Renkon.constructor(0);
        programState.setLog(() => {});

        const blockMap = new Map() // name -> blockId
        const nodes = new Map(); // blockId -> {exports:Set, imports: Set}
        const edges = new Map(); // blockId -> {edgesOut: [{id, dest}], edgesIn: [{id, origin}], exports: [id]}

        const code = [...windowContents.map].filter(
            ([id, editor]) => editor.state && windowEnabled.map.get(id)?.enabled)
            .map(([id, editor]) => ({blockId: id, code: editor.state.doc.toString()}));
        try {
            code.forEach(info => {
                const blockId = info.blockId;
                programState.setupProgram([info.code]);
                nodes.set(blockId, {exports: new Set(), imports: new Set()});
                edges.set(blockId, {edgesOut: [], edgesIn: [], exports: []});
                const obj = nodes.get(blockId);
                for (const jsNode of programState.nodes.values()) {
                    for (const input of jsNode.inputs) {
                        if (/^_[0-9]/.test(input)) {continue;}
                        obj.imports.add(input)
                    }
                    if (jsNode.outputs === "") {continue;}
                    if (/^_[0-9]/.test(jsNode.outputs)) {continue;}
                    blockMap.set(jsNode.outputs, blockId)
                    obj.exports.add(jsNode.outputs);
                }
            });
        } catch(e) {
            console.log("Graph analyzer encountered an error in source code:");
            return new Map();
        }

        for (let [id, obj] of nodes) {
            for (const exported of obj.exports) {//exported:string
                const edgesOut = edges.get(id).edgesOut;
                const exports = edges.get(id).exports;
                for (let [importId, importObj] of nodes) {
                    if (importId === id) {continue;}
                    const edgesIn = edges.get(importId).edgesIn;
                    if (importObj.imports.has(exported)) {
                        if (edgesOut.findIndex((already) => already.id === exported && already.dest === importId) < 0) {
                            edgesOut.push({id: exported, dest: importId});
                            if (exports.indexOf(exported) < 0) {
                                exports.push(exported);
                            }
                        }
                        if (edgesIn.findIndex((already) => already.id === exported && already.origin === id) < 0) {
                            edgesIn.push({id: exported, origin: id});
                        }
                    }
                }
            }
        }
        return edges;
    })(windowContents, windowEnabled, Events.or(remove, hovered), showGraph === "showGraph");
`],
[`57`, `const line = (p1, p2, color, label) => {
    let pl;
    let pr;
    if (p1.x < p2.x) {
        pl = p1;
        pr = p2;
    } else {
        pl = p2;
        pr = p1;
    }
    const c0 = \`\${pl.x} \${pl.y}\`;
    const c1 = \`\${pl.x + (pr.x - pl.x) * 0.5} \${pl.y + (pr.y - pl.y) * 0.2}\`;
    const c2 = \`\${pr.x - (pr.x - pl.x) * 0.2} \${pl.y + (pr.y - pl.y) * 0.6}\`;
    const c3 = \`\${pr.x} \${pr.y}\`;
    return html\`<path d="M \${c0} C \${c1} \${c2} \${c3}" stroke="\${color}" fill="transparent" stroke-width="2" stroke-linecap="round"></path><text x="\${p1.x + 5}" y="\${p1.y}">\${label}</text>\`;
};`],
[`58`, `const hovered = Events.receiver();`],
[`59`, `const hoveredB = Behaviors.keep(hovered);`],
[`60`, `const graph = ((positions, padView, analyzed, hoveredB, showGraph) => {
    if (hoveredB === null) {return [];}
    if (!showGraph) {return [];}

    const edges = analyzed.get(hoveredB);

    if (!edges) {return [];} // runner does not have edges

    const exportEdges = new Set();
    const importEdges = new Set();

    const outEdges = edges.edgesOut.map((edge) => {
        const ind = edges.exports.indexOf(edge.id);
        let p1 = positions.map.get(hoveredB);
        p1 = {x: p1.x + p1.width, y: p1.y};
        // p1 = {x: p1.x * padView.scale + padView.x, y: p1.y * padView.scale + padView.y};
        p1 = {x: (p1.x + padView.x) * padView.scale, y: (p1.y + padView.y) * padView.scale};
        p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
        let p2 = positions.map.get(edge.dest);
        p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
        p2 = {x: p2.x, y: p2.y + 10};
        let e = "";
        if (!exportEdges.has(edge.id)) {
            exportEdges.add(edge.id);
            e = edge.id;
        }
        return line(p1, p2, "#d88", e);
    });

    const inEdges = edges.edgesIn.map((edge) => {
        const exporter = analyzed.get(edge.origin);
        const ind = exporter.exports.indexOf(edge.id);
        let p1 = positions.map.get(edge.origin);
        p1 = {x: p1.x + p1.width, y: p1.y};
        p1 = {x: (p1.x + padView.x) * padView.scale , y: (p1.y + padView.y) * padView.scale};
        p1 = {x: p1.x, y: p1.y + ind * 20 + 10};
        let p2 = positions.map.get(hoveredB);
        p2 = {x: (p2.x + padView.x) * padView.scale, y: (p2.y + padView.y) * padView.scale};
        p2 = {x: p2.x, y: p2.y + 10};
        let e = "";
        if (!importEdges.has(edge.id)) {
            importEdges.add(edge.id);
            e = edge.id;
        }
        return line(p1, p2, "#88d", e);
    });

    return html\`<svg viewBox="0 0 \${window.innerWidth} \${window.innerHeight}" xmlns="http://www.w3.org/2000/svg">\${outEdges}\${inEdges}</svg>\`;
})(positions, padView, Behaviors.keep(analyzed), hoveredB, showGraph === "showGraph");`],
[`61`, `const _graphRender = render(graph, document.querySelector("#overlay"));`],
[`62`, `const windows = Behaviors.select(
    [],
    loadRequest, (_prev, data) => {
        return data.windows
    },
    newWindowRequest, (prev, spec) => [...prev, \`\${spec.id}\`],
    remove, (prev, removeCommand) => prev.filter((e) => e != removeCommand.id),
);`],
[`63`, `const windowTypes = Behaviors.select(
    {map: new Map()},
    loadRequest, (_prev, data) => {
        return data.windowTypes;
    },
    newWindowRequest, (prev, spec) => {
        prev.map.set(\`\${spec.id}\`, spec.type);
        return {map: prev.map};
    },
    windows, (prev, windows) => {
        const keys = [...prev.map.keys()];
        const news = windows.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !windows.includes(e));

        olds.forEach((id) => prev.map.delete(\`\${id}\`));
        news.forEach((id) => prev.map.set(\`\${id}\`, "code"));
        return {map: prev.map};
    }
);`],
[`64`, `const positions = Behaviors.select(
    {map: new Map()},
    loadRequest, (_prev, data) => {
        return data.positions;
    },
    windowTypes, (prev, types) => {
        const keys = [...prev.map.keys()];
        const typeKeys = [...types.map.keys()];
        const news = typeKeys.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !typeKeys.includes(e));

        const newX = (typeKeys.length * 5 + 40) / padView.scale - padView.x;
        const newY = (typeKeys.length * 5 + 45) / padView.scale - padView.y;

        const newWindow = (id, type) => {
            return {
                id,
                x: newX,
                y: newY,
                width: type === "code" ? 300 : 800,
                height: type === "code" ? 200 : 400
            }
        };
        olds.forEach((id) => prev.map.delete(\`\${id}\`));
        news.forEach((id) => prev.map.set(\`\${id}\`, newWindow(id, types.map.get(id))));
        return {map: prev.map};
    },
    moveOrResize, (prev, command) => {
        const v = {...prev.map.get(command.id), ...command};
        prev.map.set(command.id, v);
        return {map: prev.map};
    }
);`],
[`65`, `const findMax = (map)  => {
    let maxId = -1;
    let max = -1;
    for (let [id, value] of map) {
        if (value > max) {
            maxId = id;
            max = value;
        }
    }
    return {maxId, max};
};`],
[`66`, `const zIndex = Behaviors.select(
    {map: new Map()},
    loadRequest, (_prev, data) => {
        if (data.zIndex) return data.zIndex;
        return {map: new Map(data.windows.map((w, i) => [w, i + 100]))};
    },
    windows, (prev, command) => {
        const keys = [...prev.map.keys()];
        const news = command.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !command.includes(e));

        const {maxId:_maxId, max} = findMax(prev.map);
        let z = max < 0 ? 100 : max + 1;
        olds.forEach((id) => prev.map.delete(id));
        news.forEach((id) => prev.map.set(id, z++));
        return {map: prev.map};
    },
    moveOrResize, (prev, command) => {
        if (command.type === "move") {
            const z = prev.map.get(command.id);

            const {maxId, max} = findMax(prev.map);
            if (maxId !== command.id) {
                prev.map.set(maxId, z);
                prev.map.set(command.id, max);
            }
            return {map: prev.map};
        }
        return prev;
    },
);`],
[`67`, `const titles = Behaviors.select(
    {map: new Map()},
    loadRequest, (_prev, loaded) => {
        return loaded.titles || {map: new Map()};
    },
    windows, (prev, command) => {
        const keys = [...prev.map.keys()];
        const news = command.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !command.includes(e));

        olds.forEach((id) => prev.map.delete(id));
        news.forEach((id) => prev.map.set(id, {id, state: false, title: "untitled"}));
        return {map: prev.map};
    },
    titleEditChange, (prev, change) => {
        const id = change.id;
        const v = {...prev.map.get(id), ...change};
        prev.map.set(id, v);
        return {map: prev.map};
    }
);`],
[`68`, `const windowEnabled = Behaviors.select(
    {map: new Map()},
    loadRequest, (_prev, loaded) => {
        return loaded.windowEnabled || {map: new Map()};
    },
    windows, (prev, command) => {
        const keys = [...prev.map.keys()];
        const news = command.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !command.includes(e));

        olds.forEach((id) => prev.map.delete(id));
        news.forEach((id) => prev.map.set(id, {id, enabled: true}));
        return {map: prev.map};
    },
    enabledChange, (prev, change) => {
        const id = change.id;
        const v = {...prev.map.get(id), ...change};
        prev.map.set(id, v);
        return {map: prev.map};
    }
);`],
[`69`, `const windowContents = Behaviors.select(
    {map: new Map()},
    loadRequest, (prev, loaded) => {
        for (let editor of prev.map.values()) {
            editor.dom.remove();
        }
        prev.map.clear();

        for (let [id, type] of loaded.windowTypes.map) {
            let elem;
            if (type === "code") {
                elem = newEditor(id, loaded.code.get(id));
            } else {
                elem = newRunner(id);
            }
            prev.map.set(id, elem);
        }
        return {map: prev.map};
    },
    windowTypes, (prev, types) => {
        const keys = [...prev.map.keys()];
        const typeKeys = [...types.map.keys()];
        const news = typeKeys.filter((e) => !keys.includes(e));
        const olds = keys.filter((e) => !typeKeys.includes(e));
        olds.forEach((id) => {
            const editor = prev.map.get(id);
            editor.dom.remove();
            prev.map.delete(id)
        });
        news.forEach((id) => {
            const type = types.map.get(id);
            prev.map.set(id, type === "code" ? newEditor(id) : newRunner(id));
        });
        return {map: prev.map};
    }
);`],
[`70`, `const init = Events.once("code");`],
[`71`, `const newId = Events.select(
    0,
    loadRequest, (_prev, request) => {
        const max = Math.max(...request.windows.map((w) => Number.parseInt(w)));
        return max;
    },
    Events.or(addCode, addRunner, init), (prev, _type) => prev + 1
);`],
[`72`, `const newWindowRequest = {id: newId, type: Events.or(addCode, addRunner, init), padView};`],
[`73`, `const padView = Behaviors.select(
    {x: 0, y: 0, scale: 1},
    padViewChange, (prev, view) => {
        let {x, y, scale} = view;

        if (scale < 0.1) {
            x = prev.x;
            y = prev.y;
            scale = 0.1;
        }
        if (scale > 20) {
            x = prev.x;
            y = prev.y;
            scale = 20;
        }
        return {...prev, ...{x, y, scale}};
    }
);`],
[`74`, `const padTitle = Behaviors.select(
    "untitled",
    loadRequest, (_prev, data) => {
        return data.padTitle || "untitled"
    },
    titleChange, (_prev, request) => request
);`],
[`75`, `const titleChange = Events.observe((notify) => {
    const change = (evt) => {
        notify(evt.target.value);
    };

    renkon.querySelector("#padTitle").addEventListener("input", change);
    return () => {renkon.querySelector("#padTitle").removeEventListener("change", change);}
});`],
[`76`, `const _padTitleUpdater = ((padTitle) => {
    if (renkon.querySelector("#padTitle").value !== padTitle) {
        renkon.querySelector("#padTitle").value = padTitle;
    }
})(padTitle);`],
[`77`, `const {h, html, render} = import("./preact.standalone.module.js");`],
[`78`, `const renkon = (() => {
    const renkon = document.createElement("div");
    renkon.id = "renkon";
    renkon.innerHTML = \`
<div id="buttonBox">
   <input class="menuButton" id="padTitle"></input>
   <button class="menuButton" id="addCodeButton">code</button>
   <button class="menuButton" id="addRunnerButton">runner</button>
   <div class="spacer"></div>
   <button class="menuButton" id="searchButton">search</button>
   <button class="menuButton" id="showGraph">show graph</button>
   <button class="menuButton" id="saveButton">save</button>
   <button class="menuButton" id="loadButton">load</button>
</div>
<div id="pad"><div id="mover"></div></div>
<div id="overlay"></div>
<div id="navigationBox">
   <div class="navigationButton"><div id="homeButton" class="navigationButtonImage"></div></div>
   <div class="navigationButton with-border"><div id="zoomInButton" class="navigationButtonImage"></div></div>
   <div class="navigationButton with-border"><div id="zoomOutButton" class="navigationButtonImage"></div></div>
</div>

\`.trim();

    document.body.querySelector("#renkon")?.remove();
    document.body.appendChild(renkon);
    return renkon;
})();`],
[`79`, `const searchPanel = ((renkon) => {
    let search = renkon.querySelector("#search");
    search?.remove();
    const div = document.createElement("div");
    div.innerHTML = \`
<div class="search-panels search-panels-bottom" style="bottom: 0px;">
    <div class="search-search search-panel">
        <input value="" placeholder="Find" aria-label="Find" class="search-textfield" name="search" form="" main-field="true">
        <button class="search-button" name="next" type="button">next</button>
        <!-- <button class="search-button" name="prev" type="button">previous</button>
        <button class="search-button" name="select" type="button">all</button> -->
        <label><input type="checkbox" name="case" form="">match case</label>
        <label><input type="checkbox" name="re" form="">regexp</label>
        <label><input type="checkbox" name="word" form="">by word</label>
        <!-- <input value="" placeholder="Replace" aria-label="Replace" class="search-textfield" name="replace" form="">
        <button class="search-button" name="replace" type="button">replace</button>
        <button class="search-button" name="replaceAll" type="button">replace all</button> -->
        <button name="close" aria-label="close" type="button">×</button>
    </div>
</div>
\`.trim();
    search = div.childNodes[0];
    search.id = "search";
    renkon.appendChild(search);
    return search;
})(renkon);`],
[`80`, `const newEditor = (id, doc) => {
    const mirror = window.CodeMirror;

    const config = {
        // eslint configuration
        languageOptions: {
            globals: mirror.globals,
            parserOptions: {
                ecmaVersion: 2022,
                sourceType: "module",
            },
        },
        rules: {
        },
    };

    const getDecl = (state, pos) => {
        const showDependency = Renkon.resolved.get("showGraph")?.value;
        if (!showDependency || showDependency !== "showDeps") {return;}
        let decls;
        try {
            decls = Renkon.findDecls(state.doc.toString());
        } catch(e) {
            console.log("Dependency analyzer encountered an error in source code:");
            return;
        }
        const head = pos !== undefined ? pos : state.selection.ranges[0]?.head;
        if (typeof head !== "number") {return;}
        const decl = decls.find((d) => d.start <= head && head < d.end);
        if (!decl) {return;}
        const programState = new Renkon.constructor(0);
        programState.setLog(() => {});
        try {
            programState.setupProgram([decl.code]);
        } catch (e) {
            console.log("could not find the declarations as there is a syntax error");
            return;
        }
        const keys = [...programState.nodes.keys()];
        const last = keys[keys.length - 1];
        const deps = [];
        for (const k of keys) {
            const is = programState.nodes.get(k).inputs;
            deps.push(...is.filter((n) => !/_[0-9]/.exec(n)));
        }
        return {deps, name: last}
    }

    const wordHover = mirror.view.hoverTooltip((view, pos, _side) => {
        let node = getDecl(view.state, pos);
        if (!node) return null;
        const {deps, name} = node;
        return {
            pos,
            above: true,
            create() {
                let dom = document.createElement("div");
                dom.textContent = \`\${deps} -> \${name}\`;
                dom.className = "cm-tooltip-dependency cm-tooltip-cursor-wide";
                return {dom};
            }
        };
    });

    const openSearch = ({_state, _dispatch }) => {
        Events.send(toggleSearchPanel, true);
        return true;
    };

    const search = {key: "Mod-f", run: openSearch, shift: openSearch};

    const cursorChange = mirror.view.ViewPlugin.fromClass(class {
        update(update) {
            if (update.selectionSet || update.docChanged) {
                this.reportCursor(update.view);
            }
        }

        reportCursor(view) {
            const pos = view.state.selection.main.head;
            Events.send(cursorChanged, {id: id, position: pos});
        }
    });

    const editor = new mirror.EditorView({
        doc: doc || \`console.log("hello")\`,
        extensions: [
            mirror.view.keymap.of([search]),
            mirror.basicSetup,
            mirror["lang-javascript"].javascript({typescript: true}),
            mirror.EditorView.lineWrapping,
            mirror.EditorView.editorAttributes.of({"class": "editor"}),
            mirror.view.keymap.of([mirror.commands.indentWithTab]),
            mirror.lint.linter
                (mirror["lang-javascript"]
                     .esLint(new mirror["eslint-linter-browserify"].Linter(), config)),
            wordHover,
            cursorChange,
        ],
    });
    editor.dom.id = \`\${id}-editor\`;
    return editor;
};`],
[`81`, `const newRunner = (id) => {
    const runnerIframe = document.createElement("iframe");
    runnerIframe.srcdoc = \`
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
.dock {
    position: fixed;
    top: 0px;
    right: 0px;
    width: 35%;
    height: 80%;
    display: flex;
    box-shadow: 10px 10px 5px #4d4d4d, -10px -10px 5px #dddddd;
    transition: left 0.5s;
    background-color: white;
    z-index: 1000000;
    overflow-y: scroll;
}

.dock #inspector {
    flex-grow: 1;
    margin: 0px 20px 0px 20px;
    background-color: #ffffff;
    border: 1px solid black;
}

</style>
        <script type="module">
            import {ProgramState, CodeMirror, newInspector} from "./renkon-web.js";
            window.thisProgramState = new ProgramState(Date.now());
            window.CodeMirror = CodeMirror;
            window.newInspector = newInspector;

            window.onmessage = (evt) => {
                if (evt.data && Array.isArray(evt.data.code)) {
                    window.thisProgramState.updateProgram(evt.data.code, evt.data.path);
                }
                if (evt.data && typeof evt.data.inspector === "boolean") {
                    if (window.thisProgramState) {
                        if (document.body.querySelector(".dock")) {
                            document.body.querySelector(".dock").remove();
                            return;
                        }
                        const dock = document.createElement("div");
                        dock.classList.add("dock");
                        const dom = document.createElement("div");
                        dom.id = "renkonInspector";

                        dock.appendChild(dom);
                        document.body.appendChild(dock);
                        const result = thisProgramState.order.map((id) => {
                            return [
                                id + " (" + thisProgramState.types.get(id) + ")",
                                thisProgramState.resolved.get(id)
                            ];
                        });
                        newInspector(Object.fromEntries(result), dom);
                   }
                }
            };
        </script>
    </head>
    <body></body>
</html>\`;
    runnerIframe.classList = "runnerIframe";
    runnerIframe.id = \`runner-\${id}\`;
    return {dom: runnerIframe};
};`],
[`82`, `const dblClick = Events.listener(renkon.querySelector("#pad"), "dblclick", (evt) => evt);`],
[`83`, `const rawPadDown = Events.listener(renkon.querySelector("#pad"), "pointerdown", (evt) => {
    const strId = evt.target.id;
    if (strId.endsWith("-title") && (evt.target.getAttribute("contenteditable") === "true")) {
        return evt;
    }
    if (strId) {
        evt.preventDefault();
        evt.stopPropagation();
    }
    return evt;
}, {queued: true});`],
[`84`, `const evCache = new Map();`],
[`85`, `const padDown = Events.collect(undefined, rawPadDown, (old, evts) => {
    let type;
    let id;
    let corner;
    if (evts.length <= 2 && evts[0].isPrimary) {
        let primary = evts[0];
        const strId = primary.target.id;
        if (!strId) {return {...old, type: ""};}
        let x = primary.clientX;
        let y = primary.clientY;
        if (strId === "pad") {
            type = "padDragDown";
            id = strId;
        } else {
            id = \`\${Number.parseInt(strId)}\`;
            if (strId.endsWith("-titleBar")) {
                type = "moveDown";
            } else if (strId.endsWith("-resize")) {
                corner = (/[0-9]+-(.*)-resize/.exec(strId))[1];
                type = "windowResizeDown";
            }
        }
        if (type) {
            primary.target.setPointerCapture(primary.pointerId);
            if (strId === "pad") {
                evCache.set("primary", {x, y});
            }
            if (evts.length === 1) {
                return {
                    id, target: primary.target, type, x: primary.clientX, y: primary.clientY, corner
                };
            }
        } else {
            return {...old, type: ""};
        }
    }

    let secondary;
    if (evCache.get("primary")) {
        if (evts.length === 1 && evCache.size === 1 && !evts[0].isPrimary) {
            secondary = evts[0];
        }
        if (evts.length === 2 && evCache.size === 1 && !evts[1].isPrimary) {
            secondary = evts[1];
        }
    }
    if (!secondary) {return old;}

    const strId = secondary.target.id;
    if (strId !== "pad") {return {type: "stuck", secondary: secondary.pointerId};}
    let primary =  evCache.get("primary");
    let x = secondary.clientX;
    let y = secondary.clientY;
    let dx = primary.x - secondary.clientX;
    let dy = primary.y - secondary.clientY;
    let origDiff = Math.sqrt(dx * dx + dy * dy);
    evCache.set(secondary.pointerId, {origDiff, origScale: padView.scale, x, y});
    return {type: "pinch", secondary: secondary.pointerId};
});`],
[`86`, `const padUp = Events.listener(renkon.querySelector("#pad"), "pointerup", (evt) => {
    // console.log("ev1", evCache);
    evt.target.releasePointerCapture(evt.pointerId);
    evCache.clear();
    // console.log("ev2", evCache);
    return {type: "pointerup", x: evt.clientX, y: evt.clientY};
});`],
[`87`, `const downOrUpOrResize = Events.or(padDown, padUp, pointercancel, lostpointercapture, windowResize);`],
[`88`, `const _padMove = Events.listener("#pad", "pointermove", moveCompute);`],
[`89`, `const windowResize = Events.receiver();`],
[`90`, `const moveOrResize = Events.receiver();`],
[`91`, `const moveCompute = ((downOrUpOrResize, positions, padView) => {
    if (downOrUpOrResize.type === "moveDown" || downOrUpOrResize.type === "windowResizeDown") {
        const start = positions.map.get(downOrUpOrResize.id);
        const scale = padView.scale;
        const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
        const type = downOrUpOrResize.type === "moveDown" ? "move" : "resize";
        return (move) => {
            const diffX = (move.clientX - downPoint.x) / scale;
            const diffY = (move.clientY - downPoint.y) / scale;
            const result = {id: downOrUpOrResize.id, type};
            // const position = positions.map.get(downOrUpOrResize.id);
            if (type === "move") {
                result.x = start.x + diffX;
                result.y = start.y + diffY;
            } else {
                if (downOrUpOrResize.corner === "bottomRight") {
                    const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
                    const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
                    result.width = start.width + realDiffX;
                    result.height = start.height + realDiffY;
                } else if (downOrUpOrResize.corner === "topLeft") {
                    const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
                    const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
                    result.width = start.width - realDiffX;
                    result.height = start.height - realDiffY;
                    result.x = start.x + realDiffX;
                    result.y = start.y + realDiffY;
                } else if (downOrUpOrResize.corner === "topRight") {
                    const realDiffX = start.width + diffX < 120 ? 120 - start.width : diffX;
                    const realDiffY = start.height - diffY < 70 ? start.height - 70 : diffY;
                    result.width = start.width + realDiffX;
                    result.height = start.height - realDiffY;
                    result.y = start.y + realDiffY;
                } else if (downOrUpOrResize.corner === "bottomLeft") {
                    const realDiffX = start.width - diffX < 120 ? start.width - 120 : diffX;
                    const realDiffY = start.height + diffY < 70 ? 70 - start.height : diffY;
                    result.width = start.width - realDiffX;
                    result.height = start.height + realDiffY;
                    result.x = start.x + realDiffX;
                }
            }
            Events.send(moveOrResize, result);
            return move;
        }
    } else if (downOrUpOrResize.type === "padDragDown") {
        const start = padView;
        const scale = start.scale;
        const downPoint = {x: downOrUpOrResize.x, y: downOrUpOrResize.y};
        const type = "padDrag";
        return (move) => {
            const diffX = move.clientX - downPoint.x;
            const diffY = move.clientY - downPoint.y;
            const result = {id: downOrUpOrResize.id, type, scale};
            result.x = start.x + (diffX / scale);
            result.y = start.y + (diffY / scale);
            Events.send(padViewChange, result);
            return move;
        };
    } else if (downOrUpOrResize.type === "pinch") {
        return (move) => {
            const keys = [...evCache.keys()];
            const primary = evCache.get("primary");
            if (!primary) {
                // the first finger has been lifted
                return move;
            }
            const otherKey = keys.find((k) => k !== "primary");
            const secondary = evCache.get(otherKey);
            const isPrimary = move.isPrimary;

            if (isPrimary) {
                const newRecord = {...primary};
                newRecord.x = move.clientX;
                newRecord.y = move.clientY;
                evCache.set("primary", newRecord);
            } else {
                const newRecord = {...secondary};
                newRecord.x = move.clientX;
                newRecord.y = move.clientY;
                evCache.set(otherKey, newRecord);
            }

            const origDiff = secondary.origDiff;
            const origScale = secondary.origScale;

            const pX = isPrimary ? move.clientX : primary.x;
            const pY = isPrimary ? move.clientY : primary.y;

            const sX = isPrimary ? secondary.x : move.clientX;
            const sY = isPrimary ? secondary.y : move.clientY;

            const newDiff = Math.sqrt((pX - sX) ** 2 + (pY - sY) ** 2);

            const newScale = (newDiff / origDiff) * origScale;

            const newCenterX = (pX - sX) / 2 + sX;
            const newCenterY = (pY - sY) / 2 + sY;

            const xInMover = (newCenterX / padView.scale) - padView.x;
            const newX = newCenterX / newScale - xInMover;

            const yInMover = (newCenterY / padView.scale) - padView.y;
            const newY = newCenterY / newScale - yInMover;

            Events.send(padViewChange, {x: newX, y: newY, scale: newScale});
            return move;
        }
    } else if (["pointerup", "lost", "stuck"].includes(downOrUpOrResize.type)) {
        return (move) => move;
    }
})(downOrUpOrResize, positions, padView);`],
[`92`, `const searchRequest = Events.receiver();`],
[`93`, `const searchUpdate = Events.receiver();`],
[`94`, `const toggleSearchPanel = Events.receiver();`],
[`95`, `const cursorChanged = Events.receiver();`],
[`96`, `const cursorState = Behaviors.select(
    {map: new Map()},
    cursorChanged, (prev, cursorChanged) => {
        const id = cursorChanged.id;
        const entry = prev.map.get(id);
        if (!entry || entry.position !== cursorChanged.position) {
            prev.map.set(id, cursorChanged);
            return {map: prev.map, change: id};
        }
        return prev;
    }
);`],
[`97`, `const searchState = Behaviors.select(
    {id: null, range: null, shown: false}, // id: string, editor: EditorView, range: {from: number, to: number}
    search, (prev, _search) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: !prev.shown}),
    toggleSearchPanel, (prev, panelState) => ({id: prev.id, editor: prev.editor, range: prev.range, shown: panelState}),
    searchUpdate, (prev, searchUpdate) => searchUpdate,
    cursorState, (prev, cursorState) => {
        if (cursorState.change) {
            const cursor = cursorState.map.get(cursorState.change);
            return {
                id: cursorState.change,
                range: {from: cursor.position, to: cursor.position},
                shown: prev.shown}
        }
        return prev;
    }
);`],
[`98`, `const _searchHandler = Events.listener(searchPanel.querySelector(\`input[name="search"]\`), "keydown", searchInputHandler);`],
[`99`, `const _searchNext = Events.listener(searchPanel.querySelector(\`button[name="next"]\`), "click", searchNextHandler);`],
[`100`, `const _searchClose = Events.listener(searchPanel.querySelector(\`button[name="close"]\`), "click", searchCloseHandler);`],
[`101`, `const searchInputHandler = (evt) => {
    if (evt.key === "Enter") {
        evt.preventDefault();
        evt.stopPropagation();
        const searchRequest = getSearchRequest(evt.target.parentNode);
        if (searchRequest) {
            Events.send(searchRequest, searchRequest);
        }
    }
};`],
[`102`, `const searchNextHandler = (evt) => {
    const searchRequest = getSearchRequest(evt.target.parentNode);
    if (searchRequest) {
        Events.send(searchRequest, searchRequest);
    }
}`],
[`103`, `const searchCloseHandler = (_evt) => {
    Events.send(toggleSearchPanel, false);
}`],
[`104`, `const getSearchRequest = (searchPanel) => {
    const field = searchPanel.querySelector(\`input[name="search"]\`);
    const search = field?.value;
    const caseSensitive = searchPanel.querySelector(\`input[name="case"]\`)?.checked;
    const regexp = searchPanel.querySelector(\`input[name="re"]\`)?.checked;
    const wholeWord = searchPanel.querySelector(\`input[name="word"]\`)?.checked;
    if (search) {
        return {search, caseSensitive, regexp, wholeWord};
    }
    return null;
}`],
[`105`, `const _searchFieldUpdate = ((searchState) => {
    const searchField = renkon.querySelector("#search");
    if (!searchField) {return;}
    const oldStyle = searchField.style.display;
    const newStyle = searchState.shown ? "inherit" : "none";
    searchField.style.display = newStyle;
    if (newStyle !== oldStyle && newStyle === "inherit") {
        searchField.querySelector(\`input[name="search"]\`).focus();
    }
})(searchState);`],
[`106`, `renkon.querySelector("#search") && (renkon.querySelector("#search").style.display = searchState.shown ? "inherit" : "none");`],
[`107`, `((searchRequest, windowContents, searchState) => {
    const mirror = window.CodeMirror;
    const editorsPair = [...windowContents.map].filter(([_id, content]) => content.state)
    const query = new mirror.search.SearchQuery(searchRequest);
    const startEditorIndex = editorsPair.findIndex((e) => e[0] === searchState.id);
    let found = null;

    for (let i = startEditorIndex <= 0 ? 0 : startEditorIndex; i < editorsPair.length; i++) {
        const myRangeStart = startEditorIndex >= 0 && i === startEditorIndex ? searchState.range.to : 0;
        const targetPair = editorsPair[i];
        const cursor = query.getCursor(targetPair[1].state, myRangeStart);
        cursor.next();
        if (!cursor.done) {
            found = {id: targetPair[0], range: {from: cursor.value.from, to: cursor.value.to}, shown: true};
            break;
        }
    }
    if (found) {
        Events.send(searchUpdate, found);
    } else {
        Events.send(searchUpdate, {id: null, range: null, shown: true});
    }
})(searchRequest, windowContents, searchState)`],
[`108`, `const updateEditorSelection = ((searchUpdate, windowContents) => {
    if (!searchUpdate.id || !searchUpdate.range) {return;}
    const editor = windowContents.map.get(searchUpdate.id);
    const scrollIntoView = editor.scrollDOM.scrollHeight > editor.scrollDOM.clientHeight;
    editor.dispatch({
        changes: [], // no text change
        selection: {anchor: searchUpdate.range.from, head: searchUpdate.range.to},
        scrollIntoView: scrollIntoView,
    });
    editor.focus();
    return searchUpdate;
})(searchUpdate, windowContents);`],
[`109`, `const _searchGoTo = ((padView, positions, updateEditorSelection, windowContents) => {
    const pad = document.body.querySelector("#pad").getBoundingClientRect();

    const visiblePad = {
        x: -padView.x,
        y: -padView.y,
        width: pad.width / padView.scale,
        height: pad.height / padView.scale
    };
    const position = positions.map.get(\`\${updateEditorSelection.id}\`);

    const allVisible = position.x >= visiblePad.x && position.y >= visiblePad.y &&
        position.width + position.x <= visiblePad.x + visiblePad.width &&
        position.height + position.y <= visiblePad.y + visiblePad.height;

    if (allVisible) {return;}

    const editor = windowContents.map.get(updateEditorSelection.id);

    const textPos = editor.coordsAtPos(updateEditorSelection.range.from);
    const scrollRect = editor.scrollDOM.getBoundingClientRect();
    const top = textPos.top - scrollRect.top + editor.scrollDOM.scrollTop;
    const targetY = position.y + top / padView.scale;
    let x = -position.x + 30;
    let y = padView.y;
    if (targetY < visiblePad.y) {
        y = -targetY + 50 / padView.scale;
    } else if (targetY > visiblePad.y + visiblePad.height) {
        y = -targetY + visiblePad.height / 2 / padView.scale;
    }

    Events.send(padViewChange, {x: x, y: y, scale: padView.scale})
})(padView, positions, updateEditorSelection, windowContents);`],
[`110`, `const searchCSS = \`
.search-panels {
    position: absolute;
    top: 40px;
    right: 10px;
    background-color: #f5f5f5;
    color: black;
    display: none;
    max-height: 30px;
}

.search-panels[open="true"] {
    display: inherit;
}

.search-panels-bottom {
    border-top: 1px solid #ddd;
}

.search-search {
    padding: 2px 6px 4px;
}

.search-search input, .search-search button, .search-search label {
    margin: .2em .6em .2em 0;
}
.search-textfield {
    background-color: white;
}
.search-textfield {
    vertical-align: middle;
    color: inherit;
    font-size: 70%;
    border: 1px solid silver;
    padding: .2em .5em;
}

.search-button {
    background-image: linear-gradient(#eff1f5, #d9d9df);
    border: 1px solid #888;
}
.search-button {
    vertical-align: middle;
    color: inherit;
    font-size: 70%;
    padding: .2em 1em;
    border-radius: 1px;
}

.search-search label {
    font-size: 80%;
    white-space: pre;
}

.search-search button[name="close"] {
    background-color: inherit;
    border: none;
    font: inherit;
    padding: 0;
    margin: 0;
}

.search-search button[name="close"]:hover {
    background-color: #eee;
}
\`;`],
[`111`, `((css) => {
    const renkon = document.querySelector("#renkon");
    const style = document.createElement("style");
    style.id = "search-css";
    style.textContent = css;
    renkon.querySelector("#search-css")?.remove();
    renkon.appendChild(style);
})(searchCSS);`]]}